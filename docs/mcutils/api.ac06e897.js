function e(e,t,a,l){Object.defineProperty(e,t,{get:a,set:l,enumerable:!0,configurable:!0})}var t=globalThis,a={},l={},i=t.parcelRequire8969;null==i&&((i=function(e){if(e in a)return a[e].exports;if(e in l){var t=l[e];delete l[e];var i={id:e,exports:{}};return a[e]=i,t.call(i.exports,i,i.exports),i.exports}var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){l[e]=t},t.parcelRequire8969=i);var s=i.register;s("5blsF",function(t,a){let l;e(t.exports,"default",()=>f);var s=i("c6CRU"),r=i("kbFhP"),n=i("c86V7"),o=i("2Fada"),u=i("iQyfo"),c=i("467x5"),d=i("cvawf"),p=i("l956U"),m=i("4XpLa");i("1HEmm");let h=`
<ul>
  <li class="info">
    Pour enregistrer une carte dans votre espace personnel, remplissez le formulaire.
  </li>
  <li class="accent">
    Vous devez renseigner les champs obligatoires...
  </li>
  <li data-attr="title">
    <input class="title input-placeholder required" type="text" placeholder="Titre de la carte">
  </li>
  <li data-attr="description">
    <textarea class="description input-placeholder" type="text" placeholder="Description"></textarea>
  </li>
  <li data-attr="theme">
    <span class="required">Th\xe8me</span> :
    <select class="theme"></select>
  </li>
  <li data-attr="img_url">
    Image d'illustration :
    <br/>
    <input type="text" class="image" />
  </li>
  <li data-attr="share">
    Publication :
    <select class="share">
    </select>
  </li>
`;var f=function(e,t,a){a=a||{},t="function"==typeof t?t:()=>{};let i={};if(e instanceof c.default||e instanceof d.default?((i=e.get("atlas")||{}).title||(i.title=e.get("title")||""),i.description||(i.description=(0,p.default).text(e.get("description"))||""),i.img_url||(i.img_url=e.get("logo")||"")):i=e,a.saveAs){let e=i;i={},["active","description","img_url","theme","theme_id","title","type","premium"].forEach(t=>{i[t]=e[t]})}i.organization_id||(i.organization_id=(0,m.default).getId()),void 0===i.active&&(i.active=!0),(0,r.default).show({title:a.prompt||"Enregistrer une carte",className:("mc-save-map "+(a.className||"")).trim(),content:h,buttons:{submit:"Enregistrer",cancel:"annuler"},onButton:(a,s)=>{if("submit"===a){if(s.title.classList.remove("invalid"),s.theme.classList.remove("invalid"),!s.title.value||!s.theme.value){f.style.display="block",s.title.value||s.title.classList.add("invalid"),s.theme.value||s.theme.classList.add("invalid");return}i.title=s.title.value,i.description=s.description.value,i.theme_id=s.theme.value,i.theme=l[s.theme.value],i.img_url=s.image.value,i.share=s.share.value,(e instanceof c.default||e instanceof d.default)&&e.set("atlas",i),(0,r.default).hide(),t(e,i)}}});let f=(0,r.default).getContentElement().querySelector(".accent"),g=(0,r.default).getInputs();g.title.value=i.title||"",g.description.value=i.description||"",g.image.value=i.img_url||"",(0,m.default).getId()?g.share.innerHTML=`
      <option value="private">Priv\xe9e</option>
      <option value="public">Equipe</option>
      <option value="atlas">Atlas</option>
    `:g.share.innerHTML=`
      <option value="public">Publique</option>
      <option value="atlas">Atlas</option>
    `,g.share.value=i.share||((0,m.default).getId()?"private":"public"),(0,m.default).getId()&&!(0,m.default).isOwner()&&(g.share.disabled=!0),g.title.addEventListener("change",()=>{g.title.classList.remove("invalid")}),g.theme.addEventListener("change",()=>{g.theme.classList.remove("invalid")}),(0,s.default).setInputPlaceholder((0,r.default).getContentElement());let v=e=>{if(e){if(e.error)return;l={},e.forEach(e=>{l[e.id]=e.name})}let t=(0,r.default).getContentElement().querySelector("select");(0,u.default).create("OPTION",{html:"Choisir un theme...",value:"",disabled:!0,selected:!0,parent:t}),Object.keys(l).forEach(e=>{let a=(0,u.default).create("OPTION",{html:l[e],value:e,parent:t});l[e]===i.theme&&(a.selected=!0)})};return l?v():(0,o.default).getThemes(v),window.api=o.default,new n.default({add:!0,input:(0,r.default).getContentElement().querySelector("input.image")}),r.default}}),s("c86V7",function(t,a){e(t.exports,"default",()=>u);var l=i("iQyfo"),s=i("fnScq"),r=i("2iBkg"),n=i("jmRXz");class o extends s.default{constructor(e){super(e=e||{}),this.input=e.input||(0,l.default).create("INPUT",{type:"url",parent:e.parent}),this.input.placeholder=e.placeholder||"Url de l'image",this.input.type="text",this.value=this.input.value,this.set("fullpath",e.fullpath);let t=this.element=(0,l.default).create("DIV",{className:"mc-input-media"});this.input.parentNode.insertBefore(t,this.input),this._imgDiv=(0,l.default).create("DIV",{className:"mc-img",parent:t});let a=this._img=new Image;a.onerror=()=>{t.classList.remove("loading"),this._imgDiv.style["background-image"]="",this.input.value?this.input.classList.add("invalid"):this.input.classList.remove("invalid"),this.value="",this.dispatchEvent({type:"load",value:this.value,error:!0})},a.onload=()=>{if(t.classList.remove("loading"),this._imgDiv.style["background-image"]="url("+a.src+")",this.value=a.src,this.input.classList.remove("invalid"),this.set("crossOrigin",!1),e.useCors){let e=new Image;e.crossOrigin="anonymous",e.onload=()=>{this.set("crossOrigin","anonymous"),this.dispatchEvent({type:"load",value:this.value})},e.onerror=()=>{this.dispatchEvent({type:"load",value:this.value})},e.src=a.src}else this.dispatchEvent({type:"load",value:this.value})},this.value&&(a.src=(0,r.getMediaURL)(this.value)),t.appendChild(this.input),this.input.addEventListener("change",()=>{this.setValue(this.input.value),this.value="",i.style.display=this.input.value?"":"none"}),this.input.addEventListener("keyup",()=>{i.style.display=this.input.value?"":"none"});let i=(0,l.default).create("BUTTON",{className:"delete",type:"button",style:{display:this.input.value?"":"none"},title:e.btnTitle||"Chercher dans la galerie...",html:'<i class="fa fa-times"></i>',click:()=>{this.value="del",this.setValue(""),this.input.focus()},parent:t}),s=e.thumb;(0,l.default).create("BUTTON",{className:"button-colored user-media",type:"button",title:e.btnTitle||"Chercher dans la galerie...",html:'<i class="fi-galerie-image"></i>',click:()=>{(0,n.default)({thumb:s,add:e.add,callback:e=>{s=e.thumb;let t=e.thumb?e.item.thumb_url:e.item.view_url;this.get("fullpath")?this.setValue(t):this.setValue(t.split("/").pop())}})},parent:t})}}o.prototype.getValue=function(){return this.input.value},o.prototype.setValue=function(e){this.value!==e&&(this.value=e,this.element.classList.add("loading"),this.input.value=e,this._img.src=(0,r.getMediaURL)(e),this.input.dispatchEvent(new Event("change")))};var u=o}),s("agEcb",function(e,t){function a(t){return e.exports=a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,a(t)}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports}),s("kMG75",function(t,a){let l;e(t.exports,"default",()=>o);var s=i("fnScq"),r=i("iQyfo");class n extends s.default{constructor(e,t){super(),t=t||{},this.set("full",!!t.full),this.api=e;let a=this.element=(0,r.default).create("DIV",{className:"author-list",parent:t.target}),l=this.searchInput=(0,r.default).create("INPUT",{type:"text",className:"author",placeholder:"chercher un membre...",parent:a});(0,r.default).create("I",{className:"loading",parent:a});let i=(0,r.default).create("UL",{className:"autocomplete",parent:a});l.addEventListener("keyup",()=>{this.autocompleteAuthor(l.value,i)}),l.addEventListener("focus",()=>{i.style.display="block"}),l.addEventListener("focusout",()=>{setTimeout(()=>i.style.display="none",200)})}}n.prototype.setUser=function(e){this.searchInput.value=e},n.prototype.autocompleteAuthor=function(e,t){e!==this._currentSearch&&(this._currentSearch=e,l&&clearTimeout(l),this.element.dataset.loading="",l=setTimeout(()=>{if(!e){t.innerHTML="",delete this.element.dataset.loading;return}this.get("full")?this.api.getUsers(e,e=>{delete this.element.dataset.loading,t.innerHTML="",e&&e.forEach&&e.forEach(e=>{let a=(0,r.default).create("LI",{text:e.public_name,className:"full",click:()=>{this.dispatchEvent({type:"select",user:e})},parent:t});e.profile_picture&&(0,r.default).create("IMG",{src:e.profile_picture,parent:a})})}):this.api.searchMapUsers({public_name:e},e=>{delete this.element.dataset.loading,t.innerHTML="",e&&e.forEach&&e.forEach(e=>{(0,r.default).create("LI",{html:e,click:()=>{this.dispatchEvent({type:"select",public_name:e})},parent:t})})})},500))};var o=n}),s("4AFFV",function(e,t){});var r=i("iQyfo"),n=i("2Fada"),o=i("gXJm2"),u=i("kbFhP"),c=i("l956U");i("gIJof");var d=i("5blsF"),p={param:{lon:2.9039299200561297,lat:47.071827259052185,rot:0,zoom:5,titre:"Vide",description:"Pas de description",status:"brouillon",controlParams:{limitGeo:"1",zoomBtn:"1",selectLayer:"1",contextMap:"1",legend:1,scaleLine:"1",pSearchBar:"1",coords:"0",attribution:1},proj:{valeur:"EPSG:4326",unite:"ds"}},legende:{legendVisible:!0,legendPos:"bottom-left",legendWidth:300,lineHeight:55,legendParam:{width:300,lineHeight:55},legendtitle:"Ma légende",legend:[]},layers:[{type:"Geoportail",name:"Plan IGN",titre:"sans-titre",visibility:!0,opacity:1,description:"Cartographie multi-échelles sur le territoire national, issue des bases de données vecteur de l’IGN, mis à jour régulièrement et réalisée selon un processus entièrement automatisé. Version actuellement en beta test",layer:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2"},{type:"WMTS",name:"Visualisation OCSGE Gers",titre:"Visualisation OCSGE Gers",visibility:!0,opacity:1,description:"Résultat IA aggloméré à l'ortho",wmtsparam:{layer:{title:"Visualisation OCSGE Gers",extent:[-35807.47268652755,5354917.644568233,136449.86583985508,5482201.678868297],abstract:"Résultat IA aggloméré à l'ortho",maxResolution:2445.98490512564},source:{url:"https://wxs-v.geo.rie.gouv.fr/geoportail/wmts?",layer:"OCSGE_VISU_PYR-PNG_WM_20220602",matrixSet:"PM",format:"image/png",projection:"EPSG:3857",minZoom:6,maxZoom:18,style:"nolegend",attributions:["IGN"],crossOrigin:"anonymous",wrapX:!0},data:{title:"Visualisation OCSGE Gers",abstract:"Résultat IA aggloméré à l'ortho",legend:["https://wxs-v.geo.rie.gouv.fr/static/legends/LEGEND.jpg"]}}},{dessin:!0,type:"Vector",name:"Dessin",titre:"sans-titre",visibility:!0,opacity:1,popupContent:{},style:{},features:[]}],symbolLib:{}},m=i("bS8Lk"),h=i("2iBkg");function f(e){e instanceof Element?(0,o.default).getAppElement().appendChild(e):(0,r.default).create("DIV",{html:e,parent:(0,o.default).getAppElement()})}function g(e){let t=v.value;(0,u.default).showWait("Chargement en cours..."),(0,n.default).getMaps({context:e,query:t},a=>{if(a.error)401===a.status?(0,u.default).showAlert("Vous devez être connecté pour accéder aux cartes...",{ok:"ok",connect:"connexion"},e=>{"connect"===e&&setTimeout(()=>(0,o.default).connect(),200)}):(0,u.default).showAlert("Impossible d'accéder aux cartes..."),f(a.status+" : "+a.statusText);else if(f("Cartes "+(e||(0,n.default).getMe().public_name)+" : "+a.maps.length+" / "+a.count.toLocaleString()+" carte(s)"),t&&a.maps.length){console.log(a.maps[0]),f("<hr />"),a.maps[0].img_url&&(0,r.default).create("IMG",{src:(0,h.getMediaURL)(a.maps[0].img_url),parent:(0,o.default).getAppElement()});let e=(0,r.default).create("DIV",{html:a.maps[0].title+" ("+a.maps[0].type+") par "}),t=a.maps[0].user;(0,r.default).create("A",{html:t,target:"_new",href:"#",click:e=>{e.preventDefault(),(0,n.default).getUser(t,e=>{e.error||f(e.public_name+(e.presentation?"<br/>"+(0,c.default)(e.presentation):""))})},parent:e}),f(e),f("<hr />")}(0,u.default).hide()})}(0,o.default).setApp("api","api"),document.body.appendChild((0,o.default).getToolbarElement()),(0,r.default).create("BUTTON",{html:"Save carte",className:"button button-colored",click:()=>{(0,d.default)({title:"test",theme:"Agriculture",type:"macarte",premium:"default",bbox:[0,0,0,0]},e=>{(0,u.default).showWait("Enregistrement en cours..."),(0,n.default).postMap(e,p,e=>{e.error?(0,u.default).showAlert(e.statusText+"<br/>"+e.xhttp.response):((0,u.default).hide(),(0,m.default).show("Carte enregistrée"))})})},parent:(0,o.default).getAppElement()}),(0,o.default).addTool("maps","fg-map-lock","Admin",()=>{g("admin")}),(0,o.default).addTool("maps","fg-map-share","Atlas",()=>{g("atlas")}),(0,o.default).addTool("maps","fg-map-user","Mes cartes",()=>{g()});const v=(0,r.default).create("INPUT",{type:"search",placeHolder:"Rechercher dans l'Atlas",parent:(0,r.default).create("DIV",{className:"search",parent:(0,o.default).getToolbarElement()})});(0,n.default).on(["login","logout","error","disconnect"],e=>{f(e.type.toUpperCase()+("login"===e.type?" > "+e.user.public_name:""))}),window.api=n.default,window.charte=o.default,window.dialog=u.default;