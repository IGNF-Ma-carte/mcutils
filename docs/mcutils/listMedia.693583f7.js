var e=globalThis,t={},a={},l=e.parcelRequire8969;null==l&&((l=function(e){if(e in t)return t[e].exports;if(e in a){var l=a[e];delete a[e];var s={id:e,exports:{}};return t[e]=s,l.call(s.exports,s,s.exports),s.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){a[e]=t},e.parcelRequire8969=l),(0,l.register)("c86V7",function(e,t){Object.defineProperty(e.exports,"default",{get:()=>u,set:void 0,enumerable:!0,configurable:!0});var a=l("iQyfo"),s=l("fnScq"),i=l("2iBkg"),r=l("jmRXz");class o extends s.default{constructor(e){super(e=e||{}),this.input=e.input||(0,a.default).create("INPUT",{type:"url",parent:e.parent}),this.input.placeholder=e.placeholder||"Url de l'image",this.input.type="text",this.value=this.input.value,this.set("fullpath",e.fullpath);let t=this.element=(0,a.default).create("DIV",{className:"mc-input-media"});this.input.parentNode.insertBefore(t,this.input),this._imgDiv=(0,a.default).create("DIV",{className:"mc-img",parent:t});let l=this._img=new Image;l.onerror=()=>{t.classList.remove("loading"),this._imgDiv.style["background-image"]="",this.input.value?this.input.classList.add("invalid"):this.input.classList.remove("invalid"),this.value="",this.dispatchEvent({type:"load",value:this.value,error:!0})},l.onload=()=>{if(t.classList.remove("loading"),this._imgDiv.style["background-image"]="url("+l.src+")",this.value=l.src,this.input.classList.remove("invalid"),this.set("crossOrigin",!1),e.useCors){let e=new Image;e.crossOrigin="anonymous",e.onload=()=>{this.set("crossOrigin","anonymous"),this.dispatchEvent({type:"load",value:this.value})},e.onerror=()=>{this.dispatchEvent({type:"load",value:this.value})},e.src=l.src}else this.dispatchEvent({type:"load",value:this.value})},this.value&&(l.src=(0,i.getMediaURL)(this.value)),t.appendChild(this.input),this.input.addEventListener("change",()=>{this.setValue(this.input.value),this.value="",s.style.display=this.input.value?"":"none"}),this.input.addEventListener("keyup",()=>{s.style.display=this.input.value?"":"none"});let s=(0,a.default).create("BUTTON",{className:"delete",type:"button",style:{display:this.input.value?"":"none"},title:e.btnTitle||"Chercher dans la galerie...",html:'<i class="fa fa-times"></i>',click:()=>{this.value="del",this.setValue(""),this.input.focus()},parent:t}),o=e.thumb;(0,a.default).create("BUTTON",{className:"button-colored user-media",type:"button",title:e.btnTitle||"Chercher dans la galerie...",html:'<i class="fi-galerie-image"></i>',click:()=>{(0,r.default)({thumb:o,add:e.add,callback:e=>{o=e.thumb;let t=e.thumb?e.item.thumb_url:e.item.view_url;this.get("fullpath")?this.setValue(t):this.setValue(t.split("/").pop())}})},parent:t})}}o.prototype.getValue=function(){return this.input.value},o.prototype.setValue=function(e){this.value!==e&&(this.value=e,this.element.classList.add("loading"),this.input.value=e,this._img.src=(0,i.getMediaURL)(e),this.input.dispatchEvent(new Event("change")))};var u=o});var s=l("2Fada"),i=l("gXJm2");l("gIJof");var r=l("jmRXz"),o=l("j0fq3"),u=l("c86V7"),n=l("iQyfo");l("kbFhP");var d=l("kkNxo");document.querySelector("button").addEventListener("click",()=>{(0,r.default)({thumb:!1,add:!0,callback:console.log})}),(0,i.default).setApp("media","Médias");const c=new u.default({thumb:!1,add:!0,fullpath:!0,input:document.querySelector("input")}),h=new o.default(s.default,{selection:!0,search:!0,check:!0,limit:!0,target:(0,i.default).getAppElement()}),p=h.getHeaderElement();h.on(["check","draw:list"],()=>{let e=p.querySelectorAll("button.select");h.getChecked().length?e.forEach(e=>e.classList.remove("button-disabled")):e.forEach(e=>e.classList.add("button-disabled"))}),(0,n.default).create("BUTTON",{className:"button button-ghost",html:'<i class="fa fa-plus-circle fa-fw"></i> Ajouter un média...',click:()=>{(0,r.addMediaDialog)({callback:e=>{e.error||(h.updateFolders(),h.setFolder(e.item.folder))}},h.get("folders"))},parent:p}),(0,n.default).create("BUTTON",{className:"button button-ghost select",html:'<i class="fi-galerie-image fa-fw"></i> Modifier un média...',click:()=>{(0,r.updateMediaDialog)({media:h.getChecked()[0],folders:h.get("folders"),callback:e=>{e.error||(h.updateFolders(),h.setFolder(e.item.folder))}})},parent:p}),(0,n.default).create("BUTTON",{className:"button button-ghost select",html:'<i class="fa fa-folder fa-fw"></i> Changer de dossier...',click:()=>{let e=h.getChecked();if(!e||!e.length){(0,d.default).showMessage("Sélectionnez des images à changer de dossier...");return}h.getFolderDialog({prompt:"Nom du dossier où déplacer les images :"},t=>{let a=l=>{if(l&&l.error){(0,d.default).showAlert("Une erreur est survenue !<br/>Impossible de changer de dossier..."),h.updateFolders(),h.showPage();return}let i=e.pop();i?i.folder!==t?(0,s.default).updateMediaFolder(i.id,t,a):a():(h.updateFolders(),h.showPage())};a()})},parent:p}),(0,n.default).create("BUTTON",{className:"button button-accent select",html:'<i class="fa fa-trash fa-fw"></i> Supprimer...',click:()=>{let e=h.getChecked();if(!e||!e.length){(0,d.default).showMessage("Sélectionnez des images à supprimer...");return}let t=a=>{if(a&&a.error){(0,d.default).showAlert("Une erreur est survenue !<br/>Impossible de supprimer une image..."),h.showPage(h.get("currentPage"));return}let l=e.pop();l?(0,s.default).deleteMedia(l.id,t):h.updateFolders(e=>{0>e.indexOf(h.get("folder"))?h.setFolder():h.showPage(h.get("currentPage"))})};(0,d.default).showAlert("Êtes-vous sûr de vouloir supprimer <b>"+e.length+"</b> image"+(e.length>1?"s ?":" ?")+'<br/>Une fois supprimées, les images ne s\'afficheront plus sur les cartes.<br/><b class="accent">Cette action est irréversible.</b>',{ok:"supprimer",cancel:"annuler"},e=>{"ok"===e&&t(),(0,d.default).close()}),(0,d.default).element.querySelector(".ol-buttons input").className="button button-accent"},parent:p}),h.showPage(),(0,s.default).on(["login","logout"],()=>{let e=document.querySelectorAll("button");(0,s.default).isConnected()?e.forEach(e=>e.classList.remove("button-disabled")):e.forEach(e=>e.classList.add("button-disabled")),h.updateFolders(),h.search()}),console.log((0,s.default).getMe()),(0,s.default).on("me",console.log),(0,i.default).on("user",console.log),(0,s.default).on("login",console.log),window.list=h,window.input=c,window.charte=i.default,window.api=s.default;