var e=globalThis,t={},a={},n=e.parcelRequire8969;null==n&&((n=function(e){if(e in t)return t[e].exports;if(e in a){var n=a[e];delete a[e];var o={id:e,exports:{}};return t[e]=o,n.call(o.exports,o,o.exports),o.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){a[e]=t},e.parcelRequire8969=n),(0,n.register)("kMG75",function(e,t){let a;Object.defineProperty(e.exports,"default",{get:()=>l,set:void 0,enumerable:!0,configurable:!0});var o=n("fnScq"),r=n("iQyfo");class i extends o.default{constructor(e,t){super(),t=t||{},this.api=e;let a=this.element=(0,r.default).create("DIV",{className:"author-list",parent:t.target}),n=this.searchInput=(0,r.default).create("INPUT",{type:"text",className:"author",placeholder:"chercher un auteur...",parent:a}),o=(0,r.default).create("UL",{className:"autocomplete",parent:a});n.addEventListener("keyup",()=>{this.autocompleteAuthor(n.value,o)}),n.addEventListener("focus",()=>{o.style.display="block"}),n.addEventListener("focusout",()=>{setTimeout(()=>o.style.display="none",200)})}}i.prototype.setUser=function(e){this.searchInput.value=e},i.prototype.autocompleteAuthor=function(e,t){a&&clearTimeout(a),a=setTimeout(()=>{this.api.searchUsers({public_name:e},e=>{t.innerHTML="",e&&e.forEach&&e.forEach(e=>{(0,r.default).create("LI",{html:e,click:()=>{this.dispatchEvent({type:"select",public_name:e})},parent:t})})})},500)};var l=i});var o=n("iQyfo"),r=n("2Fada"),i=n("gXJm2"),l=n("kbFhP"),u=n("l956U"),d=n("kMG75"),c=n("hXSe1"),o=n("iQyfo"),c=n("hXSe1"),r=n("2Fada");(0,i.default).setApp("api","Organizations");const s=(function(e){let t={},a=function(){},n=function(){},i=(0,o.default).create("SELECT",{disabled:!0,change:()=>{a(t[i.value])},parent:e});function l(){i.innerHTML="";let e=(0,o.default).create("OPTION",{text:"chargement...",value:"",parent:i});(0,r.default).getOrganizations(a=>{if(!a||!a.length){e.innerText="Aucune organisation";return}e.innerText="hors organisation",t={},a.forEach(e=>{t[e.organization_id]=e;let a=(0,o.default).create("OPTION",{text:e.organization_name,value:e.organization_id,parent:i});(0,c.default).get().organization_id===e.organization_id&&(a.selected=!0)}),i.disabled=!1,n(a),(0,c.default).checkIn(a)})}l();let u={element:i,setOptions:l,onselect:e=>("function"==typeof e&&(a=e),u),onready:e=>("function"==typeof e&&(n=e),u)};return u})((0,i.default).getAppElement().querySelector(".selector")).onselect(e=>{(0,c.default).set(e)});(0,r.default).on("login",()=>{s.setOptions()});const f=(0,o.default).create("UL",{parent:(0,i.default).getAppElement().querySelector(".organizations")});function p(){f.innerHTML="",(0,l.default).showWait("Chargement..."),(0,r.default).getOrganizations(e=>{e.error||e.forEach(e=>{(0,o.default).create("LI",{text:e.organization_name+" ("+e.user_role+")",click:()=>{(0,l.default).showWait("Organisation "+e.organization_name+"..."),function e(t){(0,r.default).getOrganization(t.organization_id,a=>{(0,l.default).show({title:a.name,content:(0,u.default)(a.presentation),buttons:{delete:"Supprimer",addUser:"Ajouter un membre",cancel:"annuler"},onButton:a=>{"delete"===a&&((0,l.default).showWait("Suppression"),(0,r.default).deleteOrganization(t.organization_id,()=>{(0,l.default).hide(),p()})),"addUser"===a&&((0,l.default).show({title:"Ajouter un membre",content:'<input type="text" class="userId" />',buttons:{ok:"ok",cancel:"annuler"},onButton:(a,n)=>{"ok"===a&&((0,l.default).showWait("ajout..."),(0,r.default).addOrganizationMember(t.organization_id,n.userId.value,"member",()=>{e(t)}))}}),new d.default(r.default,{target:(0,l.default).getContentElement()}).on("select",console.log))}});let n=(0,o.default).create("UL",{parent:(0,l.default).getContentElement()});a.members.forEach(i=>{let u=(0,o.default).create("LI",{html:(0,o.default).create("SPAN",{text:i.public_name}),parent:n}),d=(0,o.default).create("SELECT",{on:{change:()=>{(0,l.default).showWait("modification..."),(0,r.default).setOrganizationMember(a.public_id,i.public_id,d.value,()=>e(t))}},parent:u});["member","editor","owner"].forEach(e=>{let t=(0,o.default).create("OPTION",{text:e,parent:d});e===i.role&&(t.selected=!0)}),(0,o.default).create("I",{className:"fi-delete button-colored",click:()=>{(0,l.default).showWait("suppression..."),(0,r.default).removeOrganizationMember(a.public_id,i.public_id,()=>e(t))},parent:u})})})}(e)},parent:f})}),(0,l.default).hide()})}(0,r.default).on("me",p),(0,r.default).on(["login","logout","error","disconnect"],e=>{f.innerHTML=""}),(0,i.default).getAppElement().querySelector('[data-role="add"]').addEventListener("click",()=>{(0,l.default).show({title:"Ajouter une organisation",content:`<input type="text" placeholder="nom" class="name" />
    <textarea class="presentation" placeholder="presentation"></textarea>
    <input type="text" placeholder="image" class="image" />
    `,buttons:{ok:"ok",cancel:"annuler"},onButton:(e,t)=>{"ok"===e&&((0,l.default).showWait("ajout en cours..."),(0,r.default).newOrganization({name:t.name.value,presentation:t.presentation.value,image:t.image.value},p))}})}),window.api=r.default,window.charte=i.default,window.dialog=l.default,window.organization=c.default;