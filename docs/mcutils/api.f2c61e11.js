function e(e,t,a,s){Object.defineProperty(e,t,{get:a,set:s,enumerable:!0,configurable:!0})}var t=globalThis,a={},s={},l=t.parcelRequire8969;null==l&&((l=function(e){if(e in a)return a[e].exports;if(e in s){var t=s[e];delete s[e];var l={id:e,exports:{}};return a[e]=l,t.call(l.exports,l,l.exports),l.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){s[e]=t},t.parcelRequire8969=l);var i=l.register;i("agEcb",function(e,t){function a(t){return e.exports=a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,a(t)}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports}),i("c86V7",function(t,a){e(t.exports,"default",()=>u);var s=l("iQyfo"),i=l("fnScq"),r=l("2iBkg"),n=l("jmRXz");class o extends i.default{constructor(e){super(e=e||{}),this.input=e.input||(0,s.default).create("INPUT",{type:"url",parent:e.parent}),this.input.placeholder=e.placeholder||"Url de l'image",this.input.type="text",this.value=this.input.value,this.set("fullpath",e.fullpath);let t=this.element=(0,s.default).create("DIV",{className:"mc-input-media"});this.input.parentNode.insertBefore(t,this.input),this._imgDiv=(0,s.default).create("DIV",{className:"mc-img",parent:t});let a=this._img=new Image;a.onerror=()=>{t.classList.remove("loading"),this._imgDiv.style["background-image"]="",this.input.value?this.input.classList.add("invalid"):this.input.classList.remove("invalid"),this.value="",this.dispatchEvent({type:"load",value:this.value,error:!0})},a.onload=()=>{if(t.classList.remove("loading"),this._imgDiv.style["background-image"]="url("+a.src+")",this.value=a.src,this.input.classList.remove("invalid"),this.set("crossOrigin",!1),e.useCors){let e=new Image;e.crossOrigin="anonymous",e.onload=()=>{this.set("crossOrigin","anonymous"),this.dispatchEvent({type:"load",value:this.value})},e.onerror=()=>{this.dispatchEvent({type:"load",value:this.value})},e.src=a.src}else this.dispatchEvent({type:"load",value:this.value})},this.value&&(a.src=(0,r.getMediaURL)(this.value)),t.appendChild(this.input),this.input.addEventListener("change",()=>{this.setValue(this.input.value),this.value="",l.style.display=this.input.value?"":"none"}),this.input.addEventListener("keyup",()=>{l.style.display=this.input.value?"":"none"});let l=(0,s.default).create("BUTTON",{className:"delete",type:"button",style:{display:this.input.value?"":"none"},title:e.btnTitle||"Chercher dans la galerie...",html:'<i class="fa fa-times"></i>',click:()=>{this.value="del",this.setValue(""),this.input.focus()},parent:t}),i=e.thumb;(0,s.default).create("BUTTON",{className:"button-colored user-media",type:"button",title:e.btnTitle||"Chercher dans la galerie...",html:'<i class="fi-galerie-image"></i>',click:()=>{(0,n.default)({thumb:i,add:e.add,callback:e=>{i=e.thumb;let t=e.thumb?e.item.thumb_url:e.item.view_url;this.get("fullpath")?this.setValue(t):this.setValue(t.split("/").pop())}})},parent:t})}}o.prototype.getValue=function(){return this.input.value},o.prototype.setValue=function(e){this.value!==e&&(this.value=e,this.element.classList.add("loading"),this.input.value=e,this._img.src=(0,r.getMediaURL)(e),this.input.dispatchEvent(new Event("change")))};var u=o}),i("kMG75",function(t,a){let s;e(t.exports,"default",()=>o);var i=l("fnScq"),r=l("iQyfo");class n extends i.default{constructor(e,t){super(),t=t||{},this.set("full",!!t.full),this.api=e;let a=this.element=(0,r.default).create("DIV",{className:"author-list",parent:t.target}),s=this.searchInput=(0,r.default).create("INPUT",{type:"text",className:"author",placeholder:"chercher un membre...",parent:a});(0,r.default).create("I",{className:"loading",parent:a});let l=(0,r.default).create("UL",{className:"autocomplete",parent:a});s.addEventListener("keyup",()=>{this.autocompleteAuthor(s.value,l)}),s.addEventListener("focus",()=>{l.style.display="block"}),s.addEventListener("focusout",()=>{setTimeout(()=>l.style.display="none",200)})}}n.prototype.setUser=function(e){this.searchInput.value=e},n.prototype.autocompleteAuthor=function(e,t){e!==this._currentSearch&&(this._currentSearch=e,s&&clearTimeout(s),this.element.dataset.loading="",s=setTimeout(()=>{if(!e){t.innerHTML="",delete this.element.dataset.loading;return}this.get("full")?this.api.getUsers(e,e=>{delete this.element.dataset.loading,t.innerHTML="",e&&e.forEach&&e.forEach(e=>{let a=(0,r.default).create("LI",{text:e.public_name,className:"full",click:()=>{this.dispatchEvent({type:"select",user:e})},parent:t});e.profile_picture&&(0,r.default).create("IMG",{src:e.profile_picture,parent:a})})}):this.api.searchMapUsers({public_name:e},e=>{delete this.element.dataset.loading,t.innerHTML="",e&&e.forEach&&e.forEach(e=>{(0,r.default).create("LI",{html:e,click:()=>{this.dispatchEvent({type:"select",public_name:e})},parent:t})})})},500))};var o=n});var r=l("iQyfo"),n=l("2Fada"),o=l("gXJm2"),u=l("kbFhP"),c=l("l956U");l("gIJof");var p=l("5blsF"),d={param:{lon:2.9039299200561297,lat:47.071827259052185,rot:0,zoom:5,titre:"Vide",description:"Pas de description",status:"brouillon",controlParams:{limitGeo:"1",zoomBtn:"1",selectLayer:"1",contextMap:"1",legend:1,scaleLine:"1",pSearchBar:"1",coords:"0",attribution:1},proj:{valeur:"EPSG:4326",unite:"ds"}},legende:{legendVisible:!0,legendPos:"bottom-left",legendWidth:300,lineHeight:55,legendParam:{width:300,lineHeight:55},legendtitle:"Ma légende",legend:[]},layers:[{type:"Geoportail",name:"Plan IGN",titre:"sans-titre",visibility:!0,opacity:1,description:"Cartographie multi-échelles sur le territoire national, issue des bases de données vecteur de l’IGN, mis à jour régulièrement et réalisée selon un processus entièrement automatisé. Version actuellement en beta test",layer:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2"},{type:"WMTS",name:"Visualisation OCSGE Gers",titre:"Visualisation OCSGE Gers",visibility:!0,opacity:1,description:"Résultat IA aggloméré à l'ortho",wmtsparam:{layer:{title:"Visualisation OCSGE Gers",extent:[-35807.47268652755,5354917.644568233,136449.86583985508,5482201.678868297],abstract:"Résultat IA aggloméré à l'ortho",maxResolution:2445.98490512564},source:{url:"https://wxs-v.geo.rie.gouv.fr/geoportail/wmts?",layer:"OCSGE_VISU_PYR-PNG_WM_20220602",matrixSet:"PM",format:"image/png",projection:"EPSG:3857",minZoom:6,maxZoom:18,style:"nolegend",attributions:["IGN"],crossOrigin:"anonymous",wrapX:!0},data:{title:"Visualisation OCSGE Gers",abstract:"Résultat IA aggloméré à l'ortho",legend:["https://wxs-v.geo.rie.gouv.fr/static/legends/LEGEND.jpg"]}}},{dessin:!0,type:"Vector",name:"Dessin",titre:"sans-titre",visibility:!0,opacity:1,popupContent:{},style:{},features:[]}],symbolLib:{}},h=l("bS8Lk"),m=l("2iBkg");function f(e){e instanceof Element?(0,o.default).getAppElement().appendChild(e):(0,r.default).create("DIV",{html:e,parent:(0,o.default).getAppElement()})}function g(e){let t=v.value;(0,u.default).showWait("Chargement en cours..."),(0,n.default).getMaps({context:e,query:t},a=>{if(a.error)401===a.status?(0,u.default).showAlert("Vous devez être connecté pour accéder aux cartes...",{ok:"ok",connect:"connexion"},e=>{"connect"===e&&setTimeout(()=>(0,o.default).connect(),200)}):(0,u.default).showAlert("Impossible d'accéder aux cartes..."),f(a.status+" : "+a.statusText);else if(f("Cartes "+(e||(0,n.default).getMe().public_name)+" : "+a.maps.length+" / "+a.count.toLocaleString()+" carte(s)"),t&&a.maps.length){console.log(a.maps[0]),f("<hr />"),a.maps[0].img_url&&(0,r.default).create("IMG",{src:(0,m.getMediaURL)(a.maps[0].img_url),parent:(0,o.default).getAppElement()});let e=(0,r.default).create("DIV",{html:a.maps[0].title+" ("+a.maps[0].type+") par "}),t=a.maps[0].user;(0,r.default).create("A",{html:t,target:"_new",href:"#",click:e=>{e.preventDefault(),(0,n.default).getUser(t,e=>{e.error||f(e.public_name+(e.presentation?"<br/>"+(0,c.default)(e.presentation):""))})},parent:e}),f(e),f("<hr />")}(0,u.default).hide()})}(0,o.default).setApp("api","api"),document.body.appendChild((0,o.default).getToolbarElement()),(0,r.default).create("BUTTON",{html:"Save carte",className:"button button-colored",click:()=>{(0,p.default)({title:"test",theme:"Agriculture",type:"macarte",premium:"default",bbox:[0,0,0,0]},e=>{(0,u.default).showWait("Enregistrement en cours..."),(0,n.default).postMap(e,d,e=>{e.error?(0,u.default).showAlert(e.statusText+"<br/>"+e.xhttp.response):((0,u.default).hide(),(0,h.default).show("Carte enregistrée"))})})},parent:(0,o.default).getAppElement()}),(0,o.default).addTool("maps","fg-map-lock","Admin",()=>{g("admin")}),(0,o.default).addTool("maps","fg-map-share","Atlas",()=>{g("atlas")}),(0,o.default).addTool("maps","fg-map-user","Mes cartes",()=>{g()});const v=(0,r.default).create("INPUT",{type:"search",placeHolder:"Rechercher dans l'Atlas",parent:(0,r.default).create("DIV",{className:"search",parent:(0,o.default).getToolbarElement()})});(0,n.default).on(["login","logout","error","disconnect"],e=>{f(e.type.toUpperCase()+("login"===e.type?" > "+e.user.public_name:""))}),window.api=n.default,window.charte=o.default,window.dialog=u.default;