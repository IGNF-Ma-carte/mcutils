let e;function t(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}function r(e){return e&&e.__esModule?e.default:e}var i=globalThis,n={},s={},o=i.parcelRequire8969;null==o&&((o=function(e){if(e in n)return n[e].exports;if(e in s){var t=s[e];delete s[e];var r={id:e,exports:{}};return n[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){s[e]=t},i.parcelRequire8969=o);var a=o.register;a("eRhGG",function(e,r){t(e.exports,"fieldTagNames",()=>i),t(e.exports,"fieldTags",()=>n),t(e.exports,"fieldTagTypes",()=>s),t(e.exports,"arrayFields",()=>o),t(e.exports,"fieldTypeNames",()=>a),t(e.exports,"fieldTypes",()=>l),t(e.exports,"photometricInterpretations",()=>h),t(e.exports,"ExtraSamplesValues",()=>u),t(e.exports,"LercParameters",()=>c),t(e.exports,"LercAddCompression",()=>f),t(e.exports,"geoKeyNames",()=>d),t(e.exports,"geoKeys",()=>g);let i={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},n={};for(let e in i)i.hasOwnProperty(e)&&(n[i[e]]=parseInt(e,10));let s={256:"SHORT",257:"SHORT",258:"SHORT",259:"SHORT",262:"SHORT",273:"LONG",274:"SHORT",277:"SHORT",278:"LONG",279:"LONG",282:"RATIONAL",283:"RATIONAL",284:"SHORT",286:"SHORT",287:"RATIONAL",296:"SHORT",297:"SHORT",305:"ASCII",306:"ASCII",338:"SHORT",339:"SHORT",513:"LONG",514:"LONG",1024:"SHORT",1025:"SHORT",2048:"SHORT",2049:"ASCII",3072:"SHORT",3073:"ASCII",33550:"DOUBLE",33922:"DOUBLE",34264:"DOUBLE",34665:"LONG",34735:"SHORT",34736:"DOUBLE",34737:"ASCII",42113:"ASCII"},o=[n.BitsPerSample,n.ExtraSamples,n.SampleFormat,n.StripByteCounts,n.StripOffsets,n.StripRowCounts,n.TileByteCounts,n.TileOffsets,n.SubIFDs],a={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},l={};for(let e in a)a.hasOwnProperty(e)&&(l[a[e]]=parseInt(e,10));let h={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},u={Unspecified:0,Assocalpha:1,Unassalpha:2},c={Version:0,AddCompression:1},f={None:0,Deflate:1,Zstandard:2},d={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},g={};for(let e in d)d.hasOwnProperty(e)&&(g[d[e]]=parseInt(e,10))}),a("2VZyk",function(e,t){var r=o("2ozqO");e.exports=r("fgxHO").then(()=>o("daaRW"))}),a("2ozqO",function(e,t){e.exports=function(e){return import(o("dRo73").resolve(e))}}),a("1yNwl",function(e,t){var r=o("2ozqO");e.exports=r("fXhwo").then(()=>o("3yMw0"))}),a("hiNb9",function(e,t){var r=o("2ozqO");e.exports=r("cEWB9").then(()=>o("740cf"))}),a("gYFK8",function(e,t){var r=o("2ozqO");e.exports=Promise.all([r("9HB33"),r("enAad")]).then(()=>o("7fGLp"))}),a("N2ToI",function(e,t){var r=o("2ozqO");e.exports=r("aJe6p").then(()=>o("hdQ3q"))}),a("impMa",function(e,t){var r=o("2ozqO");e.exports=Promise.all([r("9HB33"),r("f5Wvo"),r("bpIsf")]).then(()=>o("9826s"))}),a("bsV9v",function(e,t){var r=o("2ozqO");e.exports=r("1Il8L").then(()=>o("bdsa4"))}),a("3U9Cw",function(e,t){var r=o("2ozqO");e.exports=Promise.all([r("f5Wvo"),r("9bOLy")]).then(()=>o("hUE3H"))}),a("9Mq5w",function(e,t){var r,i,n,s=e.exports={};function o(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var h=[],u=!1,c=-1;function f(){u&&n&&(u=!1,n.length?h=n.concat(h):c=-1,h.length&&d())}function d(){if(!u){var e=l(f);u=!0;for(var t=h.length;t;){for(n=h,h=[];++c<t;)n&&n[c].run();c=-1,t=h.length}n=null,u=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function p(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];h.push(new g(e,t)),1!==h.length||u||l(d)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=p,s.addListener=p,s.once=p,s.off=p,s.removeListener=p,s.removeAllListeners=p,s.emit=p,s.prependListener=p,s.prependOnceListener=p,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}),a("agEcb",function(e,t){function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),o("cvawf");var l=o("gbCDL"),h=o("g0oXy"),u=o("7xQTT"),c=o("dAsIA"),f=o("3oUFG"),d=o("avk8s"),f=o("3oUFG");o("2q51R");var d=o("avk8s");function g(e,t,r){let i=(0,f.newParsingContext)();return i.style=e.style,(0,d.buildExpression)(t,r,i,e)}function p(e,t){let r=`
    attribute vec2 ${c.Attributes.TEXTURE_COORD};
    uniform mat4 ${c.Uniforms.TILE_TRANSFORM};
    uniform float ${c.Uniforms.TEXTURE_PIXEL_WIDTH};
    uniform float ${c.Uniforms.TEXTURE_PIXEL_HEIGHT};
    uniform float ${c.Uniforms.TEXTURE_RESOLUTION};
    uniform float ${c.Uniforms.TEXTURE_ORIGIN_X};
    uniform float ${c.Uniforms.TEXTURE_ORIGIN_Y};
    uniform float ${c.Uniforms.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${c.Attributes.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${c.Uniforms.TEXTURE_ORIGIN_X} + ${c.Uniforms.TEXTURE_RESOLUTION} * ${c.Uniforms.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${c.Uniforms.TEXTURE_ORIGIN_Y} - ${c.Uniforms.TEXTURE_RESOLUTION} * ${c.Uniforms.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${c.Uniforms.TILE_TRANSFORM} * vec4(${c.Attributes.TEXTURE_COORD}, ${c.Uniforms.DEPTH}, 1.0);
    }
  `,i={...(0,d.newCompilationContext)(),inFragmentShader:!0,bandCount:t,style:e},n=[];if(void 0!==e.color){let t=g(i,e.color,f.ColorType);n.push(`color = ${t};`)}if(void 0!==e.contrast){let t=g(i,e.contrast,f.NumberType);n.push(`color.rgb = clamp((${t} + 1.0) * color.rgb - (${t} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(void 0!==e.exposure){let t=g(i,e.exposure,f.NumberType);n.push(`color.rgb = clamp((${t} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(void 0!==e.saturation){let t=g(i,e.saturation,f.NumberType);n.push(`
      float saturation = ${t} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(void 0!==e.gamma){let t=g(i,e.gamma,f.NumberType);n.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${t}));`)}if(void 0!==e.brightness){let t=g(i,e.brightness,f.NumberType);n.push(`color.rgb = clamp(color.rgb + ${t}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}let s={},o=Object.keys(i.variables).length;if(o>1&&!e.variables)throw Error(`Missing variables in style (expected ${i.variables})`);for(let t=0;t<o;++t){let r=i.variables[Object.keys(i.variables)[t]];if(!(r.name in e.variables))throw Error(`Missing '${r.name}' in style variables`);s[(0,d.uniformNameForVariable)(r.name)]=function(){let t=e.variables[r.name];return"string"==typeof t&&(t=(0,d.getStringNumberEquivalent)(t)),void 0!==t?t:-9999999}}let a=Object.keys(s).map(function(e){return`uniform float ${e};`});a.push(`uniform sampler2D ${c.Uniforms.TILE_TEXTURE_ARRAY}[${Math.ceil(t/4)}];`),i.paletteTextures&&a.push(`uniform sampler2D ${d.PALETTE_TEXTURE_ARRAY}[${i.paletteTextures.length}];`);let l=Object.keys(i.functions).map(function(e){return i.functions[e]});return{vertexShader:r,fragmentShader:`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${c.Uniforms.RENDER_EXTENT};
    uniform float ${c.Uniforms.TRANSITION_ALPHA};
    uniform float ${c.Uniforms.TEXTURE_PIXEL_WIDTH};
    uniform float ${c.Uniforms.TEXTURE_PIXEL_HEIGHT};
    uniform float ${c.Uniforms.RESOLUTION};
    uniform float ${c.Uniforms.ZOOM};

    ${a.join("\n")}

    ${l.join("\n")}

    void main() {
      if (
        v_mapCoord[0] < ${c.Uniforms.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${c.Uniforms.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${c.Uniforms.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${c.Uniforms.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${c.Uniforms.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${n.join("\n")}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${c.Uniforms.TRANSITION_ALPHA};
    }`,uniforms:s,paletteTextures:i.paletteTextures}}o("lqNjm");class y extends h.default{constructor(e){let t=(e=e?Object.assign({},e):{}).style||{};delete e.style;let r=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.cacheSize_=r,this.styleVariables_=this.style_.variables||{},this.addChangeListener(u.default.SOURCE,this.handleSourceUpdate_)}getSources(e,t){let r=this.getSource();return this.sources_?"function"==typeof this.sources_?this.sources_(e,t):this.sources_:r?[r]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){let e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){let e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){let e=p(this.style_,this.getSourceBandCount_());return new c.default(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,t){let r;let i=this.getRenderer();for(let n=0,s=t.length;n<s;++n)this.renderedSource_=t[n],i.prepareFrame(e)&&(r=i.renderFrame(e));return r}render(e,t){this.rendered=!0;let r=e.viewState,i=this.getSources(e.extent,r.resolution),n=!0;for(let e=0,t=i.length;e<t;++e){let t=i[e],r=t.getState();if("loading"==r){let e=()=>{"ready"==t.getState()&&(t.removeEventListener("change",e),this.changed())};t.addEventListener("change",e)}n=n&&"ready"==r}let s=this.renderSources(e,i);if(this.getRenderer().renderComplete&&n)return this.renderedResolution_=r.resolution,s;if(this.renderedResolution_>.5*r.resolution){let t=this.getSources(e.extent,this.renderedResolution_).filter(e=>!i.includes(e));if(t.length>0)return this.renderSources(e,t)}return s}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;let t=p(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}y.prototype.dispose;var m=o("hyFBJ"),w=o("cw4dl"),T=o("fNlm8"),S=o("85w1a"),b=o("65P3L"),_=o("cpPSZ"),E=o("av38f"),I=o("5NhYx"),A=o("gzr8q"),v=o("9YraL"),x=o("lVQul"),R=o("eQaCk"),C=o("6BjcK");class P extends _.default{constructor(e){let t=void 0===e.projection?"EPSG:3857":e.projection,r=e.tileGrid;void 0===r&&t&&(r=(0,I.createXYZ)({extent:(0,I.extentFromProjection)(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:r,opaque:e.opaque,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate}),this.gutter_=void 0!==e.gutter?e.gutter:0,this.tileSize_=e.tileSize?(0,C.toSize)(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=void 0===e.bandCount?4:e.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;let t=this.getTileGrid();return t?(0,C.toSize)(t.getTileSize(e)):[256,256]}getGutterForProjection(e){let t=this.getProjection();return!t||(0,A.equivalent)(t,e)?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,r,i,n){let s=this.getTileCacheForProjection(i),o=(0,v.getKeyZXY)(e,t,r);if(s.containsKey(o)){let e=s.get(o);if(e&&e.key==this.getKey())return e}let a=this.getTileGrid(),l=Math.max.apply(null,a.getResolutions().map((e,t)=>{let r=(0,C.toSize)(a.getTileSize(t)),i=this.getTileSize(t);return Math.max(i[0]/r[0],i[1]/r[1])})),h=this.getTileGridForProjection(n),u=this.getTileGridForProjection(i),c=[e,t,r],f=this.getTileCoordForTileUrlFunction(c,i),d=Object.assign({sourceProj:n,sourceTileGrid:h,targetProj:i,targetTileGrid:u,tileCoord:c,wrappedTileCoord:f,pixelRatio:l,gutter:this.getGutterForProjection(n),getTileFunction:(e,t,r,i)=>this.getTile(e,t,r,i,n)},this.tileOptions),g=new T.default(d);return g.key=this.getKey(),g}getTile(e,t,r,i,n){let s=this.getProjection();if(s&&n&&!(0,A.equivalent)(s,n))return this.getReprojTile_(e,t,r,n,s);let o=this.getTileSize(e),a=(0,v.getKeyZXY)(e,t,r);if(this.tileCache.containsKey(a))return this.tileCache.get(a);let l=this.loader_,h=Object.assign({tileCoord:[e,t,r],loader:function(){return(0,R.toPromise)(function(){return l(e,t,r)})},size:o},this.tileOptions),u=new m.default(h);return u.key=this.getKey(),u.addEventListener(w.default.CHANGE,this.handleTileChange_),this.tileCache.set(a,u),u}handleTileChange_(e){let t;let r=e.target,i=(0,x.getUid)(r),n=r.getState();n==E.default.LOADING?(this.tileLoadingKeys_[i]=!0,t=b.default.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],t=n==E.default.ERROR?b.default.TILELOADERROR:n==E.default.LOADED?b.default.TILELOADEND:void 0),t&&this.dispatchEvent(new _.TileSourceEvent(t,r))}getTileGridForProjection(e){let t=this.getProjection();if(this.tileGrid&&(!t||(0,A.equivalent)(t,e)))return this.tileGrid;let r=(0,x.getUid)(e);return r in this.tileGridForProjection_||(this.tileGridForProjection_[r]=(0,I.getForProjection)(e)),this.tileGridForProjection_[r]}setTileGridForProjection(e,t){let r=(0,A.get)(e);if(r){let e=(0,x.getUid)(r);e in this.tileGridForProjection_||(this.tileGridForProjection_[e]=t)}}getTileCacheForProjection(e){let t=this.getProjection();if(!t||(0,A.equivalent)(t,e))return this.tileCache;let r=(0,x.getUid)(e);return r in this.tileCacheForProjection_||(this.tileCacheForProjection_[r]=new S.default(.1)),this.tileCacheForProjection_[r]}expireCache(e,t){let r=this.getTileCacheForProjection(e);for(let e in this.tileCache.expireCache(this.tileCache==r?t:{}),this.tileCacheForProjection_){let i=this.tileCacheForProjection_[e];i.expireCache(i==r?t:{})}}clear(){for(let e in super.clear(),this.tileCacheForProjection_)this.tileCacheForProjection_[e].clear()}}var O=P,D=o("co8nU"),F=o("eRhGG");const U=new Map;function G(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>U.set(e,t))}async function M(e){let t=U.get(e.Compression);if(!t)throw Error(`Unknown compression method identifier: ${e.Compression}`);return new(await t())(e)}G([void 0,1],()=>o("2VZyk").then(e=>e.default)),G(5,()=>o("1yNwl").then(e=>e.default)),G(6,()=>{throw Error("old style JPEG compression is not supported.")}),G(7,()=>o("hiNb9").then(e=>e.default)),G([8,32946],()=>o("gYFK8").then(e=>e.default)),G(32773,()=>o("N2ToI").then(e=>e.default)),G(34887,()=>o("impMa").then(async e=>(await e.zstd.init(),e)).then(e=>e.default)),G(50001,()=>o("bsV9v").then(e=>e.default));const L="undefined"!=typeof navigator&&navigator.hardwareConcurrency||2;var k=class{constructor(e=L,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(e=>{o("3U9Cw").then(t=>{e(t.create)})}),this._awaitingDecoder.then(t=>{this._awaitingDecoder=null,this.workers=[];for(let r=0;r<e;r++)this.workers.push({worker:t(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,0===this.size?M(e).then(r=>r.decode(e,t)):new Promise(r=>{let i=this.workers.find(e=>e.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;let n=this.messageId++,s=e=>{e.data.id===n&&(i.idle=!0,r(e.data.decoded),i.worker.removeEventListener("message",s))};i.worker.addEventListener("message",s),i.worker.postMessage({fileDirectory:e,buffer:t,id:n},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}};const N="This constructor is not a subclass of Float16Array",j="The constructor property value is not an object",z="Attempting to access detached ArrayBuffer",B="Cannot convert undefined or null to object",V="Cannot mix BigInt and other types, use explicit conversions",K="@@iterator property is not callable",H="Reduce of empty array with no initial value",$="Offset is out of bounds";function q(e){return(t,...r)=>W(e,t,r)}function X(e,t){return q(Q(e,t).get)}const{apply:W,construct:Y,defineProperty:Z,get:J,getOwnPropertyDescriptor:Q,getPrototypeOf:ee,has:et,ownKeys:er,set:ei,setPrototypeOf:en}=Reflect,es=Proxy,{EPSILON:eo,MAX_SAFE_INTEGER:ea,isFinite:el,isNaN:eh}=Number,{iterator:eu,species:ec,toStringTag:ef,for:ed}=Symbol,eg=Object,{create:ep,defineProperty:ey,freeze:em,is:ew}=eg,eT=eg.prototype,eS=eT.__lookupGetter__?q(eT.__lookupGetter__):(e,t)=>{if(null==e)throw tn(B);let r=eg(e);do{let e=Q(r,t);if(void 0!==e){if(eb(e,"get"))return e.get;return}}while(null!==(r=ee(r)))},eb=eg.hasOwn||q(eT.hasOwnProperty),e_=Array,eE=e_.isArray,eI=e_.prototype,eA=q(eI.join),ev=q(eI.push),ex=q(eI.toLocaleString),eR=eI[eu],eC=q(eR),{abs:eP,trunc:eO}=Math,eD=ArrayBuffer,eF=eD.isView,eU=eD.prototype,eG=q(eU.slice),eM=X(eU,"byteLength"),eL="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null,ek=eL&&X(eL.prototype,"byteLength"),eN=ee(Uint8Array),ej=eN.from,ez=eN.prototype,eB=ez[eu],eV=q(ez.keys),eK=q(ez.values),eH=q(ez.entries),e$=q(ez.set),eq=q(ez.reverse),eX=q(ez.fill),eW=q(ez.copyWithin),eY=q(ez.sort),eZ=q(ez.slice),eJ=q(ez.subarray),eQ=X(ez,"buffer"),e0=X(ez,"byteOffset"),e1=X(ez,"length"),e2=X(ez,ef),e3=Uint8Array,e6=Uint16Array,e4=(...e)=>W(ej,e6,e),e5=Uint32Array,e8=Float32Array,e7=ee([][eu]()),e9=q(e7.next),te=q(function*(){}().next),tt=ee(e7),tr=DataView.prototype,ti=q(tr.getUint16);q(tr.setUint16);const tn=TypeError,ts=RangeError,to=WeakSet,ta=to.prototype,tl=q(ta.add),th=q(ta.has),tu=WeakMap,tc=tu.prototype,tf=q(tc.get),td=q(tc.has),tg=q(tc.set),tp=new tu,ty=ep(null,{next:{value:function(){return e9(tf(tp,this))}},[eu]:{value:function(){return this}}});function tm(e){if(e[eu]===eR&&e7.next===e9)return e;let t=ep(ty);return tg(tp,t,eC(e)),t}const tw=new tu,tT=ep(tt,{next:{value:function(){return te(tf(tw,this))},writable:!0,configurable:!0}});for(const e of er(e7))"next"!==e&&ey(tT,e,Q(e7,e));function tS(e){let t=ep(tT);return tg(tw,t,e),t}function tb(e){return null!==e&&"object"==typeof e||"function"==typeof e}function t_(e){return null!==e&&"object"==typeof e}function tE(e){return void 0!==e2(e)}function tI(e){let t=e2(e);return"BigInt64Array"===t||"BigUint64Array"===t}function tA(e){if(null===eL)return!1;try{return ek(e),!0}catch(e){return!1}}function tv(e){return!!eE(e)&&e[eu]===eR&&e7.next===e9}function tx(e){if("string"!=typeof e)return!1;let t=+e;return!!(e===t+""&&el(t))&&t===eO(t)}const tR=ed("__Float16Array__"),tC=1/eo,tP=9765625e-10*tC,tO=new eD(4),tD=new e8(tO),tF=new e5(tO),tU=new e6(512),tG=new e3(512);for(let e=0;e<256;++e){let t=e-127;t<-27?(tU[e]=0,tU[256|e]=32768,tG[e]=24,tG[256|e]=24):t<-14?(tU[e]=1024>>-t-14,tU[256|e]=1024>>-t-14|32768,tG[e]=-t-1,tG[256|e]=-t-1):t<=15?(tU[e]=t+15<<10,tU[256|e]=t+15<<10|32768,tG[e]=13,tG[256|e]=13):t<128?(tU[e]=31744,tU[256|e]=64512,tG[e]=24,tG[256|e]=24):(tU[e]=31744,tU[256|e]=64512,tG[e]=13,tG[256|e]=13)}function tM(e){tD[0]=function(e){let t=+e;if(!el(t)||0===t)return t;let r=t>0?1:-1,i=eP(t);if(i<6103515625e-14)return r*(i/5960464477539063e-23+tC-tC)*5960464477539063e-23;let n=(1+tP)*i,s=n-(n-i);return s>65504||eh(s)?1/0*r:r*s}(e);let t=tF[0],r=t>>23&511;return tU[r]+((8388607&t)>>tG[r])}const tL=new e5(2048);for(let e=1;e<1024;++e){let t=e<<13,r=0;for(;(8388608&t)==0;)t<<=1,r-=8388608;t&=-8388609,r+=947912704,tL[e]=t|r}for(let e=1024;e<2048;++e)tL[e]=939524096+(e-1024<<13);const tk=new e5(64);for(let e=1;e<31;++e)tk[e]=e<<23;tk[31]=1199570944,tk[32]=2147483648;for(let e=33;e<63;++e)tk[e]=2147483648+(e-32<<23);tk[63]=3347054592;const tN=new e6(64);for(let e=1;e<64;++e)32!==e&&(tN[e]=1024);function tj(e){let t=e>>10;return tF[0]=tL[tN[t]+(1023&e)]+tk[t],tD[0]}function tz(e){let t=+e;return eh(t)||0===t?0:eO(t)}function tB(e){let t=tz(e);return t<0?0:t<ea?t:ea}function tV(e,t){if(!tb(e))throw tn("This is not an object");let r=e.constructor;if(void 0===r)return t;if(!tb(r))throw tn(j);let i=r[ec];return null==i?t:i}function tK(e){if(tA(e))return!1;try{return eG(e,0,0),!1}catch(e){}return!0}function tH(e,t){let r=eh(e),i=eh(t);if(r&&i)return 0;if(r)return 1;if(i||e<t)return -1;if(e>t)return 1;if(0===e&&0===t){let r=ew(e,0),i=ew(t,0);if(!r&&i)return -1;if(r&&!i)return 1}return 0}const t$=new tu;function tq(e){return td(t$,e)||!eF(e)&&function(e){if(!t_(e))return!1;let t=ee(e);if(!t_(t))return!1;let r=t.constructor;if(void 0===r)return!1;if(!tb(r))throw tn(j);return et(r,tR)}(e)}function tX(e){if(!tq(e))throw tn("This is not a Float16Array object")}function tW(e,t){let r=tq(e),i=tE(e);if(!r&&!i)throw tn("Species constructor didn't return TypedArray object");if("number"==typeof t&&(r?e1(tY(e)):e1(e))<t)throw tn("Derived constructor created TypedArray object which was too small length");if(tI(e))throw tn(V)}function tY(e){let t=tf(t$,e);if(void 0!==t){if(tK(eQ(t)))throw tn(z);return t}let r=e.buffer;if(tK(r))throw tn(z);return tf(t$,Y(t0,[r,e.byteOffset,e.length],e.constructor))}function tZ(e){let t=e1(e),r=[];for(let i=0;i<t;++i)r[i]=tj(e[i]);return r}const tJ=new to;for(const e of er(ez)){if(e===ef)continue;let t=Q(ez,e);eb(t,"get")&&"function"==typeof t.get&&tl(tJ,t.get)}const tQ=em({get:(e,t,r)=>tx(t)&&eb(e,t)?tj(J(e,t)):th(tJ,eS(e,t))?J(e,t):J(e,t,r),set:(e,t,r,i)=>tx(t)&&eb(e,t)?ei(e,t,tM(r)):ei(e,t,r,i),getOwnPropertyDescriptor(e,t){if(tx(t)&&eb(e,t)){let r=Q(e,t);return r.value=tj(r.value),r}return Q(e,t)},defineProperty:(e,t,r)=>(tx(t)&&eb(e,t)&&eb(r,"value")&&(r.value=tM(r.value)),Z(e,t,r))});class t0{constructor(e,t,r){let i;if(tq(e))i=Y(e6,[tY(e)],new.target);else if(tb(e)&&!(function(e){try{return eM(e),!0}catch(e){return!1}}(e)||tA(e))){let t,r;if(tE(e)){if(t=e,r=e1(e),tK(eQ(e)))throw tn(z);if(tI(e))throw tn(V);i=Y(e6,[new eD(2*r)],new.target)}else{let n=e[eu];if(null!=n&&"function"!=typeof n)throw tn(K);null!=n?tv(e)?(t=e,r=e.length):r=(t=[...e]).length:r=tB((t=e).length),i=Y(e6,[r],new.target)}for(let e=0;e<r;++e)i[e]=tM(t[e])}else i=Y(e6,arguments,new.target);let n=new es(i,tQ);return tg(t$,n,i),n}static from(e,...t){let r,i;if(!et(this,tR))throw tn(N);if(this===t0){if(tq(e)&&0===t.length){let t=tY(e),r=new e6(eQ(t),e0(t),e1(t));return new t0(eQ(eZ(r)))}if(0===t.length)return new t0(eQ(e4(e,tM)));let r=t[0];return new t0(eQ(e4(e,function(e,...t){return tM(W(r,this,[e,...tm(t)]))},t[1])))}let n=e[eu];if(null!=n&&"function"!=typeof n)throw tn(K);if(null!=n)tv(e)?(r=e,i=e.length):(tE(e)?e[eu]!==eB||e7.next!==e9:1)?i=(r=[...e]).length:(r=e,i=e1(e));else{if(null==e)throw tn(B);i=tB((r=eg(e)).length)}let s=new this(i);if(0===t.length)for(let e=0;e<i;++e)s[e]=r[e];else{let e=t[0],n=t[1];for(let t=0;t<i;++t)s[t]=W(e,n,[r[t],t])}return s}static of(...e){if(!et(this,tR))throw tn(N);let t=e.length;if(this===t0){let r=new t0(t),i=tY(r);for(let r=0;r<t;++r)i[r]=tM(e[r]);return r}let r=new this(t);for(let i=0;i<t;++i)r[i]=e[i];return r}keys(){return tX(this),eV(tY(this))}values(){tX(this);let e=tY(this);return tS(function*(){for(let t of eK(e))yield tj(t)}())}entries(){tX(this);let e=tY(this);return tS(function*(){for(let[t,r]of eH(e))yield[t,tj(r)]}())}at(e){tX(this);let t=tY(this),r=e1(t),i=tz(e),n=i>=0?i:r+i;if(!(n<0)&&!(n>=r))return tj(t[n])}with(e,t){tX(this);let r=tY(this),i=e1(r),n=tz(e),s=n>=0?n:i+n;if(s<0||s>=i)throw ts($);let o=new e6(eQ(r),e0(r),e1(r)),a=new t0(eQ(eZ(o)));return tY(a)[s]=tM(+t),a}map(e,...t){tX(this);let r=tY(this),i=e1(r),n=t[0],s=tV(r,t0);if(s===t0){let t=new t0(i),s=tY(t);for(let t=0;t<i;++t){let i=tj(r[t]);s[t]=tM(W(e,n,[i,t,this]))}return t}let o=new s(i);tW(o,i);for(let t=0;t<i;++t){let i=tj(r[t]);o[t]=W(e,n,[i,t,this])}return o}filter(e,...t){tX(this);let r=tY(this),i=e1(r),n=t[0],s=[];for(let t=0;t<i;++t){let i=tj(r[t]);W(e,n,[i,t,this])&&ev(s,i)}let o=new(tV(r,t0))(s);return tW(o),o}reduce(e,...t){let r,i;tX(this);let n=tY(this),s=e1(n);if(0===s&&0===t.length)throw tn(H);0===t.length?(r=tj(n[0]),i=1):(r=t[0],i=0);for(let t=i;t<s;++t)r=e(r,tj(n[t]),t,this);return r}reduceRight(e,...t){let r,i;tX(this);let n=tY(this),s=e1(n);if(0===s&&0===t.length)throw tn(H);0===t.length?(r=tj(n[s-1]),i=s-2):(r=t[0],i=s-1);for(let t=i;t>=0;--t)r=e(r,tj(n[t]),t,this);return r}forEach(e,...t){tX(this);let r=tY(this),i=e1(r),n=t[0];for(let t=0;t<i;++t)W(e,n,[tj(r[t]),t,this])}find(e,...t){tX(this);let r=tY(this),i=e1(r),n=t[0];for(let t=0;t<i;++t){let i=tj(r[t]);if(W(e,n,[i,t,this]))return i}}findIndex(e,...t){tX(this);let r=tY(this),i=e1(r),n=t[0];for(let t=0;t<i;++t)if(W(e,n,[tj(r[t]),t,this]))return t;return -1}findLast(e,...t){tX(this);let r=tY(this),i=e1(r),n=t[0];for(let t=i-1;t>=0;--t){let i=tj(r[t]);if(W(e,n,[i,t,this]))return i}}findLastIndex(e,...t){tX(this);let r=tY(this),i=e1(r),n=t[0];for(let t=i-1;t>=0;--t)if(W(e,n,[tj(r[t]),t,this]))return t;return -1}every(e,...t){tX(this);let r=tY(this),i=e1(r),n=t[0];for(let t=0;t<i;++t)if(!W(e,n,[tj(r[t]),t,this]))return!1;return!0}some(e,...t){tX(this);let r=tY(this),i=e1(r),n=t[0];for(let t=0;t<i;++t)if(W(e,n,[tj(r[t]),t,this]))return!0;return!1}set(e,...t){tX(this);let r=tY(this),i=tz(t[0]);if(i<0)throw ts($);if(null==e)throw tn(B);if(tI(e))throw tn(V);if(tq(e))return e$(tY(this),tY(e),i);if(tE(e)&&tK(eQ(e)))throw tn(z);let n=e1(r),s=eg(e),o=tB(s.length);if(i===1/0||o+i>n)throw ts($);for(let e=0;e<o;++e)r[e+i]=tM(s[e])}reverse(){return tX(this),eq(tY(this)),this}toReversed(){tX(this);let e=tY(this),t=new e6(eQ(e),e0(e),e1(e)),r=new t0(eQ(eZ(t)));return eq(tY(r)),r}fill(e,...t){return tX(this),eX(tY(this),tM(e),...tm(t)),this}copyWithin(e,t,...r){return tX(this),eW(tY(this),e,t,...tm(r)),this}sort(e){tX(this);let t=tY(this),r=void 0!==e?e:tH;return eY(t,(e,t)=>r(tj(e),tj(t))),this}toSorted(e){tX(this);let t=tY(this);if(void 0!==e&&"function"!=typeof e)throw new tn("The comparison function must be either a function or undefined");let r=void 0!==e?e:tH,i=new e6(eQ(t),e0(t),e1(t)),n=new t0(eQ(eZ(i)));return eY(tY(n),(e,t)=>r(tj(e),tj(t))),n}slice(e,t){let r,i;tX(this);let n=tY(this),s=tV(n,t0);if(s===t0){let r=new e6(eQ(n),e0(n),e1(n));return new t0(eQ(eZ(r,e,t)))}let o=e1(n),a=tz(e),l=void 0===t?o:tz(t);r=a===-1/0?0:a<0?o+a>0?o+a:0:o<a?o:a;let h=(i=l===-1/0?0:l<0?o+l>0?o+l:0:o<l?o:l)-r>0?i-r:0,u=new s(h);if(tW(u,h),0===h)return u;if(tK(eQ(n)))throw tn(z);let c=0;for(;r<i;)u[c]=tj(n[r]),++r,++c;return u}subarray(e,t){tX(this);let r=tY(this),i=tV(r,t0),n=eJ(new e6(eQ(r),e0(r),e1(r)),e,t),s=new i(eQ(n),e0(n),e1(n));return tW(s),s}indexOf(e,...t){tX(this);let r=tY(this),i=e1(r),n=tz(t[0]);if(n===1/0)return -1;n<0&&(n+=i)<0&&(n=0);for(let t=n;t<i;++t)if(eb(r,t)&&tj(r[t])===e)return t;return -1}lastIndexOf(e,...t){tX(this);let r=tY(this),i=e1(r),n=t.length>=1?tz(t[0]):i-1;if(n===-1/0)return -1;n>=0?n=n<i-1?n:i-1:n+=i;for(let t=n;t>=0;--t)if(eb(r,t)&&tj(r[t])===e)return t;return -1}includes(e,...t){tX(this);let r=tY(this),i=e1(r),n=tz(t[0]);if(n===1/0)return!1;n<0&&(n+=i)<0&&(n=0);let s=eh(e);for(let t=n;t<i;++t){let i=tj(r[t]);if(s&&eh(i)||i===e)return!0}return!1}join(e){return tX(this),eA(tZ(tY(this)),e)}toLocaleString(...e){return tX(this),ex(tZ(tY(this)),...tm(e))}get[ef](){if(tq(this))return"Float16Array"}}ey(t0,"BYTES_PER_ELEMENT",{value:2}),ey(t0,tR,{}),en(t0,eN);const t1=t0.prototype;ey(t1,"BYTES_PER_ELEMENT",{value:2}),ey(t1,eu,{value:t1.values,writable:!0,configurable:!0}),en(t1,ez);var t2={};function t3(e,t,r){let i=r&&r.debug||!1;i&&console.log("[xml-utils] getting "+t+" in "+e);let n="object"==typeof e?e.outer:e,s=n.slice(0,n.indexOf(">")+1),o=['"',"'"];for(let e=0;e<o.length;e++){let r=o[e],n=t+"\\="+r+"([^"+r+"]*)"+r;i&&console.log("[xml-utils] pattern:",n);let a=new RegExp(n).exec(s);if(i&&console.log("[xml-utils] match:",a),a)return a[1]}}(t2=t3).default=t3;var t6={},t4={},t5={};function t8(e,t,r){let i=new RegExp(t).exec(e.slice(r));return i?r+i.index:-1}(t5=t8).default=t8;var t7={};function t9(e,t,r){let i=new RegExp(t).exec(e.slice(r));return i?r+i.index+i[0].length-1:-1}(t7=t9).default=t9;var re={};function rt(e,t){let r=RegExp(t,"g"),i=e.match(r);return i?i.length:0}function rr(e,t,r){let i=r&&r.debug||!1,n=(r&&r.nested,!0),s=r&&r.startIndex||0;i&&console.log("[xml-utils] starting findTagByName with",t," and ",r);let o=t5(e,`<${t}[ 
>/]`,s);if(i&&console.log("[xml-utils] start:",o),-1===o)return;let a=e.slice(o+t.length),l=t7(a,"^[^<]*[ /]>",0),h=-1!==l&&"/"===a[l-1];if(i&&console.log("[xml-utils] selfClosing:",h),!1===h){if(n){let e=0,r=1,i=0;for(;-1!==(l=t7(a,"[ /]"+t+">",e));){let n=a.substring(e,l+1);if(r+=re(n,"<"+t+"[ \n	>]"),(i+=re(n,"</"+t+">"))>=r)break;e=l}}else l=t7(a,"[ /]"+t+">",0)}let u=o+t.length+l+1;if(i&&console.log("[xml-utils] end:",u),-1===u)return;let c=e.slice(o,u);return{inner:h?null:c.slice(c.indexOf(">")+1,c.lastIndexOf("<")),outer:c,start:o,end:u}}function ri(e,t,r){let i;let n=[],s=r&&r.debug||!1,o=!r||"boolean"!=typeof r.nested||r.nested,a=r&&r.startIndex||0;for(;i=t4(e,t,{debug:s,startIndex:a});)a=o?i.start+1+t.length:i.end,n.push(i);return s&&console.log("findTagsByName found",n.length,"tags"),n}(re=rt).default=rt,(t4=rr).default=rr,(t6=ri).default=ri;var F=o("eRhGG");function rn(e,t,r,i=1){return new(Object.getPrototypeOf(e)).constructor(t*r*i)}function rs(e,t,r){switch(e){case 1:if(t<=8)return new Uint8Array(r);if(t<=16)return new Uint16Array(r);if(t<=32)return new Uint32Array(r);break;case 2:if(8===t)return new Int8Array(r);if(16===t)return new Int16Array(r);if(32===t)return new Int32Array(r);break;case 3:switch(t){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r)}}throw Error("Unsupported data format/bitsPerSample")}var ro=class{constructor(e,t,r,i,n,s){this.fileDirectory=e,this.geoKeys=t,this.dataView=r,this.littleEndian=i,this.tiles=n?{}:null,this.isTiled=!e.StripOffsets;let o=e.PlanarConfiguration;if(this.planarConfiguration=void 0===o?1:o,1!==this.planarConfiguration&&2!==this.planarConfiguration)throw Error("Invalid planar configuration.");this.source=s}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return void 0!==this.fileDirectory.SamplesPerPixel?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:void 0!==this.fileDirectory.RowsPerStrip?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){let t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,r=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(r<=8)return DataView.prototype.getUint8;if(r<=16)return DataView.prototype.getUint16;if(r<=32)return DataView.prototype.getUint32;break;case 2:if(r<=8)return DataView.prototype.getInt8;if(r<=16)return DataView.prototype.getInt16;if(r<=32)return DataView.prototype.getInt32;break;case 3:switch(r){case 16:return function(e,t){return function(e,t,...r){return tj(ti(e,t,...tm(r)))}(this,e,t)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){return rs(this.getSampleFormat(e),this.getBitsPerSample(e),t)}async getTileOrStrip(e,t,r,i,n){let s,o,a,l;let h=Math.ceil(this.getWidth()/this.getTileWidth()),u=Math.ceil(this.getHeight()/this.getTileHeight()),{tiles:c}=this;1===this.planarConfiguration?s=t*h+e:2===this.planarConfiguration&&(s=r*h*u+t*h+e),this.isTiled?(o=this.fileDirectory.TileOffsets[s],a=this.fileDirectory.TileByteCounts[s]):(o=this.fileDirectory.StripOffsets[s],a=this.fileDirectory.StripByteCounts[s]);let f=(await this.source.fetch([{offset:o,length:a}],n))[0];return null!==c&&c[s]?l=c[s]:(l=(async()=>{let e=await i.decode(this.fileDirectory,f),r=this.getSampleFormat(),n=this.getBitsPerSample();return(1===r||2===r)&&n<=32&&n%8==0||3===r&&(16===n||32===n||64===n)||(e=function(e,t,r,i,n,s,o){let a=new DataView(e),l=2===r?1:i,h=rs(t,n,2===r?o*s:o*s*i),u=parseInt("1".repeat(n),2);if(1===t){let e=s*(1===r?i*n:n);(7&e)!=0&&(e=e+7&-8);for(let t=0;t<o;++t){let r=t*e;for(let e=0;e<s;++e){let i=r+e*l*n;for(let r=0;r<l;++r){let o=i+r*n,c=(t*s+e)*l+r,f=Math.floor(o/8),d=o%8;if(d+n<=8)h[c]=a.getUint8(f)>>8-n-d&u;else if(d+n<=16)h[c]=a.getUint16(f)>>16-n-d&u;else if(d+n<=24){let e=a.getUint16(f)<<8|a.getUint8(f+2);h[c]=e>>24-n-d&u}else h[c]=a.getUint32(f)>>32-n-d&u}}}}return h.buffer}(e,r,this.planarConfiguration,this.getSamplesPerPixel(),n,this.getTileWidth(),this.getBlockHeight(t))),e})(),null!==c&&(c[s]=l)),{x:e,y:t,sample:r,data:await l}}async _readRaster(e,t,r,i,n,s,o,a,l){let h=this.getTileWidth(),u=this.getTileHeight(),c=this.getWidth(),f=this.getHeight(),d=Math.max(Math.floor(e[0]/h),0),g=Math.min(Math.ceil(e[2]/h),Math.ceil(c/h)),p=Math.max(Math.floor(e[1]/u),0),y=Math.min(Math.ceil(e[3]/u),Math.ceil(f/u)),m=e[2]-e[0],w=this.getBytesPerPixel(),T=[],S=[];for(let e=0;e<t.length;++e)1===this.planarConfiguration?T.push(function(e,t,r){let i=0;for(let t=0;t<r;++t)i+=e[t];return i}(this.fileDirectory.BitsPerSample,0,t[e])/8):T.push(0),S.push(this.getReaderForSample(t[e]));let b=[],{littleEndian:_}=this;for(let s=p;s<y;++s)for(let o=d;o<g;++o){let a;1===this.planarConfiguration&&(a=this.getTileOrStrip(o,s,0,n,l));for(let d=0;d<t.length;++d){let g=d,p=t[d];2===this.planarConfiguration&&(w=this.getSampleByteSize(p),a=this.getTileOrStrip(o,s,p,n,l));let y=a.then(n=>{let s=n.data,o=new DataView(s),a=this.getBlockHeight(n.y),l=n.y*u,d=n.x*h,p=l+a,y=(n.x+1)*h,b=S[g],E=Math.min(a,a-(p-e[3]),f-l),I=Math.min(h,h-(y-e[2]),c-d);for(let n=Math.max(0,e[1]-l);n<E;++n)for(let s=Math.max(0,e[0]-d);s<I;++s){let a;let u=(n*h+s)*w,c=b.call(o,u+T[g],_);i?r[a=(n+l-e[1])*m*t.length+(s+d-e[0])*t.length+g]=c:(a=(n+l-e[1])*m+s+d-e[0],r[g][a]=c)}});b.push(y)}}if(await Promise.all(b),s&&e[2]-e[0]!==s||o&&e[3]-e[1]!==o){let n;return(n=i?function(e,t,r,i,n,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return function(e,t,r,i,n,s){let o=t/i,a=r/n,l=rn(e,i,n,s);for(let h=0;h<n;++h){let n=Math.min(Math.round(a*h),r-1);for(let r=0;r<i;++r){let a=Math.min(Math.round(o*r),t-1);for(let o=0;o<s;++o){let u=e[n*t*s+a*s+o];l[h*i*s+r*s+o]=u}}}return l}(e,t,r,i,n,s);case"bilinear":case"linear":return function(e,t,r,i,n,s){let o=t/i,a=r/n,l=rn(e,i,n,s);for(let f=0;f<n;++f){let n=a*f,d=Math.floor(n),g=Math.min(Math.ceil(n),r-1);for(let r=0;r<i;++r){let a=o*r,p=a%1,y=Math.floor(a),m=Math.min(Math.ceil(a),t-1);for(let o=0;o<s;++o){var h,u,c;let a=e[d*t*s+y*s+o],w=e[d*t*s+m*s+o],T=e[g*t*s+y*s+o],S=e[g*t*s+m*s+o],b=(h=(1-p)*a+p*w,u=(1-p)*T+p*S,(1-(c=n%1))*h+c*u);l[f*i*s+r*s+o]=b}}}return l}(e,t,r,i,n,s);default:throw Error(`Unsupported resampling method: '${o}'`)}}(r,e[2]-e[0],e[3]-e[1],s,o,t.length,a):function(e,t,r,i,n,s="nearest"){switch(s.toLowerCase()){case"nearest":return function(e,t,r,i,n){let s=t/i,o=r/n;return e.map(e=>{let a=rn(e,i,n);for(let l=0;l<n;++l){let n=Math.min(Math.round(o*l),r-1);for(let r=0;r<i;++r){let o=Math.min(Math.round(s*r),t-1),h=e[n*t+o];a[l*i+r]=h}}return a})}(e,t,r,i,n);case"bilinear":case"linear":return function(e,t,r,i,n){let s=t/i,o=r/n;return e.map(e=>{let a=rn(e,i,n);for(let c=0;c<n;++c){let n=o*c,f=Math.floor(n),d=Math.min(Math.ceil(n),r-1);for(let r=0;r<i;++r){var l,h,u;let o=s*r,g=o%1,p=Math.floor(o),y=Math.min(Math.ceil(o),t-1),m=e[f*t+p],w=e[f*t+y],T=e[d*t+p],S=e[d*t+y],b=(l=(1-g)*m+g*w,h=(1-g)*T+g*S,(1-(u=n%1))*l+u*h);a[c*i+r]=b}}return a})}(e,t,r,i,n);default:throw Error(`Unsupported resampling method: '${s}'`)}}(r,e[2]-e[0],e[3]-e[1],s,o,a)).width=s,n.height=o,n}return r.width=s||e[2]-e[0],r.height=o||e[3]-e[1],r}async readRasters({window:e,samples:t=[],interleave:r,pool:i=null,width:n,height:s,resampleMethod:o,fillValue:a,signal:l}={}){let h;let u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw Error("Invalid subsets");let c=(u[2]-u[0])*(u[3]-u[1]),f=this.getSamplesPerPixel();if(t&&t.length){for(let e=0;e<t.length;++e)if(t[e]>=f)return Promise.reject(RangeError(`Invalid sample index '${t[e]}'.`))}else for(let e=0;e<f;++e)t.push(e);if(r)h=rs(this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,Math.max.apply(null,this.fileDirectory.BitsPerSample),c*t.length),a&&h.fill(a);else{h=[];for(let e=0;e<t.length;++e){let r=this.getArrayForSample(t[e],c);Array.isArray(a)&&e<a.length?r.fill(a[e]):a&&!Array.isArray(a)&&r.fill(a),h.push(r)}}let d=i||await M(this.fileDirectory);return await this._readRaster(u,t,h,r,d,n,s,o,l)}async readRGB({window:e,interleave:t=!0,pool:r=null,width:i,height:n,resampleMethod:s,enableAlpha:o=!1,signal:a}={}){let l,h;let u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw Error("Invalid subsets");let c=this.fileDirectory.PhotometricInterpretation;if(c===F.photometricInterpretations.RGB){let l=[0,1,2];if(this.fileDirectory.ExtraSamples!==F.ExtraSamplesValues.Unspecified&&o){l=[];for(let e=0;e<this.fileDirectory.BitsPerSample.length;e+=1)l.push(e)}return this.readRasters({window:e,interleave:t,samples:l,pool:r,width:i,height:n,resampleMethod:s,signal:a})}switch(c){case F.photometricInterpretations.WhiteIsZero:case F.photometricInterpretations.BlackIsZero:case F.photometricInterpretations.Palette:l=[0];break;case F.photometricInterpretations.CMYK:l=[0,1,2,3];break;case F.photometricInterpretations.YCbCr:case F.photometricInterpretations.CIELab:l=[0,1,2];break;default:throw Error("Invalid or unsupported photometric interpretation.")}let f={window:u,interleave:!0,samples:l,pool:r,width:i,height:n,resampleMethod:s,signal:a},{fileDirectory:d}=this,g=await this.readRasters(f),p=2**this.fileDirectory.BitsPerSample[0];switch(c){case F.photometricInterpretations.WhiteIsZero:h=function(e,t){let r;let{width:i,height:n}=e,s=new Uint8Array(i*n*3);for(let i=0,n=0;i<e.length;++i,n+=3)r=256-e[i]/t*256,s[n]=r,s[n+1]=r,s[n+2]=r;return s}(g,p);break;case F.photometricInterpretations.BlackIsZero:h=function(e,t){let r;let{width:i,height:n}=e,s=new Uint8Array(i*n*3);for(let i=0,n=0;i<e.length;++i,n+=3)r=e[i]/t*256,s[n]=r,s[n+1]=r,s[n+2]=r;return s}(g,p);break;case F.photometricInterpretations.Palette:h=function(e,t){let{width:r,height:i}=e,n=new Uint8Array(r*i*3),s=t.length/3,o=t.length/3*2;for(let r=0,i=0;r<e.length;++r,i+=3){let a=e[r];n[i]=t[a]/65536*256,n[i+1]=t[a+s]/65536*256,n[i+2]=t[a+o]/65536*256}return n}(g,d.ColorMap);break;case F.photometricInterpretations.CMYK:h=function(e){let{width:t,height:r}=e,i=new Uint8Array(t*r*3);for(let t=0,r=0;t<e.length;t+=4,r+=3){let n=e[t],s=e[t+1],o=e[t+2],a=e[t+3];i[r]=(255-n)/256*255*((255-a)/256),i[r+1]=(255-s)/256*255*((255-a)/256),i[r+2]=(255-o)/256*255*((255-a)/256)}return i}(g);break;case F.photometricInterpretations.YCbCr:h=function(e){let{width:t,height:r}=e,i=new Uint8ClampedArray(t*r*3);for(let t=0,r=0;t<e.length;t+=3,r+=3){let n=e[t],s=e[t+1],o=e[t+2];i[r]=n+1.402*(o-128),i[r+1]=n-.34414*(s-128)-.71414*(o-128),i[r+2]=n+1.772*(s-128)}return i}(g);break;case F.photometricInterpretations.CIELab:h=function(e){let{width:t,height:r}=e,i=new Uint8Array(t*r*3);for(let t=0,r=0;t<e.length;t+=3,r+=3){let n,s,o;let a=e[t+0],l=e[t+1]<<24>>24,h=e[t+2]<<24>>24,u=(a+16)/116,c=l/500+u,f=u-h/200;n=(n=3.2406*(c=.95047*(c*c*c>.008856?c*c*c:(c-16/116)/7.787))+-1.5372*(u=1*(u*u*u>.008856?u*u*u:(u-16/116)/7.787))+-.4986*(f=1.08883*(f*f*f>.008856?f*f*f:(f-16/116)/7.787)))>.0031308?1.055*n**(1/2.4)-.055:12.92*n,s=(s=-.9689*c+1.8758*u+.0415*f)>.0031308?1.055*s**(1/2.4)-.055:12.92*s,o=(o=.0557*c+-.204*u+1.057*f)>.0031308?1.055*o**(1/2.4)-.055:12.92*o,i[r]=255*Math.max(0,Math.min(1,n)),i[r+1]=255*Math.max(0,Math.min(1,s)),i[r+2]=255*Math.max(0,Math.min(1,o))}return i}(g);break;default:throw Error("Unsupported photometric interpretation.")}if(!t){let e=new Uint8Array(h.length/3),t=new Uint8Array(h.length/3),r=new Uint8Array(h.length/3);for(let i=0,n=0;i<h.length;i+=3,++n)e[n]=h[i],t[n]=h[i+1],r[n]=h[i+2];h=[e,t,r]}return h.width=g.width,h.height=g.height,h}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];let e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){let t={};if(!this.fileDirectory.GDAL_METADATA)return null;let i=this.fileDirectory.GDAL_METADATA,n=r(t6)(i,"Item");n=null===e?n.filter(e=>void 0===r(t2)(e,"sample")):n.filter(t=>Number(r(t2)(t,"sample"))===e);for(let e=0;e<n.length;++e){let i=n[e];t[r(t2)(i,"name")]=i.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;let e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){let e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&6===e.length)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw Error("The image does not have an affine transformation.")}getResolution(e=null){let t=this.fileDirectory.ModelPixelScale,r=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(r)return[r[0],-r[5],r[10]];if(e){let[t,r,i]=e.getResolution();return[t*e.getWidth()/this.getWidth(),r*e.getHeight()/this.getHeight(),i*e.getWidth()/this.getWidth()]}throw Error("The image does not have an affine transformation.")}pixelIsArea(){return 1===this.geoKeys.GTRasterTypeGeoKey}getBoundingBox(e=!1){let t=this.getHeight(),r=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){let[e,i,n,s,o,a,l,h]=this.fileDirectory.ModelTransformation,u=[[0,0],[0,t],[r,0],[r,t]].map(([t,r])=>[s+e*t+i*r,h+o*t+a*r]),c=u.map(e=>e[0]),f=u.map(e=>e[1]);return[Math.min(...c),Math.min(...f),Math.max(...c),Math.max(...f)]}{let e=this.getOrigin(),i=this.getResolution(),n=e[0],s=e[1],o=n+i[0]*r,a=s+i[1]*t;return[Math.min(n,o),Math.min(s,a),Math.max(n,o),Math.max(s,a)]}}};function ra(e){return(t,...r)=>rh(e,t,r)}function rl(e,t){return ra(rd(e,t).get)}const{apply:rh,construct:ru,defineProperty:rc,get:rf,getOwnPropertyDescriptor:rd,getPrototypeOf:rg,has:rp,ownKeys:ry,set:rm,setPrototypeOf:rw}=Reflect;Proxy;const{EPSILON:rT,MAX_SAFE_INTEGER:rS,isFinite:rb,isNaN:r_}=Number,{iterator:rE,species:rI,toStringTag:rA,for:rv}=Symbol,rx=Object,{create:rR,defineProperty:rC,freeze:rP,is:rO}=rx,rD=rx.prototype;rD.__lookupGetter__&&ra(rD.__lookupGetter__),rx.hasOwn||ra(rD.hasOwnProperty);const rF=Array;rF.isArray;const rU=rF.prototype;ra(rU.join),ra(rU.push),ra(rU.toLocaleString);const rG=rU[rE],rM=ra(rG),{abs:rL,trunc:rk}=Math,rN=ArrayBuffer;rN.isView;const rj=rN.prototype;ra(rj.slice),rl(rj,"byteLength");const rz="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null;rz&&rl(rz.prototype,"byteLength");const rB=rg(Uint8Array);rB.from;const rV=rB.prototype;rV[rE],ra(rV.keys),ra(rV.values),ra(rV.entries),ra(rV.set),ra(rV.reverse),ra(rV.fill),ra(rV.copyWithin),ra(rV.sort),ra(rV.slice),ra(rV.subarray),rl(rV,"buffer"),rl(rV,"byteOffset"),rl(rV,"length"),rl(rV,rA);const rK=Uint8Array,rH=Uint16Array,r$=Uint32Array,rq=Float32Array,rX=rg([][rE]()),rW=ra(rX.next),rY=ra(function*(){}().next),rZ=rg(rX),rJ=DataView.prototype,rQ=ra(rJ.getUint16);ra(rJ.setUint16);const r0=WeakSet.prototype;ra(r0.add),ra(r0.has);const r1=WeakMap,r2=r1.prototype,r3=ra(r2.get);ra(r2.has);const r6=ra(r2.set),r4=new r1,r5=rR(null,{next:{value:function(){return rW(r3(r4,this))}},[rE]:{value:function(){return this}}}),r8=new r1,r7=rR(rZ,{next:{value:function(){return rY(r3(r8,this))},writable:!0,configurable:!0}});for(const e of ry(rX))"next"!==e&&rC(r7,e,rd(rX,e));const r9=new rN(4),ie=new rq(r9),it=new r$(r9),ir=new rH(512),ii=new rK(512);for(let e=0;e<256;++e){let t=e-127;t<-27?(ir[e]=0,ir[256|e]=32768,ii[e]=24,ii[256|e]=24):t<-14?(ir[e]=1024>>-t-14,ir[256|e]=1024>>-t-14|32768,ii[e]=-t-1,ii[256|e]=-t-1):t<=15?(ir[e]=t+15<<10,ir[256|e]=t+15<<10|32768,ii[e]=13,ii[256|e]=13):t<128?(ir[e]=31744,ir[256|e]=64512,ii[e]=24,ii[256|e]=24):(ir[e]=31744,ir[256|e]=64512,ii[e]=13,ii[256|e]=13)}const is=new r$(2048);for(let e=1;e<1024;++e){let t=e<<13,r=0;for(;(8388608&t)==0;)t<<=1,r-=8388608;t&=-8388609,r+=947912704,is[e]=t|r}for(let e=1024;e<2048;++e)is[e]=939524096+(e-1024<<13);const io=new r$(64);for(let e=1;e<31;++e)io[e]=e<<23;io[31]=1199570944,io[32]=2147483648;for(let e=33;e<63;++e)io[e]=2147483648+(e-32<<23);io[63]=3347054592;const ia=new rH(64);for(let e=1;e<64;++e)32!==e&&(ia[e]=1024);class il{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){let r;let i=this.getUint32(e,t),n=this.getUint32(e+4,t);if(t){if(!Number.isSafeInteger(r=i+4294967296*n))throw Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}if(!Number.isSafeInteger(r=4294967296*i+n))throw Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}getInt64(e,t){let r=0,i=(128&this._dataView.getUint8(e+(t?7:0)))>0,n=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(e+(t?s:7-s));i&&(n?0!==o&&(o=255&~(o-1),n=!1):o=255&~o),r+=o*256**s}return i&&(r=-r),r}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return function(e,t,...r){return function(e){let t=e>>10;return it[0]=is[ia[t]+(1023&e)]+io[t],ie[0]}(rQ(e,t,...function(e){if(e[rE]===rG&&rX.next===rW)return e;let t=rR(r5);return r6(r4,t,rM(e)),t}(r)))}(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class ih{constructor(e,t,r,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=r,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){let t;let r=this.readUint32(e),i=this.readUint32(e+4);if(this._littleEndian){if(!Number.isSafeInteger(t=r+4294967296*i))throw Error(`${t} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return t}if(!Number.isSafeInteger(t=4294967296*r+i))throw Error(`${t} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return t}readInt64(e){let t=0,r=(128&this._dataView.getUint8(e+(this._littleEndian?7:0)))>0,i=!0;for(let n=0;n<8;n++){let s=this._dataView.getUint8(e+(this._littleEndian?n:7-n));r&&(i?0!==s&&(s=255&~(s-1),i=!1):s=255&~s),t+=s*256**n}return r&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const iu="\r\n\r\n";function ic(e){if(void 0!==Object.fromEntries)return Object.fromEntries(e);let t={};for(let[r,i]of e)t[r.toLowerCase()]=i;return t}function id(e){let t,r,i;return e&&([,t,r,i]=e.match(/bytes (\d+)-(\d+)\/(\d+)/),t=parseInt(t,10),r=parseInt(r,10),i=parseInt(i,10)),{start:t,end:r,total:i}}class ig{async fetch(e,t){return Promise.all(e.map(e=>this.fetchSlice(e,t)))}async fetchSlice(e){throw Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class ip extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw TypeError("`maxSize` must be a number greater than 0");if("number"==typeof e.maxAge&&0===e.maxAge)throw TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if("function"==typeof this.onEviction)for(let[t,r]of e)this.onEviction(t,r.value)}_deleteIfExpired(e,t){return!!("number"==typeof t.expiry&&t.expiry<=Date.now())&&("function"==typeof this.onEviction&&this.onEviction(e,t.value),this.delete(e))}_getOrDeleteIfExpired(e,t){if(!1===this._deleteIfExpired(e,t))return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){let r=t.get(e);return this._getItemValue(e,r)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(let e of this.oldCache){let[t,r]=e;this.cache.has(t)||!1!==this._deleteIfExpired(t,r)||(yield e)}for(let e of this.cache){let[t,r]=e;!1===this._deleteIfExpired(t,r)&&(yield e)}}get(e){if(this.cache.has(e)){let t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){let t=this.oldCache.get(e);if(!1===this._deleteIfExpired(e,t))return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:r=this.maxAge}={}){let i="number"==typeof r&&r!==Number.POSITIVE_INFINITY?Date.now()+r:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):!!this.oldCache.has(e)&&!this._deleteIfExpired(e,this.oldCache.get(e))}peek(e){return this.cache.has(e)?this._peek(e,this.cache):this.oldCache.has(e)?this._peek(e,this.oldCache):void 0}delete(e){let t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw TypeError("`maxSize` must be a number greater than 0");let t=[...this._entriesAscending()],r=t.length-e;r<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(r>0&&this._emitEvictions(t.slice(0,r)),this.oldCache=new Map(t.slice(r)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(let[e]of this)yield e}*values(){for(let[,e]of this)yield e}*[Symbol.iterator](){for(let e of this.cache){let[t,r]=e;!1===this._deleteIfExpired(t,r)&&(yield[t,r.value])}for(let e of this.oldCache){let[t,r]=e;this.cache.has(t)||!1!==this._deleteIfExpired(t,r)||(yield[t,r.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){let[r,i]=e[t];!1===this._deleteIfExpired(r,i)&&(yield[r,i.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){let[r,i]=e[t];this.cache.has(r)||!1!==this._deleteIfExpired(r,i)||(yield[r,i.value])}}*entriesAscending(){for(let[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(let t of this.oldCache.keys())!this.cache.has(t)&&e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(let[r,i]of this.entriesAscending())e.call(t,i,r,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}function iy(e,t){for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}function im(e){let t={};for(let r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t}function iw(e,t){let r=[];for(let i=0;i<e;i++)r.push(t(i));return r}async function iT(e){return new Promise(t=>setTimeout(t,e))}class iS extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,iS),this.name="AbortError"}}const ib=class extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}};class i_{constructor(e,t,r=null){this.offset=e,this.length=t,this.data=r}get top(){return this.offset+this.length}}class iE{constructor(e,t,r){this.offset=e,this.length=t,this.blockIds=r}}class iI extends ig{constructor(e,{blockSize:t=65536,cacheSize:r=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new ip({maxSize:r,onEviction:(e,t)=>{this.evictedBlocks.set(e,t)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){let r=[],i=[],n=[];for(let{offset:t,length:s}of(this.evictedBlocks.clear(),e)){let e=t+s,{fileSize:o}=this;null!==o&&(e=Math.min(e,o));let a=Math.floor(t/this.blockSize)*this.blockSize;for(let t=a;t<e;t+=this.blockSize){let e=Math.floor(t/this.blockSize);this.blockCache.has(e)||this.blockRequests.has(e)||(this.blockIdsToFetch.add(e),i.push(e)),this.blockRequests.has(e)&&r.push(this.blockRequests.get(e)),n.push(e)}}await iT(),this.fetchBlocks(t);let s=[];for(let e of i)this.blockRequests.has(e)&&s.push(this.blockRequests.get(e));await Promise.allSettled(r),await Promise.allSettled(s);let o=[],a=n.filter(e=>this.abortedBlockIds.has(e)||!this.blockCache.has(e));if(a.forEach(e=>this.blockIdsToFetch.add(e)),a.length>0&&t&&!t.aborted){for(let e of(this.fetchBlocks(null),a)){let t=this.blockRequests.get(e);if(!t)throw Error(`Block ${e} is not in the block requests`);o.push(t)}await Promise.allSettled(o)}if(t&&t.aborted)throw new iS("Request was aborted");let l=n.map(e=>this.blockCache.get(e)||this.evictedBlocks.get(e)),h=l.filter(e=>!e);if(h.length)throw new ib(h,"Request failed");let u=new Map(function(e,t){let r=Array.isArray(e)?e:Array.from(e),i=Array.isArray(t)?t:Array.from(t);return r.map((e,t)=>[e,i[t]])}(n,l));return this.readSliceData(e,u)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){let t=this.groupBlocks(this.blockIdsToFetch),r=this.source.fetch(t,e);for(let i=0;i<t.length;++i)for(let n of t[i].blockIds)this.blockRequests.set(n,(async()=>{try{let e=(await r)[i],t=n*this.blockSize,s=t-e.offset,o=Math.min(s+this.blockSize,e.data.byteLength),a=e.data.slice(s,o),l=new i_(t,a.byteLength,a,n);this.blockCache.set(n,l),this.abortedBlockIds.delete(n)}catch(t){if("AbortError"===t.name)t.signal=e,this.blockCache.delete(n),this.abortedBlockIds.add(n);else throw t}finally{this.blockRequests.delete(n)}})());this.blockIdsToFetch.clear()}}groupBlocks(e){let t=Array.from(e).sort((e,t)=>e-t);if(0===t.length)return[];let r=[],i=null,n=[];for(let e of t)null===i||i+1===e?r.push(e):(n.push(new iE(r[0]*this.blockSize,r.length*this.blockSize,r)),r=[e]),i=e;return n.push(new iE(r[0]*this.blockSize,r.length*this.blockSize,r)),n}readSliceData(e,t){return e.map(e=>{let r=e.offset+e.length;null!==this.fileSize&&(r=Math.min(this.fileSize,r));let i=Math.floor(e.offset/this.blockSize),n=Math.floor(r/this.blockSize),s=new ArrayBuffer(e.length),o=new Uint8Array(s);for(let s=i;s<=n;++s){let i;let n=t.get(s),a=n.offset-e.offset,l=n.top-r,h=0,u=0;a<0?h=-a:a>0&&(u=a),i=l<0?n.length-h:r-n.offset-h;let c=new Uint8Array(n.data,h,i);o.set(c,u)}return s})}}class iA{get ok(){return this.status>=200&&this.status<=299}get status(){throw Error("not implemented")}getHeader(e){throw Error("not implemented")}async getData(){throw Error("not implemented")}}class iv{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw Error("request is not implemented")}}class ix extends iA{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class iR extends iv{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){return new ix(await fetch(this.url,{headers:e,credentials:this.credentials,signal:t}))}}class iC extends iA{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class iP extends iv{constructRequest(e,t){return new Promise((r,i)=>{let n=new XMLHttpRequest;for(let[t,r]of(n.open("GET",this.url),n.responseType="arraybuffer",Object.entries(e)))n.setRequestHeader(t,r);n.onload=()=>{let e=n.response;r(new iC(n,e))},n.onerror=i,n.onabort=()=>i(new iS("Request aborted")),n.send(),t&&(t.aborted&&n.abort(),t.addEventListener("abort",()=>n.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}var iO=(o("4AFFV"),o("4AFFV"),o("4AFFV")),iD=o("awmEs"),iF=iD.Buffer;class iU extends iA{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class iG extends iv{constructor(e){super(e),this.parsedUrl=r(iO).parse(this.url),this.httpApi=(this.parsedUrl.protocol,r(iO))}constructRequest(e,t){return new Promise((r,i)=>{let n=this.httpApi.get({...this.parsedUrl,headers:e},e=>{let t=new Promise(t=>{let r=[];e.on("data",e=>{r.push(e)}),e.on("end",()=>{t(iF.concat(r).buffer)}),e.on("error",i)});r(new iU(e,t))});n.on("error",i),t&&(t.aborted&&n.destroy(new iS("Request aborted")),t.addEventListener("abort",()=>n.destroy(new iS("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class iM extends ig{constructor(e,t,r,i){super(),this.client=e,this.headers=t,this.maxRanges=r,this.allowFullFile=i,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length,Promise.all(e.map(e=>this.fetchSlice(e,t))))}async fetchSlices(e,t){let r=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:e,length:t})=>`${e}-${e+t}`).join(",")}`},signal:t});if(r.ok){if(206===r.status){let{type:i,params:n}=function(e){let[t,...r]=e.split(";").map(e=>e.trim());return{type:t,params:ic(r.map(e=>e.split("=")))}}(r.getHeader("content-type"));if("multipart/byteranges"===i){let e=function(e,t){let r=null,i=new TextDecoder("ascii"),n=[],s=`--${t}`,o=`${s}--`;for(let t=0;t<10;++t)i.decode(new Uint8Array(e,t,s.length))===s&&(r=t);if(null===r)throw Error("Could not find initial boundary");for(;r<e.byteLength;){let t=i.decode(new Uint8Array(e,r,Math.min(s.length+1024,e.byteLength-r)));if(0===t.length||t.startsWith(o))break;if(!t.startsWith(s))throw Error("Part does not start with boundary");let a=t.substr(s.length+2);if(0===a.length)break;let l=a.indexOf(iu),h=ic(a.substr(0,l).split("\r\n").map(e=>{let t=e.split(":").map(e=>e.trim());return t[0]=t[0].toLowerCase(),t})),{start:u,end:c,total:f}=id(h["content-range"]),d=r+s.length+l+iu.length,g=parseInt(c,10)+1-parseInt(u,10);n.push({headers:h,data:e.slice(d,d+g),offset:u,length:g,fileSize:f}),r=d+g+4}return n}(await r.getData(),n.boundary);return this._fileSize=e[0].fileSize||null,e}let s=await r.getData(),{start:o,end:a,total:l}=id(r.getHeader("content-range"));this._fileSize=l||null;let h=[{data:s,offset:o,length:a-o}];if(e.length>1){let r=await Promise.all(e.slice(1).map(e=>this.fetchSlice(e,t)));return h.concat(r)}return h}{if(!this.allowFullFile)throw Error("Server responded with full file");let e=await r.getData();return this._fileSize=e.byteLength,[{data:e,offset:0,length:e.byteLength}]}}throw Error("Error fetching data.")}async fetchSlice(e,t){let{offset:r,length:i}=e,n=await this.client.request({headers:{...this.headers,Range:`bytes=${r}-${r+i}`},signal:t});if(n.ok){if(206===n.status){let e=await n.getData(),{total:t}=id(n.getHeader("content-range"));return this._fileSize=t||null,{data:e,offset:r,length:i}}{if(!this.allowFullFile)throw Error("Server responded with full file");let e=await n.getData();return this._fileSize=e.byteLength,{data:e,offset:0,length:e.byteLength}}}throw Error("Error fetching data.")}get fileSize(){return this._fileSize}}function iL(e,{blockSize:t,cacheSize:r}){return null===t?e:new iI(e,{blockSize:t,cacheSize:r})}function ik(e,{forceXHR:t=!1,...r}={}){return"function"!=typeof fetch||t?"undefined"!=typeof XMLHttpRequest?function(e,{headers:t={},maxRanges:r=0,allowFullFile:i=!1,...n}={}){return iL(new iM(new iP(e),t,r,i),n)}(e,r):function(e,{headers:t={},maxRanges:r=0,allowFullFile:i=!1,...n}={}){return iL(new iM(new iG(e),t,r,i),n)}(e,r):function(e,{headers:t={},credentials:r,maxRanges:i=0,allowFullFile:n=!1,...s}={}){return iL(new iM(new iR(e,r),t,i,n),s)}(e,r)}class iN extends ig{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((r,i)=>{let n=this.file.slice(e.offset,e.offset+e.length),s=new FileReader;s.onload=e=>r(e.target.result),s.onerror=i,s.onabort=i,s.readAsArrayBuffer(n),t&&t.addEventListener("abort",()=>s.abort())})}}var iO=o("4AFFV"),iD=o("awmEs");iD.Buffer;var F=(o("eRhGG"),o("eRhGG"));const ij=im(F.fieldTagNames),iz=im(F.geoKeyNames),iB={};iy(iB,ij),iy(iB,iz),im(F.fieldTypeNames);const iV={nextZero:(e,t)=>{let r=t;for(;0!==e[r];)r++;return r},readUshort:(e,t)=>e[t]<<8|e[t+1],readShort:(e,t)=>{let r=iV.ui8;return r[0]=e[t+1],r[1]=e[t+0],iV.i16[0]},readInt:(e,t)=>{let r=iV.ui8;return r[0]=e[t+3],r[1]=e[t+2],r[2]=e[t+1],r[3]=e[t+0],iV.i32[0]},readUint:(e,t)=>{let r=iV.ui8;return r[0]=e[t+3],r[1]=e[t+2],r[2]=e[t+1],r[3]=e[t+0],iV.ui32[0]},readASCII:(e,t,r)=>r.map(r=>String.fromCharCode(e[t+r])).join(""),readFloat:(e,t)=>{let r=iV.ui8;return iw(4,i=>{r[i]=e[t+3-i]}),iV.fl32[0]},readDouble:(e,t)=>{let r=iV.ui8;return iw(8,i=>{r[i]=e[t+7-i]}),iV.fl64[0]},writeUshort:(e,t,r)=>{e[t]=r>>8&255,e[t+1]=255&r},writeUint:(e,t,r)=>{e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=r>>0&255},writeASCII:(e,t,r)=>{iw(r.length,i=>{e[t+i]=r.charCodeAt(i)})},ui8:new Uint8Array(8)};function iK(e){switch(e){case F.fieldTypes.BYTE:case F.fieldTypes.ASCII:case F.fieldTypes.SBYTE:case F.fieldTypes.UNDEFINED:return 1;case F.fieldTypes.SHORT:case F.fieldTypes.SSHORT:return 2;case F.fieldTypes.LONG:case F.fieldTypes.SLONG:case F.fieldTypes.FLOAT:case F.fieldTypes.IFD:return 4;case F.fieldTypes.RATIONAL:case F.fieldTypes.SRATIONAL:case F.fieldTypes.DOUBLE:case F.fieldTypes.LONG8:case F.fieldTypes.SLONG8:case F.fieldTypes.IFD8:return 8;default:throw RangeError(`Invalid field type: ${e}`)}}function iH(e,t,r,i){let n=null,s=null,o=iK(t);switch(t){case F.fieldTypes.BYTE:case F.fieldTypes.ASCII:case F.fieldTypes.UNDEFINED:n=new Uint8Array(r),s=e.readUint8;break;case F.fieldTypes.SBYTE:n=new Int8Array(r),s=e.readInt8;break;case F.fieldTypes.SHORT:n=new Uint16Array(r),s=e.readUint16;break;case F.fieldTypes.SSHORT:n=new Int16Array(r),s=e.readInt16;break;case F.fieldTypes.LONG:case F.fieldTypes.IFD:n=new Uint32Array(r),s=e.readUint32;break;case F.fieldTypes.SLONG:n=new Int32Array(r),s=e.readInt32;break;case F.fieldTypes.LONG8:case F.fieldTypes.IFD8:n=Array(r),s=e.readUint64;break;case F.fieldTypes.SLONG8:n=Array(r),s=e.readInt64;break;case F.fieldTypes.RATIONAL:n=new Uint32Array(2*r),s=e.readUint32;break;case F.fieldTypes.SRATIONAL:n=new Int32Array(2*r),s=e.readInt32;break;case F.fieldTypes.FLOAT:n=new Float32Array(r),s=e.readFloat32;break;case F.fieldTypes.DOUBLE:n=new Float64Array(r),s=e.readFloat64;break;default:throw RangeError(`Invalid field type: ${t}`)}if(t===F.fieldTypes.RATIONAL||t===F.fieldTypes.SRATIONAL)for(let t=0;t<r;t+=2)n[t]=s.call(e,i+t*o),n[t+1]=s.call(e,i+(t*o+4));else for(let t=0;t<r;++t)n[t]=s.call(e,i+t*o);return t===F.fieldTypes.ASCII?new TextDecoder("utf-8").decode(n):n}iV.fl64=new Float64Array(iV.ui8.buffer),iV.writeDouble=(e,t,r)=>{iV.fl64[0]=r,iw(8,r=>{e[t+r]=iV.ui8[7-r]})};class i${constructor(e,t,r){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=r}}class iq extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class iX{async readRasters(e={}){let{window:t,width:r,height:i}=e,{resX:n,resY:s,bbox:o}=e,a=await this.getImage(),l=a,h=await this.getImageCount(),u=a.getBoundingBox();if(t&&o)throw Error('Both "bbox" and "window" passed.');if(r||i){if(t){let[e,r]=a.getOrigin(),[i,n]=a.getResolution();o=[e+t[0]*i,r+t[1]*n,e+t[2]*i,r+t[3]*n]}let e=o||u;if(r){if(n)throw Error("Both width and resX passed");n=(e[2]-e[0])/r}if(i){if(s)throw Error("Both width and resY passed");s=(e[3]-e[1])/i}}if(n||s){let e=[];for(let t=0;t<h;++t){let r=await this.getImage(t),{SubfileType:i,NewSubfileType:n}=r.fileDirectory;(0===t||2===i||1&n)&&e.push(r)}e.sort((e,t)=>e.getWidth()-t.getWidth());for(let t=0;t<e.length;++t){let r=e[t],i=(u[2]-u[0])/r.getWidth(),o=(u[3]-u[1])/r.getHeight();if(l=r,n&&n>i||s&&s>o)break}}let c=t;if(o){let[e,t]=a.getOrigin(),[r,i]=l.getResolution(a);c=[Math.min((c=[Math.round((o[0]-e)/r),Math.round((o[1]-t)/i),Math.round((o[2]-e)/r),Math.round((o[3]-t)/i)])[0],c[2]),Math.min(c[1],c[3]),Math.max(c[0],c[2]),Math.max(c[1],c[3])]}return l.readRasters({...e,window:c})}}class iW extends iX{constructor(e,t,r,i,n={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=r,this.firstIFDOffset=i,this.cache=n.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){let r=this.bigTiff?4048:1024;return new ih((await this.source.fetch([{offset:e,length:void 0!==t?t:r}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){let t=this.bigTiff?20:12,r=this.bigTiff?8:2,i=await this.getSlice(e),n=this.bigTiff?i.readUint64(e):i.readUint16(e),s=n*t+(this.bigTiff?16:6);i.covers(e,s)||(i=await this.getSlice(e,s));let o={},a=e+(this.bigTiff?8:2);for(let e=0;e<n;a+=t,++e){let e,t;let r=i.readUint16(a),n=i.readUint16(a+2),s=this.bigTiff?i.readUint64(a+4):i.readUint32(a+4),l=iK(n),h=a+(this.bigTiff?12:8);if(l*s<=(this.bigTiff?8:4))e=iH(i,n,s,h);else{let t=i.readOffset(h),r=iK(n)*s;e=i.covers(t,r)?iH(i,n,s,t):iH(await this.getSlice(t,r),n,s,t)}t=1!==s||-1!==(0,F.arrayFields).indexOf(r)||n===F.fieldTypes.RATIONAL||n===F.fieldTypes.SRATIONAL?e:e[0],o[F.fieldTagNames[r]]=t}let l=function(e){let t=e.GeoKeyDirectory;if(!t)return null;let r={};for(let i=4;i<=4*t[3];i+=4){let n=F.geoKeyNames[t[i]],s=t[i+1]?F.fieldTagNames[t[i+1]]:null,o=t[i+2],a=t[i+3],l=null;if(s){if(null==(l=e[s]))throw Error(`Could not get value of geoKey '${n}'.`);"string"==typeof l?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),1===o&&(l=l[0]))}else l=a;r[n]=l}return r}(o);return new i$(o,l,i.readOffset(e+r+t*n))}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(0===e)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){if(t instanceof iq)throw new iq(e);throw t}return this.ifdRequests[e]=(async()=>{let t=await this.ifdRequests[e-1];if(0===t.nextIFDByteOffset)throw new iq(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){let t=await this.requestIFD(e);return new ro(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(e){if(e instanceof iq)t=!1;else throw e}return e}async getGhostValues(){let e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;let t="GDAL_STRUCTURAL_METADATA_SIZE=",r=t.length+100,i=await this.getSlice(e,r);if(t===iH(i,F.fieldTypes.ASCII,t.length,e)){let t=iH(i,F.fieldTypes.ASCII,r,e).split("\n")[0],n=Number(t.split("=")[1].split(" ")[0])+t.length;n>r&&(i=await this.getSlice(e,n));let s=iH(i,F.fieldTypes.ASCII,n,e);this.ghostValues={},s.split("\n").filter(e=>e.length>0).map(e=>e.split("=")).forEach(([e,t])=>{this.ghostValues[e]=t})}return this.ghostValues}static async fromSource(e,t,r){let i,n;let s=new il((await e.fetch([{offset:0,length:1024}],r))[0]),o=s.getUint16(0,0);if(18761===o)i=!0;else if(19789===o)i=!1;else throw TypeError("Invalid byte order value.");let a=s.getUint16(2,i);if(42===a)n=!1;else if(43===a){if(n=!0,8!==s.getUint16(4,i))throw Error("Unsupported offset byte-size.")}else throw TypeError("Invalid magic number.");let l=n?s.getUint64(8,i):s.getUint32(4,i);return new iW(e,i,n,l,t)}close(){return"function"==typeof this.source.close&&this.source.close()}}class iY extends iX{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){let e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(e=>e.parseFileDirectoryAt(e.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,r=0;for(let i=0;i<this.imageFiles.length;i++){let n=this.imageFiles[i];for(let s=0;s<this.imageCounts[i];s++){if(e===t){let e=await n.requestIFD(r);return new ro(e.fileDirectory,e.geoKeyDirectory,n.dataView,n.littleEndian,n.cache,n.source)}t++,r++}r=0}throw RangeError("Invalid image index")}async getImageCount(){if(null!==this.imageCount)return this.imageCount;let e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(e=>e.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((e,t)=>e+t,0),this.imageCount}}async function iZ(e,t={},r){return iW.fromSource(ik(e,t),r)}async function iJ(e,t){return iW.fromSource(new iN(e),t)}async function iQ(e,t=[],r={},i){return new iY(await iW.fromSource(ik(e,r),i),await Promise.all(t.map(e=>iW.fromSource(ik(e,r)))))}var A=o("gzr8q"),i0=o("a6roo"),i1=o("jZquI"),i2=o("kVEO0"),i3=o("aDAjs");const i6="STATISTICS_MAXIMUM",i4="STATISTICS_MINIMUM";function i5(e){return e.getImageCount().then(function(t){let r=Array(t);for(let i=0;i<t;++i)r[i]=e.getImage(i);return Promise.all(r)})}function i8(e,t,r,i,n){if(Array.isArray(e)){let s=e.length;if(!Array.isArray(t)||s!=t.length){let e=Error(i);throw n(e),e}for(let o=0;o<s;++o)i8(e[o],t[o],r,i,n);return}if(Math.abs(e-t)>r*e)throw Error(i)}class i7 extends O{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,opaque:e.opaque,transition:e.transition,interpolate:!1!==e.interpolate,wrapX:e.wrapX}),this.sourceInfo_=e.sources;let t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=Array(t),this.sourceMasks_=Array(t),this.resolutionFactors_=Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=!1!==e.normalize,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(e=>e.url).join(","));let r=this,i=Array(t);for(let e=0;e<t;++e){var n,s;i[e]=(n=this.sourceInfo_[e],s=this.sourceOptions_,(n.blob?iJ(n.blob):n.overviews?iQ(n.url,n.overviews,s):iZ(n.url,s)).then(i5))}Promise.all(i).then(function(e){r.configure_(e)}).catch(function(e){(0,i2.error)(e),r.error_=e,r.setState("error")})}getError(){return this.error_}determineProjection(e){let t=e[0];for(let e=t.length-1;e>=0;--e){let r=function(e){let t=e.geoKeys;if(!t)return null;if(t.ProjectedCSTypeGeoKey&&32767!==t.ProjectedCSTypeGeoKey){let e="EPSG:"+t.ProjectedCSTypeGeoKey,r=(0,A.get)(e);if(!r){let i=(0,i3.fromCode)(t.ProjLinearUnitsGeoKey);i&&(r=new A.Projection({code:e,units:i}))}return r}if(t.GeographicTypeGeoKey&&32767!==t.GeographicTypeGeoKey){let e="EPSG:"+t.GeographicTypeGeoKey,r=(0,A.get)(e);if(!r){let i=(0,i3.fromCode)(t.GeogAngularUnitsGeoKey);i&&(r=new A.Projection({code:e,units:i}))}return r}return null}(t[e]);if(r){this.projection=r;break}}}configure_(e){let t,r,i,n,s;let o=Array(e.length),a=Array(e.length),l=Array(e.length),h=0,u=e.length;for(let c=0;c<u;++c){let u,f;let d=[],g=[];e[c].forEach(e=>{(4&(e.fileDirectory.NewSubfileType||0))==4?g.push(e):d.push(e)});let p=d.length;if(g.length>0&&g.length!==p)throw Error(`Expected one mask per image found ${g.length} masks and ${p} images`);let y=Array(p),m=Array(p),w=Array(p);a[c]=Array(p),l[c]=Array(p);for(let e=0;e<p;++e){let t=d[e],r=t.getGDALNoData();l[c][e]=t.getGDALMetadata(0),a[c][e]=r;let i=this.sourceInfo_[c].bands;o[c]=i?i.length:t.getSamplesPerPixel();let n=p-(e+1);u||(u=function(e){try{return e.getBoundingBox()}catch(t){return[0,0,e.getWidth(),e.getHeight()]}}(t)),f||(f=function(e){try{return e.getOrigin().slice(0,2)}catch(t){return[0,e.getHeight()]}}(t));let s=function(e,t){try{return e.getResolution(t)}catch(r){return[t.getWidth()/e.getWidth(),t.getHeight()/e.getHeight()]}}(t,d[0]);w[n]=s[0];let h=[t.getTileWidth(),t.getTileHeight()];h[0]!==h[1]&&h[1]<256&&(h[0]=256,h[1]=256),y[n]=h;let g=s[0]/Math.abs(s[1]);m[n]=[h[0],h[1]/g]}if(t?(0,i1.getIntersection)(t,u,t):t=u,r){let e=`Origin mismatch for source ${c}, got [${f}] but expected [${r}]`;i8(r,f,0,e,this.viewRejector)}else r=f;if(s){s.length-h>w.length&&(h=s.length-w.length);let e=s[s.length-1]/w[w.length-1];this.resolutionFactors_[c]=e;let t=w.map(t=>t*=e),r=`Resolution mismatch for source ${c}, got [${t}] but expected [${s}]`;i8(s.slice(h,s.length),t,.02,r,this.viewRejector)}else s=w,this.resolutionFactors_[c]=1;i?i8(i.slice(h,i.length),m,.01,`Tile size mismatch for source ${c}`,this.viewRejector):i=m,n?i8(n.slice(h,n.length),y,0,`Tile size mismatch for source ${c}`,this.viewRejector):n=y,this.sourceImagery_[c]=d.reverse(),this.sourceMasks_[c]=g.reverse()}for(let e=0,t=this.sourceImagery_.length;e<t;++e){let t=this.sourceImagery_[e];for(;t.length<s.length;)t.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.samplesPerPixel_=o,this.nodataValues_=a,this.metadata_=l;e:for(let e=0;e<u;++e){if(void 0!==this.sourceInfo_[e].nodata||this.sourceMasks_[e].length){this.addAlpha_=!0;break}let t=a[e],r=this.sourceInfo_[e].bands;if(r){for(let e=0;e<r.length;++e)if(null!==t[r[e]-1]){this.addAlpha_=!0;break e}continue}for(let e=0;e<t.length;++e)if(null!==t[e]){this.addAlpha_=!0;break e}}let c=this.addAlpha_?1:0;for(let e=0;e<u;++e)c+=o[e];this.bandCount=c;let f=new D.default({extent:t,minZoom:h,origin:r,resolutions:s,tileSizes:i});this.tileGrid=f,this.setTileSizes(n),this.setLoader(this.loadTile_.bind(this)),this.setState("ready"),2===s.length?s=[s[0],s[1],s[1]/2]:1===s.length&&(s=[2*s[0],s[0],s[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:s,center:(0,A.toUserCoordinate)((0,i1.getCenter)(t),this.projection),extent:(0,A.toUserExtent)(t,this.projection),zoom:1})}loadTile_(t,r,i){let n=this.getTileSize(t),s=this.sourceImagery_.length,o=Array(2*s),a=this.nodataValues_,l=this.sourceInfo_,h=(e||(e=new k),e);for(let e=0;e<s;++e){let u,c;let f=l[e],d=this.resolutionFactors_[e],g=[Math.round(n[0]*d*r),Math.round(n[1]*d*i),Math.round(n[0]*d*(r+1)),Math.round(n[1]*d*(i+1))],p=this.sourceImagery_[e][t];f.bands&&(u=f.bands.map(function(e){return e-1})),c="nodata"in f&&null!==f.nodata?f.nodata:u?u.map(function(t){return a[e][t]}):a[e];let y={window:g,width:n[0],height:n[1],samples:u,fillValue:c,pool:h,interleave:!1};!function(e,t){if(!e)return!1;if(!0===e)return!0;if(3!==t.getSamplesPerPixel())return!1;let r=t.fileDirectory.PhotometricInterpretation,i=F.photometricInterpretations;return r===i.CMYK||r===i.YCbCr||r===i.CIELab||r===i.ICCLab}(this.convertToRGB_,p)?o[e]=p.readRasters(y):o[e]=p.readRGB(y);let m=s+e,w=this.sourceMasks_[e][t];if(!w){o[m]=Promise.resolve(null);continue}o[m]=w.readRasters({window:g,width:n[0],height:n[1],samples:[0],pool:h,interleave:!1})}return Promise.all(o).then(this.composeTile_.bind(this,n)).catch(function(e){throw(0,i2.error)(e),e})}composeTile_(e,t){let r;let i=this.metadata_,n=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,h=this.normalize_,u=this.addAlpha_,c=e[0]*e[1],f=c*o;r=h?new Uint8Array(f):new Float32Array(f);let d=0;for(let e=0;e<c;++e){let o=u;for(let c=0;c<s;++c){let f,y;let m=n[c],w=m.min,T=m.max;if(h){var g,p;let e=i[c][0];void 0===w&&(w=e&&i4 in e?parseFloat(e[i4]):(g=t[c][0])instanceof Int8Array?-128:g instanceof Int16Array?-32768:g instanceof Int32Array?-2147483648:g instanceof Float32Array?12e-39:0),void 0===T&&(T=e&&i6 in e?parseFloat(e[i6]):(p=t[c][0])instanceof Int8Array?127:p instanceof Uint8Array||p instanceof Uint8ClampedArray?255:p instanceof Int16Array?32767:p instanceof Uint16Array?65535:p instanceof Int32Array?2147483647:p instanceof Uint32Array?4294967295:p instanceof Float32Array?34e37:255),f=255/(T-w),y=-w*f}for(let i=0;i<a[c];++i){let n;let s=t[c][i][e];if(n=h?(0,i0.clamp)(f*s+y,0,255):s,u){let e=m.nodata;if(void 0===e){let t;t=m.bands?m.bands[i]-1:i,e=l[c][t]}let t=isNaN(e);(t||s===e)&&(!t||isNaN(s))||(o=!1,r[d]=n)}else r[d]=n;d++}if(!o){let r=t[s+c];r&&!r[0][e]&&(o=!0)}}u&&(o||(r[d]=255),d++)}return r}}i7.prototype.getView;var i9=o("4QhZh"),i1=o("jZquI");const ne=new i7({sources:[{url:"https://data-pprd.priv.geopf.fr/telechargement/download/perf_rlt/P15000222/IGNF_PVA_1-0__2015-09-10__CP15000222_15FD2725x00005_01874.tif"}],convertToRGB:!0});let nt=new y({});const nr=new l.default({target:"map",layers:[nt],view:ne.getView()});nr.getViewport().classList.add("ol-ready");const ni=document.querySelector("#vignette canvas"),nn=document.querySelector("input");nn.addEventListener("change",e=>{(function(e){iZ(e).then(e=>{console.log(e),e.getImageCount().then(t=>{console.log(t),e.getImage(t-1).then(e=>{console.log(e.getWidth()+"x"+e.getHeight()),e.readRGB().then(e=>{let t=e.width,r=e.height;ni.width=t,ni.height=r;let i=ni.getContext("2d",{willReadFrequently:!0}),n=i.getImageData(0,0,t,r),s=n.data;for(let i=0;i<r;i++)for(let r=0;r<t;r++){let n=3*i*t+3*r,o=4*i*t+4*r;s[o]=e[n],s[o+1]=e[n+1],s[o+2]=e[n+2],s[o+3]=255}i.putImageData(n,0,0),console.log("ok")})})})})})(e.target.value),nr.removeLayer(nt);let t=new i7({sources:[{url:e.target.value}],convertToRGB:!0});nt=new y({source:t}),nr.addLayer(nt),document.body.dataset.loading="",t.getView().then(e=>{e.resolutions.push(e.resolutions[e.resolutions.length-1]/2),e.extent=(0,i1.buffer)(e.extent,(e.extent[2]-e.extent[0])/4),nr.setView(new i9.default(e)),delete document.body.dataset.loading}),window.source=t}),document.querySelector("select").addEventListener("change",e=>{nn.value=e.target.value,nn.dispatchEvent(new Event("change"))}),document.querySelector("select").value="",window.map=nr,window.geotiff=ne;