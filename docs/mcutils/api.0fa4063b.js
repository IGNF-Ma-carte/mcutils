var e=globalThis,t={},a={},r=e.parcelRequire8969;null==r&&((r=function(e){if(e in t)return t[e].exports;if(e in a){var r=a[e];delete a[e];var l={id:e,exports:{}};return t[e]=l,r.call(l.exports,l,l.exports),l.exports}var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){a[e]=t},e.parcelRequire8969=r);var l=r.register;l("agEcb",function(e,t){function a(t){return e.exports=a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,a(t)}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports}),l("kMG75",function(e,t){let a;Object.defineProperty(e.exports,"default",{get:()=>n,set:void 0,enumerable:!0,configurable:!0});var l=r("fnScq"),o=r("iQyfo");class s extends l.default{constructor(e,t){super(),t=t||{},this.set("full",!!t.full),this.api=e;let a=this.element=(0,o.default).create("DIV",{className:"author-list",parent:t.target}),r=this.searchInput=(0,o.default).create("INPUT",{type:"text",className:"author",placeholder:"chercher un membre...",parent:a});(0,o.default).create("I",{className:"loading",parent:a});let l=(0,o.default).create("UL",{className:"autocomplete",parent:a});r.addEventListener("keyup",()=>{this.autocompleteAuthor(r.value,l)}),r.addEventListener("focus",()=>{l.style.display="block"}),r.addEventListener("focusout",()=>{setTimeout(()=>l.style.display="none",200)})}}s.prototype.setUser=function(e){this.searchInput.value=e},s.prototype.autocompleteAuthor=function(e,t){e!==this._currentSearch&&(this._currentSearch=e,a&&clearTimeout(a),this.element.dataset.loading="",a=setTimeout(()=>{if(!e){t.innerHTML="",delete this.element.dataset.loading;return}this.get("full")?this.api.getUsers(e,e=>{delete this.element.dataset.loading,t.innerHTML="",e&&e.forEach&&e.forEach(e=>{let a=(0,o.default).create("LI",{text:e.public_name,className:"full",click:()=>{this.dispatchEvent({type:"select",user:e})},parent:t});e.profile_picture&&(0,o.default).create("IMG",{src:e.profile_picture,parent:a})})}):this.api.searchMapUsers({public_name:e},e=>{delete this.element.dataset.loading,t.innerHTML="",e&&e.forEach&&e.forEach(e=>{(0,o.default).create("LI",{html:e,click:()=>{this.dispatchEvent({type:"select",public_name:e})},parent:t})})})},500))};var n=s});var o=r("iQyfo"),s=r("2Fada"),n=r("gXJm2"),i=r("kbFhP"),u=r("l956U");r("gIJof");var c=r("5blsF"),p={param:{lon:2.9039299200561297,lat:47.071827259052185,rot:0,zoom:5,titre:"Vide",description:"Pas de description",status:"brouillon",controlParams:{limitGeo:"1",zoomBtn:"1",selectLayer:"1",contextMap:"1",legend:1,scaleLine:"1",pSearchBar:"1",coords:"0",attribution:1},proj:{valeur:"EPSG:4326",unite:"ds"}},legende:{legendVisible:!0,legendPos:"bottom-left",legendWidth:300,lineHeight:55,legendParam:{width:300,lineHeight:55},legendtitle:"Ma légende",legend:[]},layers:[{type:"Geoportail",name:"Plan IGN",titre:"sans-titre",visibility:!0,opacity:1,description:"Cartographie multi-échelles sur le territoire national, issue des bases de données vecteur de l’IGN, mis à jour régulièrement et réalisée selon un processus entièrement automatisé. Version actuellement en beta test",layer:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2"},{type:"WMTS",name:"Visualisation OCSGE Gers",titre:"Visualisation OCSGE Gers",visibility:!0,opacity:1,description:"Résultat IA aggloméré à l'ortho",wmtsparam:{layer:{title:"Visualisation OCSGE Gers",extent:[-35807.47268652755,5354917.644568233,136449.86583985508,5482201.678868297],abstract:"Résultat IA aggloméré à l'ortho",maxResolution:2445.98490512564},source:{url:"https://wxs-v.geo.rie.gouv.fr/geoportail/wmts?",layer:"OCSGE_VISU_PYR-PNG_WM_20220602",matrixSet:"PM",format:"image/png",projection:"EPSG:3857",minZoom:6,maxZoom:18,style:"nolegend",attributions:["IGN"],crossOrigin:"anonymous",wrapX:!0},data:{title:"Visualisation OCSGE Gers",abstract:"Résultat IA aggloméré à l'ortho",legend:["https://wxs-v.geo.rie.gouv.fr/static/legends/LEGEND.jpg"]}}},{dessin:!0,type:"Vector",name:"Dessin",titre:"sans-titre",visibility:!0,opacity:1,popupContent:{},style:{},features:[]}],symbolLib:{}},d=r("bS8Lk"),m=r("2iBkg");function f(e){e instanceof Element?(0,n.default).getAppElement().appendChild(e):(0,o.default).create("DIV",{html:e,parent:(0,n.default).getAppElement()})}function h(e){let t=g.value;(0,i.default).showWait("Chargement en cours..."),(0,s.default).getMaps({context:e,query:t},a=>{if(a.error)401===a.status?(0,i.default).showAlert("Vous devez être connecté pour accéder aux cartes...",{ok:"ok",connect:"connexion"},e=>{"connect"===e&&setTimeout(()=>(0,n.default).connect(),200)}):(0,i.default).showAlert("Impossible d'accéder aux cartes..."),f(a.status+" : "+a.statusText);else if(f("Cartes "+(e||(0,s.default).getMe().public_name)+" : "+a.maps.length+" / "+a.count.toLocaleString()+" carte(s)"),t&&a.maps.length){console.log(a.maps[0]),f("<hr />"),a.maps[0].img_url&&(0,o.default).create("IMG",{src:(0,m.getMediaURL)(a.maps[0].img_url),parent:(0,n.default).getAppElement()});let e=(0,o.default).create("DIV",{html:a.maps[0].title+" ("+a.maps[0].type+") par "}),t=a.maps[0].user;(0,o.default).create("A",{html:t,target:"_new",href:"#",click:e=>{e.preventDefault(),(0,s.default).getUser(t,e=>{e.error||f(e.public_name+(e.presentation?"<br/>"+(0,u.default)(e.presentation):""))})},parent:e}),f(e),f("<hr />")}(0,i.default).hide()})}(0,n.default).setApp("api","api"),document.body.appendChild((0,n.default).getToolbarElement()),(0,o.default).create("BUTTON",{html:"Save carte",className:"button button-colored",click:()=>{(0,c.default)({title:"test",theme:"Agriculture",type:"macarte",premium:"default",bbox:[0,0,0,0]},e=>{(0,i.default).showWait("Enregistrement en cours..."),(0,s.default).postMap(e,p,e=>{e.error?(0,i.default).showAlert(e.statusText+"<br/>"+e.xhttp.response):((0,i.default).hide(),(0,d.default).show("Carte enregistrée"))})})},parent:(0,n.default).getAppElement()}),(0,n.default).addTool("maps","fg-map-lock","Admin",()=>{h("admin")}),(0,n.default).addTool("maps","fg-map-share","Atlas",()=>{h("atlas")}),(0,n.default).addTool("maps","fg-map-user","Mes cartes",()=>{h()});const g=(0,o.default).create("INPUT",{type:"search",placeHolder:"Rechercher dans l'Atlas",parent:(0,o.default).create("DIV",{className:"search",parent:(0,n.default).getToolbarElement()})});(0,s.default).on(["login","logout","error","disconnect"],e=>{f(e.type.toUpperCase()+("login"===e.type?" > "+e.user.public_name:""))}),window.api=s.default,window.charte=n.default,window.dialog=i.default;