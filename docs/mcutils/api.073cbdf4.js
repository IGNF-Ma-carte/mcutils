function e(e,t,a,i){Object.defineProperty(e,t,{get:a,set:i,enumerable:!0,configurable:!0})}var t=globalThis,a={},i={},l=t.parcelRequire8969;null==l&&((l=function(e){if(e in a)return a[e].exports;if(e in i){var t=i[e];delete i[e];var l={id:e,exports:{}};return a[e]=l,t.call(l.exports,l,l.exports),l.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){i[e]=t},t.parcelRequire8969=l);var r=l.register;r("5blsF",function(t,a){let i;e(t.exports,"default",()=>f);var r=l("c6CRU"),s=l("kbFhP"),n=l("c86V7"),o=l("2Fada"),u=l("iQyfo"),c=l("467x5"),d=l("cvawf"),p=l("l956U"),h=l("4XpLa");l("1HEmm");let m=`
<ul>
  <li class="info">
    Pour enregistrer une carte dans votre espace personnel, remplissez le formulaire.
  </li>
  <li class="accent">
    Vous devez renseigner les champs obligatoires...
  </li>
  <li data-attr="title">
    <input class="title input-placeholder required" type="text" placeholder="Titre de la carte">
  </li>
  <li data-attr="description">
    <textarea class="description input-placeholder" type="text" placeholder="Description"></textarea>
  </li>
  <li data-attr="theme">
    <span class="required">Th\xe8me</span> :
    <select class="theme"></select>
  </li>
  <li data-attr="img_url">
    Image d'illustration :
    <br/>
    <input type="text" class="image" />
  </li>
  <li data-attr="share">
    Partage :
    <select class="share">
      <option value="private">Priv\xe9e</option>
      <option value="public">Publique</option>
      <option value="atlas">Atlas</option>
    </select>
  </li>
`;var f=function(e,t,a){a=a||{},t="function"==typeof t?t:()=>{};let l={};if(e instanceof c.default||e instanceof d.default?((l=e.get("atlas")||{}).title||(l.title=e.get("title")||""),l.description||(l.description=(0,p.default).text(e.get("description"))||""),l.img_url||(l.img_url=e.get("logo")||"")):l=e,a.saveAs){let e=l;l={},["active","description","img_url","theme","theme_id","title","type","premium"].forEach(t=>{l[t]=e[t]})}l.organization_id||(l.organization_id=(0,h.default).getId()),void 0===l.active&&(l.active=!0),(0,s.default).show({title:a.prompt||"Enregistrer une carte",className:("mc-save-map "+(a.className||"")).trim(),content:m,buttons:{submit:"Enregistrer",cancel:"annuler"},onButton:(a,r)=>{if("submit"===a){if(r.title.classList.remove("invalid"),r.theme.classList.remove("invalid"),!r.title.value||!r.theme.value){f.style.display="block",r.title.value||r.title.classList.add("invalid"),r.theme.value||r.theme.classList.add("invalid");return}l.title=r.title.value,l.description=r.description.value,l.theme_id=r.theme.value,l.theme=i[r.theme.value],l.img_url=r.image.value,l.share=r.share.value,(e instanceof c.default||e instanceof d.default)&&e.set("atlas",l),(0,s.default).hide(),t(e,l)}}});let f=(0,s.default).getContentElement().querySelector(".accent"),g=(0,s.default).getInputs();g.title.value=l.title||"",g.description.value=l.description||"",g.image.value=l.img_url||"",g.share.value=l.share||((0,h.default).getId()?"private":"public"),(0,h.default).getId()&&!(0,h.default).isOwner()&&(g.share.disabled=!0),g.title.addEventListener("change",()=>{g.title.classList.remove("invalid")}),g.theme.addEventListener("change",()=>{g.theme.classList.remove("invalid")}),(0,r.default).setInputPlaceholder((0,s.default).getContentElement());let v=e=>{if(e){if(e.error)return;i={},e.forEach(e=>{i[e.id]=e.name})}let t=(0,s.default).getContentElement().querySelector("select");(0,u.default).create("OPTION",{html:"Choisir un theme...",value:"",disabled:!0,selected:!0,parent:t}),Object.keys(i).forEach(e=>{let a=(0,u.default).create("OPTION",{html:i[e],value:e,parent:t});i[e]===l.theme&&(a.selected=!0)})};return i?v():(0,o.default).getThemes(v),window.api=o.default,new n.default({add:!0,input:(0,s.default).getContentElement().querySelector("input.image")}),s.default}}),r("c86V7",function(t,a){e(t.exports,"default",()=>u);var i=l("iQyfo"),r=l("fnScq"),s=l("2iBkg"),n=l("jmRXz");class o extends r.default{constructor(e){super(e=e||{}),this.input=e.input||(0,i.default).create("INPUT",{type:"url",parent:e.parent}),this.input.placeholder=e.placeholder||"Url de l'image",this.input.type="text",this.value=this.input.value,this.set("fullpath",e.fullpath);let t=this.element=(0,i.default).create("DIV",{className:"mc-input-media"});this.input.parentNode.insertBefore(t,this.input),this._imgDiv=(0,i.default).create("DIV",{className:"mc-img",parent:t});let a=this._img=new Image;a.onerror=()=>{t.classList.remove("loading"),this._imgDiv.style["background-image"]="",this.input.value?this.input.classList.add("invalid"):this.input.classList.remove("invalid"),this.value="",this.dispatchEvent({type:"load",value:this.value,error:!0})},a.onload=()=>{if(t.classList.remove("loading"),this._imgDiv.style["background-image"]="url("+a.src+")",this.value=a.src,this.input.classList.remove("invalid"),this.set("crossOrigin",!1),e.useCors){let e=new Image;e.crossOrigin="anonymous",e.onload=()=>{this.set("crossOrigin","anonymous"),this.dispatchEvent({type:"load",value:this.value})},e.onerror=()=>{this.dispatchEvent({type:"load",value:this.value})},e.src=a.src}else this.dispatchEvent({type:"load",value:this.value})},this.value&&(a.src=(0,s.getMediaURL)(this.value)),t.appendChild(this.input),this.input.addEventListener("change",()=>{this.setValue(this.input.value),this.value="",l.style.display=this.input.value?"":"none"}),this.input.addEventListener("keyup",()=>{l.style.display=this.input.value?"":"none"});let l=(0,i.default).create("BUTTON",{className:"delete",type:"button",style:{display:this.input.value?"":"none"},title:e.btnTitle||"Chercher dans la galerie...",html:'<i class="fa fa-times"></i>',click:()=>{this.value="del",this.setValue(""),this.input.focus()},parent:t}),r=e.thumb;(0,i.default).create("BUTTON",{className:"button-colored user-media",type:"button",title:e.btnTitle||"Chercher dans la galerie...",html:'<i class="fi-galerie-image"></i>',click:()=>{(0,n.default)({thumb:r,add:e.add,callback:e=>{r=e.thumb;let t=e.thumb?e.item.thumb_url:e.item.view_url;this.get("fullpath")?this.setValue(t):this.setValue(t.split("/").pop())}})},parent:t})}}o.prototype.getValue=function(){return this.input.value},o.prototype.setValue=function(e){this.value!==e&&(this.value=e,this.element.classList.add("loading"),this.input.value=e,this._img.src=(0,s.getMediaURL)(e),this.input.dispatchEvent(new Event("change")))};var u=o}),r("agEcb",function(e,t){function a(t){return e.exports=a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,a(t)}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports}),r("9Mq5w",function(e,t){var a,i,l,r=e.exports={};function s(){throw Error("setTimeout has not been defined")}function n(){throw Error("clearTimeout has not been defined")}function o(e){if(a===setTimeout)return setTimeout(e,0);if((a===s||!a)&&setTimeout)return a=setTimeout,setTimeout(e,0);try{return a(e,0)}catch(t){try{return a.call(null,e,0)}catch(t){return a.call(this,e,0)}}}!function(){try{a="function"==typeof setTimeout?setTimeout:s}catch(e){a=s}try{i="function"==typeof clearTimeout?clearTimeout:n}catch(e){i=n}}();var u=[],c=!1,d=-1;function p(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&h())}function h(){if(!c){var e=o(p);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===n||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function f(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];u.push(new m(e,t)),1!==u.length||c||o(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}),r("kMG75",function(t,a){let i;e(t.exports,"default",()=>o);var r=l("fnScq"),s=l("iQyfo");class n extends r.default{constructor(e,t){super(),t=t||{},this.set("full",!!t.full),this.api=e;let a=this.element=(0,s.default).create("DIV",{className:"author-list",parent:t.target}),i=this.searchInput=(0,s.default).create("INPUT",{type:"text",className:"author",placeholder:"chercher un membre...",parent:a});(0,s.default).create("I",{className:"loading",parent:a});let l=(0,s.default).create("UL",{className:"autocomplete",parent:a});i.addEventListener("keyup",()=>{this.autocompleteAuthor(i.value,l)}),i.addEventListener("focus",()=>{l.style.display="block"}),i.addEventListener("focusout",()=>{setTimeout(()=>l.style.display="none",200)})}}n.prototype.setUser=function(e){this.searchInput.value=e},n.prototype.autocompleteAuthor=function(e,t){e!==this._currentSearch&&(this._currentSearch=e,i&&clearTimeout(i),this.element.dataset.loading="",i=setTimeout(()=>{if(!e){t.innerHTML="",delete this.element.dataset.loading;return}this.get("full")?this.api.getUsers(e,e=>{delete this.element.dataset.loading,t.innerHTML="",e&&e.forEach&&e.forEach(e=>{let a=(0,s.default).create("LI",{text:e.public_name,className:"full",click:()=>{this.dispatchEvent({type:"select",user:e})},parent:t});e.profile_picture&&(0,s.default).create("IMG",{src:e.profile_picture,parent:a})})}):this.api.searchMapUsers({public_name:e},e=>{delete this.element.dataset.loading,t.innerHTML="",e&&e.forEach&&e.forEach(e=>{(0,s.default).create("LI",{html:e,click:()=>{this.dispatchEvent({type:"select",public_name:e})},parent:t})})})},500))};var o=n}),r("4AFFV",function(e,t){});var s=l("iQyfo"),n=l("2Fada"),o=l("gXJm2"),u=l("kbFhP"),c=l("l956U");l("gIJof");var d=l("5blsF"),p={param:{lon:2.9039299200561297,lat:47.071827259052185,rot:0,zoom:5,titre:"Vide",description:"Pas de description",status:"brouillon",controlParams:{limitGeo:"1",zoomBtn:"1",selectLayer:"1",contextMap:"1",legend:1,scaleLine:"1",pSearchBar:"1",coords:"0",attribution:1},proj:{valeur:"EPSG:4326",unite:"ds"}},legende:{legendVisible:!0,legendPos:"bottom-left",legendWidth:300,lineHeight:55,legendParam:{width:300,lineHeight:55},legendtitle:"Ma légende",legend:[]},layers:[{type:"Geoportail",name:"Plan IGN",titre:"sans-titre",visibility:!0,opacity:1,description:"Cartographie multi-échelles sur le territoire national, issue des bases de données vecteur de l’IGN, mis à jour régulièrement et réalisée selon un processus entièrement automatisé. Version actuellement en beta test",layer:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2"},{type:"WMTS",name:"Visualisation OCSGE Gers",titre:"Visualisation OCSGE Gers",visibility:!0,opacity:1,description:"Résultat IA aggloméré à l'ortho",wmtsparam:{layer:{title:"Visualisation OCSGE Gers",extent:[-35807.47268652755,5354917.644568233,136449.86583985508,5482201.678868297],abstract:"Résultat IA aggloméré à l'ortho",maxResolution:2445.98490512564},source:{url:"https://wxs-v.geo.rie.gouv.fr/geoportail/wmts?",layer:"OCSGE_VISU_PYR-PNG_WM_20220602",matrixSet:"PM",format:"image/png",projection:"EPSG:3857",minZoom:6,maxZoom:18,style:"nolegend",attributions:["IGN"],crossOrigin:"anonymous",wrapX:!0},data:{title:"Visualisation OCSGE Gers",abstract:"Résultat IA aggloméré à l'ortho",legend:["https://wxs-v.geo.rie.gouv.fr/static/legends/LEGEND.jpg"]}}},{dessin:!0,type:"Vector",name:"Dessin",titre:"sans-titre",visibility:!0,opacity:1,popupContent:{},style:{},features:[]}],symbolLib:{}},h=l("bS8Lk"),m=l("2iBkg");function f(e){e instanceof Element?(0,o.default).getAppElement().appendChild(e):(0,s.default).create("DIV",{html:e,parent:(0,o.default).getAppElement()})}function g(e){let t=v.value;(0,u.default).showWait("Chargement en cours..."),(0,n.default).getMaps({context:e,query:t},a=>{if(a.error)401===a.status?(0,u.default).showAlert("Vous devez être connecté pour accéder aux cartes...",{ok:"ok",connect:"connexion"},e=>{"connect"===e&&setTimeout(()=>(0,o.default).connect(),200)}):(0,u.default).showAlert("Impossible d'accéder aux cartes..."),f(a.status+" : "+a.statusText);else if(f("Cartes "+(e||(0,n.default).getMe().public_name)+" : "+a.maps.length+" / "+a.count.toLocaleString()+" carte(s)"),t&&a.maps.length){console.log(a.maps[0]),f("<hr />"),a.maps[0].img_url&&(0,s.default).create("IMG",{src:(0,m.getMediaURL)(a.maps[0].img_url),parent:(0,o.default).getAppElement()});let e=(0,s.default).create("DIV",{html:a.maps[0].title+" ("+a.maps[0].type+") par "}),t=a.maps[0].user;(0,s.default).create("A",{html:t,target:"_new",href:"#",click:e=>{e.preventDefault(),(0,n.default).getUser(t,e=>{e.error||f(e.public_name+(e.presentation?"<br/>"+(0,c.default)(e.presentation):""))})},parent:e}),f(e),f("<hr />")}(0,u.default).hide()})}(0,o.default).setApp("api","api"),document.body.appendChild((0,o.default).getToolbarElement()),(0,s.default).create("BUTTON",{html:"Save carte",className:"button button-colored",click:()=>{(0,d.default)({title:"test",theme:"Agriculture",type:"macarte",premium:"default",bbox:[0,0,0,0]},e=>{(0,u.default).showWait("Enregistrement en cours..."),(0,n.default).postMap(e,p,e=>{e.error?(0,u.default).showAlert(e.statusText+"<br/>"+e.xhttp.response):((0,u.default).hide(),(0,h.default).show("Carte enregistrée"))})})},parent:(0,o.default).getAppElement()}),(0,o.default).addTool("maps","fg-map-lock","Admin",()=>{g("admin")}),(0,o.default).addTool("maps","fg-map-share","Atlas",()=>{g("atlas")}),(0,o.default).addTool("maps","fg-map-user","Mes cartes",()=>{g()});const v=(0,s.default).create("INPUT",{type:"search",placeHolder:"Rechercher dans l'Atlas",parent:(0,s.default).create("DIV",{className:"search",parent:(0,o.default).getToolbarElement()})});(0,n.default).on(["login","logout","error","disconnect"],e=>{f(e.type.toUpperCase()+("login"===e.type?" > "+e.user.public_name:""))}),window.api=n.default,window.charte=o.default,window.dialog=u.default;