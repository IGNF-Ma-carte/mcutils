function t(t,e,i,l){Object.defineProperty(t,e,{get:i,set:l,enumerable:!0,configurable:!0})}var e=globalThis,i={},l={},a=e.parcelRequire8969;null==a&&((a=function(t){if(t in i)return i[t].exports;if(t in l){var e=l[t];delete l[t];var a={id:t,exports:{}};return i[t]=a,e.call(a.exports,a,a.exports),a.exports}var s=Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(t,e){l[t]=e},e.parcelRequire8969=a);var s=a.register;s("c86V7",function(e,i){t(e.exports,"default",()=>u);var l=a("iQyfo"),s=a("fnScq"),n=a("2iBkg"),o=a("jmRXz");class r extends s.default{constructor(t){super(t=t||{}),this.input=t.input||(0,l.default).create("INPUT",{type:"url",parent:t.parent}),this.input.placeholder=t.placeholder||"Url de l'image",this.input.type="text",this.value=this.input.value,this.set("fullpath",t.fullpath);let e=this.element=(0,l.default).create("DIV",{className:"mc-input-media"});this.input.parentNode.insertBefore(e,this.input),this._imgDiv=(0,l.default).create("DIV",{className:"mc-img",parent:e});let i=this._img=new Image;i.onerror=()=>{e.classList.remove("loading"),this._imgDiv.style["background-image"]="",this.input.value?this.input.classList.add("invalid"):this.input.classList.remove("invalid"),this.value="",this.dispatchEvent({type:"load",value:this.value,error:!0})},i.onload=()=>{if(e.classList.remove("loading"),this._imgDiv.style["background-image"]="url("+i.src+")",this.value=i.src,this.input.classList.remove("invalid"),this.set("crossOrigin",!1),t.useCors){let t=new Image;t.crossOrigin="anonymous",t.onload=()=>{this.set("crossOrigin","anonymous"),this.dispatchEvent({type:"load",value:this.value})},t.onerror=()=>{this.dispatchEvent({type:"load",value:this.value})},t.src=i.src}else this.dispatchEvent({type:"load",value:this.value})},this.value&&(i.src=(0,n.getMediaURL)(this.value)),e.appendChild(this.input),this.input.addEventListener("change",()=>{this.setValue(this.input.value),this.value="",a.style.display=this.input.value?"":"none"}),this.input.addEventListener("keyup",()=>{a.style.display=this.input.value?"":"none"});let a=(0,l.default).create("BUTTON",{className:"delete",type:"button",style:{display:this.input.value?"":"none"},title:t.btnTitle||"Chercher dans la galerie...",html:'<i class="fa fa-times"></i>',click:()=>{this.value="del",this.setValue(""),this.input.focus()},parent:e}),s=t.thumb;(0,l.default).create("BUTTON",{className:"button-colored user-media",type:"button",title:t.btnTitle||"Chercher dans la galerie...",html:'<i class="fi-galerie-image"></i>',click:()=>{(0,o.default)({thumb:s,add:t.add,callback:t=>{s=t.thumb;let e=t.thumb?t.item.thumb_url:t.item.view_url;this.get("fullpath")?this.setValue(e):this.setValue(e.split("/").pop())}})},parent:e})}}r.prototype.getValue=function(){return this.input.value},r.prototype.setValue=function(t){this.value!==t&&(this.value=t,this.element.classList.add("loading"),this.input.value=t,this._img.src=(0,n.getMediaURL)(t),this.input.dispatchEvent(new Event("change")))};var u=r}),s("hgFwk",function(e,i){t(e.exports,"showHelp",()=>u),t(e.exports,"default",()=>c);var l=a("6od7S"),s=a("kOWwI"),n=a("l956U"),o=a("iQyfo");a("4k2SX");let r=new l.default({className:"md",closeBox:!0,target:document.body});function u(t,e){e=e||{},r.show({title:e.title||"",content:(0,n.default)(t,e.mdOptions),className:"help",buttons:e.buttons||["ok"],onButton:e.onButton}),r.element.classList.remove("large"),r.element.classList.remove("medium"),r.element.classList.remove("small"),(e.className||"").split(" ").forEach(t=>{r.element.classList.add(t||"large")}),(0,n.default).renderWidget(r.element)}r.setMap(s.default),r.on("hide",()=>r.setContent("none")),r.on("show",()=>r.getContentElement().scrollTop=0);var c=function(t,e,i){i=i||"","I"===t.tagName?(t.classList.add("mc-help"),t.title=i.title||"aide..."):t=(0,o.default).create("I",{className:"mc-help",title:i.title||"aide...",parent:t}),t.addEventListener("click",t=>{t.stopPropagation(),t.preventDefault(),u(e,i)})}}),s("11Wcd",function(e,i){t(e.exports,"default",()=>o);var l=a("iQyfo"),s=a("h5s17");class n extends s.default{constructor(t){let e=(t=t||{}).symbolLib;super({target:t.target,className:"mcSymbolLib"+(t.className?" "+t.className:""),collection:e,getTitle:i=>{if(!(!t.filter||t.filter.indexOf(i.getType())>=0))return(0,l.default).create("DIV",{className:"hidden"});{let a=(0,l.default).create("DIV",{className:"mcSymbol"});a.appendChild(i.getImage());let s=(0,l.default).create("INPUT",{type:"text",placeholder:"nom du symbole",value:i.get("name"),on:{focusout:()=>{delete a.dataset.edit},keydown:t=>{switch(t.key){case"Enter":i.set("name",s.value),n.innerText=s.value;case"Escape":delete a.dataset.edit,t.preventDefault()}}},parent:a}),n=(0,l.default).create("SPAN",{text:i.get("name"),parent:a});return!1!==t.edit&&((0,l.default).create("I",{className:"fi-pencil",title:"modifier le nom",click:()=>{a.dataset.edit="",s.focus();let t=s.value;s.value="",s.value=t},parent:a}),(0,l.default).create("I",{className:"fg-color",title:"modifier / dupliquer le style",click:()=>{this.dispatchEvent({type:"item:duplicate",item:i})},parent:a}),(0,l.default).create("i",{className:"fi-delete",title:"supprimer le style",click:()=>{e.remove(i),this.dispatchEvent({type:"item:remove"})},parent:a})),a}}})}}var o=n}),s("h5s17",function(e,i){t(e.exports,"default",()=>n);var l=a("fnScq"),s=a("iQyfo"),n=class extends l.default{constructor(t){super(),this.element=(0,s.default).create("UL",{className:("ol-collection-list "+(t.className||"")).trim(),parent:t.target}),this._title="function"==typeof t.getTitle?t.getTitle:function(t){return t.title},this.setCollection(t.collection)}removeCollection(){this.collection&&(this.collection.un("change:length",this._update),this.collection=null)}setCollection(t){this.removeCollection(),this.collection=t,this.refresh(),this.collection&&(this._update=(function(){if(!this._reorder){this.refresh();var t=this.getSelectPosition();t<0?this.dispatchEvent({type:"item:select",position:-1,item:null}):this.dispatchEvent({type:"item:order",position:t,item:this._currentItem})}}).bind(this),this.collection.on("change:length",this._update))}select(t){if(t!==this._currentItem){var e=-1;this._listElt.forEach(function(i,l){i.item!==t?i.li.classList.remove("ol-select"):(i.li.classList.add("ol-select"),e=l)}),this._currentItem=e>=0?t:null,this.dispatchEvent({type:"item:select",position:e,item:this._currentItem})}}selectAt(t){this.select(this.collection.item(t))}getSelect(){return this._currentItem}getSelectPosition(){return this.collection?this.collection.getArray().indexOf(this._currentItem):-1}refresh(t){this.element.innerHTML="",this._listElt=[],this.collection&&this.collection.forEach((e,i)=>{var l=(0,s.default).create("LI",{html:this._title(e),className:this._currentItem===e?"ol-select":"","data-position":i,on:{click:(function(){this.select(e)}).bind(this),dblclick:(function(){this.dispatchEvent({type:"item:dblclick",position:i,item:e})}).bind(this)},parent:this.element}),a=(0,s.default).create("INPUT",{"aria-label":this._title(e),type:"checkbox",className:"ol-input-focus",on:{keydown:(function(t){switch(t.key){case"ArrowUp":case"ArrowDown":if(t.ctrlKey){t.preventDefault(),t.stopPropagation(),this.select(e);var l="ArrowUp"===t.key?i-1:i+1;l>=0&&l<this.collection.getLength()&&(this._reorder=!0,this.collection.removeAt(i),this.collection.insertAt(l,e),this._reorder=!1,this.dispatchEvent({type:"item:order",position:l,oldPosition:i,item:e}),this.refresh(e))}break;case" ":case"Space":t.preventDefault(),t.stopPropagation(),this.select(e);break;case"Tab":break;default:this.dispatchEvent({type:"item:keydown",key:t.key,originalEvent:t,position:i,item:e})}}).bind(this)},parent:l});t===e&&a.focus(),this._listElt.push({li:l,item:e});var n=(0,s.default).create("DIV",{className:"ol-noscroll ol-order",parent:l}),o=i,r=(function(t){for(var e="touch"===t.pointerType?document.elementFromPoint(t.clientX,t.clientY):t.target;e&&e.parentNode!==this.element;)e=e.parentNode;if(e&&e!==l){var i=parseInt(e.getAttribute("data-position"));e.getAttribute("data-position")<o?(e.insertAdjacentElement("beforebegin",l),o=i):(e.insertAdjacentElement("afterend",l),o=i+1)}}).bind(this),u=(function(){document.removeEventListener("pointermove",r),document.removeEventListener("pointerup",u),document.removeEventListener("pointercancel",u),o!==i&&(this._reorder=!0,this.collection.removeAt(i),this.collection.insertAt(o>i?o-1:o,e),this._reorder=!1,this.dispatchEvent({type:"item:order",position:o>i?o-1:o,oldPosition:i,item:e}),this.refresh())}).bind(this);n.addEventListener("pointerdown",(function(){this.select(e),document.addEventListener("pointermove",r),document.addEventListener("pointerup",u),document.addEventListener("pointercancel",u)}).bind(this))})}}}),s("agEcb",function(t,e){function i(e){return t.exports=i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,i(e)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports}),s("kMG75",function(e,i){let l;t(e.exports,"default",()=>r);var s=a("fnScq"),n=a("iQyfo");class o extends s.default{constructor(t,e){super(),e=e||{},this.set("full",!!e.full),this.api=t;let i=this.element=(0,n.default).create("DIV",{className:"author-list",parent:e.target}),l=this.searchInput=(0,n.default).create("INPUT",{type:"text",className:"author",placeholder:"chercher un membre...",parent:i});(0,n.default).create("I",{className:"loading",parent:i});let a=(0,n.default).create("UL",{className:"autocomplete",parent:i});l.addEventListener("keyup",()=>{this.autocompleteAuthor(l.value,a)}),l.addEventListener("focus",()=>{a.style.display="block"}),l.addEventListener("focusout",()=>{setTimeout(()=>a.style.display="none",200)})}}o.prototype.setUser=function(t){this.searchInput.value=t},o.prototype.autocompleteAuthor=function(t,e){t!==this._currentSearch&&(this._currentSearch=t,l&&clearTimeout(l),this.element.dataset.loading="",l=setTimeout(()=>{if(!t){e.innerHTML="",delete this.element.dataset.loading;return}this.get("full")?this.api.getUsers(t,t=>{delete this.element.dataset.loading,e.innerHTML="",t&&t.forEach&&t.forEach(t=>{let i=(0,n.default).create("LI",{text:t.public_name,className:"full",click:()=>{this.dispatchEvent({type:"select",user:t})},parent:e});t.profile_picture&&(0,n.default).create("IMG",{src:t.profile_picture,parent:i})})}):this.api.searchMapUsers({public_name:t},t=>{delete this.element.dataset.loading,e.innerHTML="",t&&t.forEach&&t.forEach(t=>{(0,n.default).create("LI",{html:t,click:()=>{this.dispatchEvent({type:"select",public_name:t})},parent:e})})})},500))};var r=o});var n=a("gXJm2"),o=a("cvawf"),r=a("fnScq"),u=a("c86V7"),c=a("aQBQL"),p=a("5uHkz"),d=a("j6lPQ"),h=a("86esn"),m={label:`**Ajouter une \xe9tiquette ?**
Vous pouvez ajouter une \xe9tiquette \xe0 un objet sur la carte. Celle-ci permettra de d\xe9signer l'objet en affichant un texte associ\xe9 \xe0 l'objet.
Pour utiliser un attributs de l'obet comme \xe9tiquette indiqu\xe9 le sous la forme \`%nom_de_l_attribut%\`.`};a("gIJof");var b=a("fEcTz"),y=a("a10XN"),f=a("iQyfo"),v=a("c6CRU"),g=a("hgFwk"),x=a("jelRt"),f=a("iQyfo"),_=a("fP3gd");class S extends _.default{constructor(t){super(t=t||{}),this.element.classList.add("ol-arrow"),this.input.type="text";let e=(0,f.default).create("DIV",{className:"vignet",parent:this.element}),i=[],l=["","triangle","circle","square"];l.forEach(t=>{i.push((0,f.default).create("DIV",{html:(0,f.default).create("DIV",{className:"arrow-"+(t||"none")}),click:()=>{this.setValue(t),this.collapse(!0)},parent:this._elt.popup}))}),this.input.addEventListener("change",()=>{setTimeout(()=>{i.forEach((t,e)=>{t.className=this.input.value===l[e]?"selected":""}),e.className="vignet arrow-"+(this.input.value||"none")})}),this.setValue(this.input.value)}}var k=a("cHblF"),E=a("kkNxo"),L=a("11Wcd"),w=a("4k2SX"),I={};I='<div data-role="tabs" class="onglets" data-show> <div class="title" data-title> <div data-tab="symbol" class="symbol"> Symbole </div><div data-tab="stroke" class="stroke"> Dessin </div><div data-tab="text" class="text"> Etiquette </div> </div> <div data-type="symbol"> <select> <option value="symbol">Symbole</option> <option value="image">Image</option> <option value="label">Annotation</option> </select> <ul class="symbol"> <li data-attr="pointIcon"> <label>Image</label> <input type="url"> </li> <li data-attr="pointFrame"> <label>Forme</label> <select type="select"></select> </li> <li class="check" data-attr="pointCrop"> <label class="ol-ext-check ol-ext-checkbox"> Remplir <input type="checkbox"><span></span> </label> </li> <li data-attr="pointGlyph"> <label>Symbole</label> <input type="text"> </li> <li data-attr="symbolColor"> <label>Couleur<br>du symbole</label> <input type="text"> </li> <li data-attr="pointForm"> <label>Forme</label> <i></i><select type="select"></select> </li> <li data-attr="pointStrokeColor"> <label>Contour de la forme</label> <input type="text"> </li> <li data-attr="pointColor"> <label>Intérieur de la forme</label> <input type="text"> </li> <li data-attr="pointStrokeWidth"> <label>Taille du contour</label> <input type="number" min="0"> </li> <li data-attr="pointRadius"> <label>Taille</label> <input type="number" min="0"> </li> <li class="check" data-attr="pointGradient"> <label class="ol-ext-check ol-ext-checkbox"> Gradient <input type="checkbox"><span></span> </label> </li> </ul> </div> <div data-type="stroke"> <ul class="stroke"> <li data-attr="strokeColor"> <label>Couleur du&nbsp;contour</label> <input type="text"> </li> <li data-attr="fillColor"> <label>Couleur du&nbsp;motif</label> <input type="text"> </li> <li data-attr="fillPattern"> <label>Motifs</label> <input type="text"> </li> <li data-attr="fillColorPattern"> <label>Couleur du&nbsp;fond</label> <input type="text"> </li> <li data-attr="strokeWidth"> <label>Epaisseur de&nbsp;trait</label> <input type="number" min="0" step=".1"> </li> <li data-attr="strokeDash"> <label>Pointillés</label> <input type="number" min="0"> </li> <li data-attr="strokeArrow"> <label>Terminaison</label> <input type="text"> </li> </ul> </div> <div data-type="text"> <ul class="text"> <li data-attr="labelAttribute"> <label> Etiquette <i data-help="label"></i> </label> <textarea class="input-placeholder" placeholder="mon %attribut%"></textarea> </li> <li data-attr="textColor"> <label>Couleur</label> <input type="text"> </li> <li data-attr="textSize"> <label>Taille</label> <input type="number" min="0"> </li> <li data-attr="textFont"> <label>Police</label> <select></select> </li> <li data-attr="textAlign"> <label>Alignement horizontal</label> <select type="text"></select> </li> <li data-attr="textBaseline"> <label>Alignement vertical</label> <select type="text"></select> </li> <li data-attr="textBgFill"> <label>Couleur<br>du fond</label> <input type="text"> </li> <li data-attr="textBgStroke"> <label>Couleur<br>du bord</label> <input type="text"> </li> <li class="check" data-attr="textPlacement"> <label class="ol-ext-check ol-ext-checkbox"> Texte le long <input type="checkbox"><span></span> </label> </li> <li class="check" data-attr="textOverflow"> <label class="ol-ext-check ol-ext-checkbox"> Autoriser les dépassements <input type="checkbox"><span></span> </label> </li> </ul> </div> <div data-type="all"> <ul> <li data-attr="zIndex"> <label>Empilement</label> <input type="number"> </li> </ul> </div> <div class="symbolLib"> <h3> Bibliothèque </h3> <p> Ajoutez vos symboles à la bibliothèque pour les retrouver facilement </p> <div class="add"> <button class="add button button-ghost" type="button"> <i class="fi-add"></i> Ajouter </button> <button class="button button-ghost lib" type="button"> <i class="fa fa-book"></i> Utiliser </button> </div> <div class="lib"> <button class="button button-colored lib" type="button"> <i class="fg-color"></i> Bibliothèque de symboles... </button> </div> </div> </div><div class="preview"> <div class="Point"> <label>Points</label> <div class="img"><p></p></div> </div><div class="LineString"> <label>Lignes</label> <div class="img"><p></p></div> </div><div class="Polygon"> <label>Surfaces</label> <div class="img"><p></p></div> </div> </div>';const P={point:"Point",line:"LineString",polygon:"Polygon"};class C extends r.default{constructor(t){var e;let i;super(),this._style=Object.assign({},h.defaultIgnStyle),this._inputs={};let l=this.element=(0,f.default).create("DIV",{html:(e=I)&&e.__esModule?e.default:e,parent:t.target});l.className="",l.dataset.formstyle="",(0,v.default).initTabList(l),this._initFormCommon(l,t),this._initFormPointSymbol(l,t),this._initFormPointText(l,t),this._initFormDraw(l,t),(0,v.default).setInputPlaceholder(),this.setStyle(t.style||h.defaultIgnStyle),t.symbolLib?((0,g.default)(l.querySelector(".symbolLib h3"),(0,w.default)("mc-help-symbolLib"),{className:"medium"}),l.querySelector(".symbolLib button.lib").addEventListener("click",()=>{let e=new L.default({filter:P[l.className]?[P[l.className]]:void 0,symbolLib:t.symbolLib}),i=t=>{let e=t.getIgnStyle();this.setStyle(e,!0),Object.keys(e).forEach(t=>{this.dispatchEvent({type:"change",attr:t,value:e[t]})})};(0,E.default).show({title:"Bibliothèque de symboles",className:"symbolLib",content:e.element,buttons:{ok:"Utiliser",cancel:"annuler"},onButton:t=>{"ok"===t&&i(e.getSelect())}}),(0,E.default).element.querySelector(".ol-buttons input").disabled=!0,e.on(["item:select","item:remove"],t=>{(0,E.default).element.querySelector(".ol-buttons input").disabled="item:select"!==t.type}),e.on("item:dblclick",()=>{i(e.getSelect()),(0,E.default).close()}),e.on("item:duplicate",e=>{C.addSymbolLibDialog(t.symbolLib,e.item,t=>{i(t)})});let a=()=>{e.removeCollection(),(0,E.default).un("hide",a)};(0,E.default).on("hide",a)}),l.querySelector(".symbolLib button.add").addEventListener("click",()=>{this.addSymbol(t.symbolLib)}),l.querySelector(".symbolLib .lib button.lib").addEventListener("click",()=>{C.showDialogEditor(t.symbolLib)})):l.querySelector(".symbolLib").className="noSymbolLib",t.preview&&(this.element.querySelector(".preview").classList.add("visible"),this.element.dataset.preview=t.preview);let a=this._preview=[],s={Point:{margin:0,size:[100,100]},LineString:{margin:5,size:[90,90]},Polygon:{margin:10,size:[60,40]}};Object.keys(s).forEach(t=>{a.push({symbol:new k.default({type:t,style:this.getStyle(),margin:s[t].margin,size:s[t].size}),element:this.element.querySelector(".preview ."+t)})}),a.forEach(t=>{t.element.querySelector("div").appendChild(t.symbol.getImage())}),this.on("change",t=>{/width|radius|size|offset/i.test(t.attr)?this._style[t.attr]=Number(t.value):this._style[t.attr]=t.value,i&&clearTimeout(i),i=setTimeout(()=>{a.forEach(t=>{t.symbol.setIgnStyle(this.getStyle())})})})}}C.prototype.addSymbol=function(t,e){let i=P[this.element.className];if(!i)return;let l=new k.default({name:"",style:this.getStyle(),type:i});(0,E.default).show({title:"Ajouter à la bibliothèque",content:'Nom du symbole : <input class="name" type="text" />',className:"addSymbolLib",buttons:{submit:"ajouter",cancel:"annuler"},onButton:(i,a)=>{"submit"===i&&(l.set("name",a.name.value),t.push(l),(0,E.default).hide(),"function"==typeof e&&e(l))}}),(0,E.default).getContentElement().appendChild(l.getImage())},C.prototype.dispatchEvent=function(t){this._silence||(0,r.default).prototype.dispatchEvent.call(this,t)},C.prototype._initFormPointSymbol=function(t){let e=this._inputs.pointType=t.querySelector('[data-type="symbol"] select');e.addEventListener("change",()=>{switch(e.value){case"label":this._inputs.pointRadius.setValue(0);break;case"symbol":this._inputs.pointIcon.setValue("");default:this.getStyle().pointRadius||this._inputs.pointRadius.setValue(h.defaultIgnStyle.pointRadius)}this.element.dataset.pointType=e.value}),this._inputs.pointIcon=new u.default({thumb:!0,add:!0,useCors:!0,input:t.querySelector('[data-attr="pointIcon"] input')}),this.setDispatch("pointIcon",!0),this._inputs.pointFrame=t.querySelector('[data-attr="pointFrame"] select'),Object.keys(h.pointFrameList).forEach(t=>{(0,f.default).create("OPTION",{value:t,html:h.pointFrameList[t].title,parent:this._inputs.pointFrame})}),this._inputs.pointFrame.addEventListener("change",()=>{this.element.dataset.frame=this._inputs.pointFrame.value||"none"}),this.setDispatch("pointFrame"),this._inputs.pointCrop=t.querySelector('[data-attr="pointCrop"] input'),this._inputs.pointCrop.addEventListener("change",()=>{this.dispatchEvent({type:"change",attr:"pointCrop",value:this._inputs.pointCrop.checked})}),this._inputs.pointStrokeWidth=new p.default({input:t.querySelector('[data-attr="pointStrokeWidth"] input')}),this.setDispatch("pointStrokeWidth",!0),this._inputs.pointRadius=new c.default({input:t.querySelector('[data-attr="pointRadius"] input')}),this.setDispatch("pointRadius",!0),this._inputs.pointGlyph=new b.default({input:t.querySelector('[data-attr="pointGlyph"] input')}),this._inputs.pointGlyph.on("select",()=>{this.dispatchEvent({type:"change",attr:"pointGlyph",value:this._inputs.pointGlyph.getValue()})}),this._inputs.symbolColor=new y.default({input:t.querySelector('[data-attr="symbolColor"] input'),position:"fixed"}),this.setDispatch("symbolColor",!0),this._inputs.pointForm=t.querySelector('[data-attr="pointForm"] select'),Object.keys(h.symbolFormList).forEach(t=>{(0,f.default).create("OPTION",{value:t,html:h.symbolFormList[t].title,parent:this._inputs.pointForm})}),this.setDispatch("pointForm");let i={shield:"bouclier",circle:"rond",square:"carre",hexagon:"hexagone",lozenge:"carre lozenge",bubble:"bulle",coma:"virgule",sign:"triangle triangle",ban:"rond"};this._inputs.pointForm.addEventListener("change",t=>{t.target.previousSibling.className="ign-form-"+(i[t.target.value]||t.target.value)}),this._inputs.pointStrokeColor=new y.default({input:t.querySelector('[data-attr="pointStrokeColor"] input'),position:"fixed"}),this.setDispatch("pointStrokeColor",!0),this._inputs.pointColor=new y.default({input:t.querySelector('[data-attr="pointColor"] input'),position:"fixed"}),this.setDispatch("pointColor",!0),this._inputs.pointGradient=t.querySelector('[data-attr="pointGradient"] input'),this._inputs.pointGradient.addEventListener("change",()=>{this.dispatchEvent({type:"change",attr:"pointGradient",value:this._inputs.pointGradient.checked})})},C.prototype._initFormPointText=function(t){t.querySelectorAll("i[data-help]").forEach(t=>{(0,g.default)(t,m[t.dataset.help],{className:"medium"})}),this._inputs.labelAttribute=t.querySelector('[data-attr="labelAttribute"] textarea'),this.setDispatch("labelAttribute"),this._inputs.textColor=new y.default({input:t.querySelector('[data-attr="textColor"] input'),position:"fixed"}),this.setDispatch("textColor",!0),this._inputs.textSize=t.querySelector('[data-attr="textSize"] input'),this.setDispatch("textSize"),this._inputs.textFont=t.querySelector('[data-attr="textFont"] select'),Object.keys(h.textFontList).forEach(e=>{(0,f.default).create("OPTION",{value:h.textFontList[e].font,style:{fontFamily:h.textFontList[e].font},html:h.textFontList[e].title,parent:t.querySelector('[data-attr="textFont"] select')})}),this.setDispatch("textFont"),this._inputs.textFont.addEventListener("change",()=>{this._inputs.textFont.style.fontFamily=this._inputs.textFont.value}),this._inputs.textAlign=t.querySelector('[data-attr="textAlign"] select');let e={right:"à gauche / fin",center:"centré",left:"à droite / début"};Object.keys(e).forEach(t=>{(0,f.default).create("OPTION",{class:t,value:t,html:e[t],parent:this._inputs.textAlign})}),this.setDispatch("textAlign"),this._inputs.textBaseline=t.querySelector('[data-attr="textBaseline"] select');let i={bottom:"en haut",middle:"centré",top:"en bas"};Object.keys(i).forEach(t=>{(0,f.default).create("OPTION",{class:t,value:t,html:i[t],parent:this._inputs.textBaseline})}),this.setDispatch("textBaseline"),this._inputs.textBgFill=new y.default({input:t.querySelector('[data-attr="textBgFill"] input'),position:"fixed"}),this.setDispatch("textBgFill",!0),this._inputs.textBgStroke=new y.default({input:t.querySelector('[data-attr="textBgStroke"] input'),position:"fixed"}),this.setDispatch("textBgStroke",!0),this._inputs.textPlacement=t.querySelector('[data-attr="textPlacement"] input'),this._inputs.textPlacement.addEventListener("change",()=>{this.dispatchEvent({type:"change",attr:"textPlacement",value:this._inputs.textPlacement.checked?"line":"point"})}),this._inputs.textOverflow=t.querySelector('[data-attr="textOverflow"] input'),this._inputs.textOverflow.addEventListener("change",()=>{this.dispatchEvent({type:"change",attr:"textOverflow",value:this._inputs.textOverflow.checked})})},C.prototype._initFormCommon=function(t){this._inputs.zIndex=t.querySelector('[data-attr="zIndex"] input'),this.setDispatch("zIndex")},C.prototype._initFormDraw=function(t){this._inputs.strokeColor=new y.default({input:t.querySelector('[data-attr="strokeColor"] input'),position:"fixed"}),this.setDispatch("strokeColor",!0),this._inputs.fillColor=new y.default({input:t.querySelector('[data-attr="fillColor"] input'),position:"fixed"}),this.setDispatch("fillColor",!0),this._inputs.fillPattern=new x.default({input:t.querySelector('[data-attr="fillPattern"] input')}),this._inputs.fillPattern.on("change",t=>{t.pattern?this.element.dataset.pattern="":delete this.element.dataset.pattern,this.dispatchEvent({type:"change",attr:"fillPattern",value:t.pattern}),this.dispatchEvent({type:"change",attr:"sizePattern",value:t.size}),this.dispatchEvent({type:"change",attr:"spacingPattern",value:t.spacing}),this.dispatchEvent({type:"change",attr:"anglePattern",value:t.angle}),this.dispatchEvent({type:"change",attr:"offsetPattern",value:t.offset}),this.dispatchEvent({type:"change",attr:"scalePattern",value:t.scale})}),this._inputs.fillColorPattern=new y.default({input:t.querySelector('[data-attr="fillColorPattern"] input'),position:"fixed"}),this.setDispatch("fillColorPattern",!0),this._inputs.strokeWidth=new p.default({input:t.querySelector('[data-attr="strokeWidth"] input'),position:"fixed"}),this.setDispatch("strokeWidth",!0),this._inputs.strokeDash=new d.default({input:t.querySelector('[data-attr="strokeDash"] input')}),this.setDispatch("strokeDash",!0),this._inputs.strokeArrow=new S({input:t.querySelector('[data-attr="strokeArrow"] input')}),this.setDispatch("strokeArrow",!0)},C.prototype.setDispatch=function(t,e){let i=e?this._inputs[t].input:this._inputs[t];if(!i)return;let l=i.on?"on":"addEventListener";i[l]("change",()=>{let e=i.getValue?i.getValue():i.value;"labelAttribute"===t&&(e=e.replace(/\n{1,}$/g,"")),this.silence||this.dispatchEvent({type:"change",attr:t,value:e})})},C.prototype.setFeature=function(t){let e=t.getIgnStyle(!0);t.getIgnStyle().pointGlyph&&!t.getIgnStyle().pointIcon&&(e.pointIcon=""),this.setStyle(e),this._preview.forEach(e=>e.symbol.setFeatureProperties(t.getProperties()))},C.prototype.setStyle=function(t,e){for(let i in this._silence=e,e||(t.pointRadius?t.pointIcon?this._inputs.pointType.value="image":this._inputs.pointType.value="symbol":this._inputs.pointType.value="label",this.element.dataset.pointType=this._inputs.pointType.value),t)"textPlacement"===i?this._inputs[i].checked="line"===t[i]:"fillPattern"===i?this._inputs.fillPattern.setValue({pattern:t.fillPattern,size:t.sizePattern,spacing:t.spacingPattern,angle:t.anglePattern,offset:t.offsetPattern,scale:t.scalePattern}):this._inputs[i]&&(this._inputs[i].setColor?this._inputs[i].setColor(t[i]):"checkbox"===this._inputs[i].type?this._inputs[i].checked=t[i]:this._inputs[i].setValue?this._inputs[i].setValue(t[i]):(0,v.default).setInputValue(this._inputs[i],t[i])),this._style[i]=t[i];this._silence=!1},C.prototype.getStyle=function(){return this._style},C.prototype.setTypeGeom=function(t){this.element.className="",t||(0,v.default).setTabList(this.element,""),/polygon/i.test(t)&&(this.element.classList.add("polygon"),"text"!==this.element.dataset.tab&&(0,v.default).setTabList(this.element,"stroke")),/line/i.test(t)&&(this.element.classList.add("line"),"text"!==this.element.dataset.tab&&(0,v.default).setTabList(this.element,"stroke")),/point/i.test(t)&&(this.element.classList.add("point"),("text"!==this.element.dataset.tab||"label"===this.element.dataset.pointType)&&(0,v.default).setTabList(this.element,"symbol"))},C.addSymbolLibDialog=function(t,e,i){let l=(0,f.default).create("SELECT");["Point","LineString","Polygon"].forEach(t=>(0,f.default).create("OPTION",{text:"Géométrie : "+(0,w.default)("geom_"+t),value:t,parent:l})),l.addEventListener("change",()=>a.setTypeGeom(l.value)),(0,E.default).show({className:"symbolLibEditor",content:l,buttons:e?{submit:"modifier",add:"ajouter",cancel:"annuler"}:{submit:"ajouter",cancel:"annuler"},onButton:l=>{if("submit"===l&&e){let t=a.getStyle();Object.keys(t).forEach(i=>{e.setIgnStyle(i,t[i])}),"function"==typeof i&&i(e)}else("submit"===l||"add"===l)&&a.addSymbol(t,i)}});let a=new C({target:(0,E.default).getContentElement(),preview:"left",symbolLib:t});e&&(l.value=e.getType(),a.setStyle(e.getIgnStyle()),l.style.display="none"),a.setTypeGeom(l.value)},C.showDialogEditor=function(t){if(!t.getLength()){C.addSymbolLibDialog(t);return}let e=new L.default({symbolLib:t});(0,E.default).show({title:"Bibliothèque de symboles",className:"symbolLib",content:e.element,buttons:{ok:"ajouter...",cancel:"annuler"},onButton:e=>{"ok"===e&&C.addSymbolLibDialog(t)}}),e.on(["item:dblclick","item:duplicate"],e=>{C.addSymbolLibDialog(t,e.item)});let i=()=>{e.removeCollection(),(0,E.default).un("hide",i)};(0,E.default).on("hide",i)},(0,n.default).setApp("macarte","Styles");const N=new o.default({target:"map",id:"85110b95a26e57fd07d9cdcb915f5c1e"});N.setSelectStyle({type:"default",points:!1});const T=new C({target:document.getElementById("form"),symbolLib:N.getSymbolLib()});let q=!1;N.getSelect().on("select",()=>{let t=N.getSelect().getFeatures().item(0);if(t){q=!0,T.setFeature(t);let e={};N.getSelect().getFeatures().forEach(t=>{e[t.getGeometry().getType()]=!0});let i=Object.keys(e).join(",");T.setTypeGeom(i),q=!1}else T.setTypeGeom()}),T.on("change",t=>{q||N.getSelect().getFeatures().forEach(e=>{e.setIgnStyle(t.attr,t.value),e.changed()})}),window.form=T,window.carte=N;