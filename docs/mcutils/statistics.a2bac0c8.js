function e(e){return e&&e.__esModule?e.default:e}var t=globalThis,s={},a={},i=t.parcelRequire8969;null==i&&((i=function(e){if(e in s)return s[e].exports;if(e in a){var t=a[e];delete a[e];var i={id:e,exports:{}};return s[e]=i,t.call(i.exports,i,i.exports),i.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){a[e]=t},t.parcelRequire8969=i),(0,i.register)("agEcb",function(e,t){function s(t){return e.exports=s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,s(t)}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports});var r=i("cvawf"),l=i("gXJm2"),o=i("fnScq"),n=i("8SYbd"),c=i("iQyfo"),h=i("a10XN"),u=i("DW21e");e(n).brewer.Pure=["#d66","#fa0","#ff0","#080","#66f"];class m extends o.default{constructor(t){super(t=t||{}),this.set("size",t.size||5),this.colors=[],this.elements={};let s=this.element=(0,c.default).create("DIV",{className:"color-brewer","data-type":"colored",parent:t.target}),a=(0,c.default).create("DIV",{className:"cbr-type",parent:s});(0,c.default).create("LABEL",{text:"Couleurs :",parent:a});let i=this.elements.type=(0,c.default).create("SELECT",{change:()=>{s.dataset.type=i.value,"custom"===i.value&&(this._custom=!0,this.elements.schemes.querySelectorAll(".selected").forEach(e=>e.className="")),this._showColors(this.elements.colors,this.getScheme(),this.get("size"))},parent:a});this.elements.schemes=(0,c.default).create("DIV",{className:"cbr-scheme",parent:s}),Object.keys(m.types).forEach(e=>{(0,c.default).create("OPTION",{value:e,text:m.types[e].title,parent:this.elements.type});let t=(0,c.default).create("DIV",{className:e,parent:this.elements.schemes});m.types[e].scheme.forEach(e=>{let s=(0,c.default).create("DIV",{"data-scheme":e,title:e,click:()=>{this.setScheme(e)},parent:t});this._showColors(s,e)})}),this.elements.custom=this.elements.schemes.querySelector(".custom"),this.picker=new h.default({hastab:!0,position:"inline",opacity:!1,parent:this.elements.custom}),this.picker.on("color",e=>{let t=this.colors[this.currentColor]=(0,u.toHexa)(e.color);this._custom&&this.currentBox&&this.currentBox.dataset.color!==t&&(this.currentBox.style.backgroundColor=t,this.currentBox.dataset.color=t,this.dispatchEvent({type:"change:color"}))}),this.elements.modifiers=(0,c.default).create("DIV",{className:"cbr-modifiers",parent:s}),(0,c.default).createCheck({className:"small",after:"+saturé",parent:this.elements.modifiers}).addEventListener("change",e=>{this.set("saturate",e.target.checked),this.dispatchEvent({type:"check",property:"saturate",checked:e.target.checked})}),(0,c.default).createCheck({className:"small",after:"+sombre",parent:this.elements.modifiers}).addEventListener("change",e=>{this.set("darken",e.target.checked),this.dispatchEvent({type:"check",property:"darken",checked:e.target.checked})}),(0,c.default).createCheck({className:"small",after:"inverser",parent:this.elements.modifiers}).addEventListener("change",e=>{this.set("revers",e.target.checked),this.dispatchEvent({type:"check",property:"revers",checked:e.target.checked})}),this.elements.colors=(0,c.default).create("DIV",{className:"cbr-colors",parent:s}),(0,c.default).create("BUTTON",{text:"dégradé",className:"button button-ghost",click:()=>{let t=[];for(let s=0;s<this.colorBR.length-1;s++){t.pop();let a=[this.colors[this.colorBR[s]],this.colors[this.colorBR[s+1]]],i=this.colorBR[s+1]-this.colorBR[s]+(this.colorBR.length>1?1:0);t=t.concat(e(n).scale(a).colors(i))}this.colors.length===t.length&&this.colors.every(function(e,s){return e===t[s]})||(this.colors=t,this._showColors(this.elements.colors,this.getScheme(),this.get("size")),this.dispatchEvent({type:"change:color"}))},parent:(0,c.default).create("DIV",{className:"cbr-gradient",parent:s})}),this.setScheme("Oranges"),this.setColors(t.colors),this.on("propertychange",()=>{this._updateColors()})}}m.prototype.setScheme=function(e){let t=this.elements.schemes.querySelector('[data-scheme="'+e+'"]');t&&(this.element.dataset.scheme!==e||this._custom)&&(this._custom=!1,this.element.dataset.scheme=e,this.elements.schemes.querySelectorAll(".selected").forEach(e=>e.className=""),t.className="selected",this._showColors(this.elements.colors,e,this.get("size")),this.dispatchEvent({type:"change:scheme",scheme:e}))},m.prototype.getScheme=function(){return this.element.dataset.scheme},m.prototype.setSize=function(e){(e=parseInt(e))&&e!==this.get("size")&&(this.set("size",e),this._custom||this.dispatchEvent({type:"change:color"}))},m.prototype._updateColors=function(){this.elements.schemes.querySelectorAll(".cbr-scheme [data-scheme]").forEach(e=>{this._showColors(e,e.dataset.scheme)}),this._showColors(this.elements.colors,this.getScheme(),this.get("size"))},m.prototype._showColors=function(t,s,a){let i=t===this.elements.colors&&this._custom;a=a||5;let r=e(n).brewer[s];if(i){if(this.colorBR.length||(this.colorBR=[0,this.colors.length-1],this.currentColor=0),this.colors.length>a){for(;this.colors.length>a;)this.colors.pop();this.colorBR=[0,this.colors.length-1]}else if(this.colors.length<a){let e=this.colors.pop();for(let t=this.colors.length;t<a;t++)this.colors.push(e);this.colorBR=[0,this.colors.length-1]}r=this.colors}else this.colorBR=[],r=e(n).scale(r).colors(a),this.get("revers")&&(r=r.slice().reverse()),"custom"!==this.element.dataset.type&&(this.colors=r);t.innerHTML="",r.forEach((s,l)=>{!i&&(this.get("saturate")&&(r[l]=e(n)(r[l]).saturate(2).hex()),this.get("darken")&&(r[l]=e(n)(r[l]).darken().hex()));let o=[];this.colorBR.indexOf(l)>=0&&o.push("br"),l===this.currentColor&&(this.picker.setColor(r[l]),o.push("selected"));let h=(0,c.default).create("DIV",{className:o.join(" "),"data-index":l,"data-color":r[l],style:{backgroundColor:r[l]},parent:t});i?(l===this.currentColor&&(this.currentBox=h),h.addEventListener("click",()=>{this.selectColor(l),0!==l&&l!==a-1&&h.classList.toggle("br"),this.colorBR=[],t.querySelectorAll(".br").forEach(e=>{this.colorBR.push(parseInt(e.dataset.index))})})):this.currentBox=!1})},m.prototype.getColors=function(){return this.colors},m.prototype.setColors=function(e){e&&e instanceof Array&&(this.set("size",e.length,!0),this.colors=e,this.setType("custom"),this._updateColors())},m.prototype.selectColor=function(e){let t=this.elements.colors,s=t.querySelector('[data-index="'+e+'"]');s&&(t.querySelectorAll("div").forEach(e=>{e.classList.remove("selected")}),s.classList.add("selected"),this.currentColor=e,this.currentBox=s,this.picker.setColor(s.dataset.color))},m.prototype.setType=function(e){m.types[e]&&this.element.dataset.type!==e&&(this.elements.type.value=this.element.dataset.type="custom",this._custom=!0,this.elements.type.dispatchEvent(new Event("change")))},m.types={colored:{title:"coloré",scheme:["Oranges","Blues","Greens","Purples","Reds","Greys"]},sequential:{title:"séquentiel",scheme:["BuGn","BuPu","GnBu","OrRd","PuBu","PuBuGn","PuRd","RdPu","YlGn","YlGnBu","YlOrBr","YlOrRd"]},diverging:{title:"divergent",scheme:["BrBG","PiYG","PRGn","PuOr","RdBu","RdGy","RdYlBu","RdYlGn","Spectral"]},qualitative:{title:"qualitatif",scheme:["Accent","Dark2","Paired","Pastel1","Pastel2","Set1","Set2","Set3","Pure"]},custom:{title:"manuel",scheme:[]}};var d=i("iGyOD"),p=i("5VeMq"),c=i("iQyfo"),f=class extends p.default{constructor(e){super(e=e||{}),this.setTemplate(e.template),this.set("canFix",e.canFix),this.set("showImage",e.showImage),this.set("maxChar",e.maxChar||200),this.set("keepSelection",e.keepSelection),e.select&&"function"==typeof e.select.on&&(this._select=e.select,e.select.on("select",(function(t){this._noselect||(t.selected[0]?this.show(t.mapBrowserEvent.coordinate,e.select.getFeatures().getArray(),t.selected[0]):this.hide())}).bind(this)))}setTemplate(e){e||(e=function(e){var t=e.getProperties();return delete t[e.getGeometryName()],{attributes:Object.keys(t)}}),this._template=e,this._attributeObject(this._template)}_attributeObject(e){if(e&&e.attributes instanceof Array){var t={};e.attributes.forEach(function(e){t[e]=!0}),e.attributes=t}return e.attributes}show(e,t,s){(e instanceof d.default||e instanceof Array&&e[0]instanceof d.default)&&(t=e,e=null),t instanceof Array||(t=[t]),this._features=t.slice(),this._count||(this._count=1),this._count=1;var a=this.get("keepSelection")&&s||t[0],i=this._getHtml(a);i?(this.element.classList.contains("ol-fixed")||this.hide(),e&&"Point"!==t[0].getGeometry().getType()||(e=t[0].getGeometry().getFirstCoordinate()),super.show(e,i)):this.hide()}_getHtml(e){if(!e)return"";var t=(0,c.default).create("DIV",{className:"ol-popupfeature"});this.get("canFix")&&(0,c.default).create("I",{className:"ol-fix",parent:t}).addEventListener("click",(function(){this.element.classList.toggle("ol-fixed")}).bind(this));var s=this._template;if("function"==typeof s)s=s(e,this._count,this._features.length);else if(!s||!s.attributes)for(var a in(s=s||{}).attributes={},e.getProperties())"geometry"!=a&&(s.attributes[a]=a);if(s.title&&(i="function"==typeof s.title?s.title(e):e.get(s.title),(0,c.default).create("H1",{html:i,parent:t})),s.attributes){var i,r,l=(0,c.default).create("TABLE",{parent:t}),o=this._attributeObject(s),n=e.getProperties();Object.keys(o).forEach((function(t){if(n.hasOwnProperty(t)){var s,a=o[t],i=n[t];a&&"function"==typeof a.format&&(i=a.format(i,e));var h=!0;if(a&&"boolean"==typeof a.visible?h=a.visible:a&&"function"==typeof a.visible&&(h=a.visible(e,i)),h){if(r=(0,c.default).create("TR",{click:(function(s){this.dispatchEvent({type:"attribute",feature:e,attribute:t,originalEvent:s})}).bind(this),parent:l}),(0,c.default).create("TD",{className:"ol-label",html:a&&a.title||t,parent:r}),this.get("showImage")&&/(http(s?):)([/|.|\w|\s|-])*\.(?:jpg|gif|png)/.test(i))s=(0,c.default).create("IMG",{src:i});else{s=a?(a.before||"")+i+(a.after||""):"";var u=this.get("maxChar")||200;"string"==typeof s&&s.length>u&&(s=s.substr(0,u)+"[...]")}(0,c.default).create("TD",{className:"ol-value",html:s,parent:r})}}}).bind(this))}if((0,c.default).create("BUTTON",{className:"ol-zoombt",parent:t}).addEventListener("click",(function(){if("Point"===e.getGeometry().getType())this.getMap().getView().animate({center:e.getGeometry().getFirstCoordinate(),zoom:Math.max(this.getMap().getView().getZoom(),18)});else{var t=e.getGeometry().getExtent();this.getMap().getView().fit(t,{duration:1e3})}}).bind(this)),!this.get("keepSelection")&&this._features.length>1){var h=(0,c.default).create("DIV",{className:"ol-count",parent:t});(0,c.default).create("DIV",{className:"ol-prev",parent:h,click:(function(){this._count--,this._count<1&&(this._count=this._features.length),t=this._getHtml(this._features[this._count-1]),setTimeout((function(){(0,p.default).prototype.show.call(this,this.getPosition(),t)}).bind(this),350)}).bind(this)}),(0,c.default).create("TEXT",{html:this._count+"/"+this._features.length,parent:h}),(0,c.default).create("DIV",{className:"ol-next",parent:h,click:(function(){this._count++,this._count>this._features.length&&(this._count=1),t=this._getHtml(this._features[this._count-1]),setTimeout((function(){(0,p.default).prototype.show.call(this,this.getPosition(),t)}).bind(this),350)}).bind(this)})}return this._select&&!this.get("keepSelection")&&(this._noselect=!0,this._select.getFeatures().clear(),this._select.getFeatures().push(e),this._noselect=!1),this.dispatchEvent({type:"select",feature:e,index:this._count}),t}setFix(e){e?this.element.classList.add("ol-fixed"):this.element.classList.remove("ol-fixed")}getFix(){return this.element.classList.contains("ol-fixed")}},g=i("bXE6B"),c=i("iQyfo"),y=i("bS8Lk"),v=i("kbFhP"),c=i("iQyfo"),o=i("fnScq");class b extends o.default{constructor(e){super(e=e||{});let t=this.element=(0,c.default).create("DIV",{className:"repartionGraph",parent:e.target});this.graph=(0,c.default).create("DIV",{className:"rgGraph",parent:t}),this.canvas=document.createElement("canvas"),this.canvas.width=e.width||260,this.canvas.height=e.height||150,this.ctx=this.canvas.getContext("2d"),this.graph.append(this.canvas);let s=(0,c.default).create("DIV",{className:"rgOptions",parent:t});(0,c.default).createCheck({className:"small",after:"lisser",parent:s}).addEventListener("change",e=>{this.set("smooth",e.target.checked),this.draw()}),(0,c.default).createCheck({type:"radio",className:"small",name:"rgtypgraph",after:"répartition",parent:s}).addEventListener("change",()=>{this.setType("distribution")}),(0,c.default).createCheck({type:"radio",className:"small",name:"rgtypgraph",after:"histogramme",checked:!0,parent:s}).addEventListener("change",()=>{this.setType("histogram")}),this.limitDiv=(0,c.default).create("DIV",{className:"rgLimits",parent:t}),this.limits=[],this.wbar=3}}b.prototype.setType=function(e){this.type=e,this.draw()},b.prototype.px2value=function(e){return(e-10)/this.wbar*this.scale+this.stat.limits[0]},b.prototype.value2px=function(e){return(e-this.stat.limits[0])*this.wbar/this.scale+10},b.prototype.setRepartition=function(e){var t,s;if(this.stat=e,this.element.dataset.edit=e.mode,e.limits&&(t=e.limits,s=this.limits,!(t.length===s.length&&t.every(function(e,t){return e===s[t]})))){this.graph.querySelectorAll(".rgMarker").forEach(e=>e.remove()),this.limitDiv.innerHTML="";let t=!1,s=(e,s)=>{t={id:e,px:s.pageX||s.originalEvent.touches[0].pageX,limit:this.limitDiv.querySelector(".limit_"+e),elt:s.target,x0:parseFloat(s.target.style.left)},document.addEventListener("mousemove",a),document.addEventListener("touchmove",a),document.addEventListener("mouseup",i),document.addEventListener("touchend",i)},a=e=>{if(t){var s=e.pageX||e.originalEvent.touches[0].pageX,a=t.x0+s-t.px,i=this.px2value(a);!(i<this.limits[t.id-1])&&(i>this.limits[t.id+1]||(t.elt.style.left=a+"px",this.limits[t.id]=t.limit.value=i))}},i=()=>{t&&(t=!1,document.removeEventListener("mousemove",a),document.removeEventListener("touchmove",a),document.removeEventListener("mouseup",i),document.removeEventListener("touchend",i),this.dispatchEvent({type:"change:limit",limits:this.limits}))};this.limits=e.limits.slice(),e.limits.forEach((t,a)=>{(0,c.default).create("DIV",{className:(0===a||a===e.limits.length-1?"disable ":"")+"rgMarker marker_"+a,on:{"mousedown touchstart":e=>{console.log(this.stat.mode),"c"===this.stat.mode&&s(a,e)}},parent:this.graph}),(0,c.default).create("INPUT",{className:"rgLimit limit_"+a,value:e.limits[a],change:e=>{let t=this.stat,s=Number(e.target.value);0===a?s>t.limits[a+1]&&(s=t.limits[a+1]):(a===t.limits.length-1||s>t.limits[a+1]&&(s=t.limits[a+1]),s<t.limits[a-1]&&(s=t.limits[a-1])),e.target.value=s,this.limits[a]=s,this.dispatchEvent({type:"change:limit",limits:this.limits})},on:{keydown:e=>{1===e.key.length&&("."===e.key?/\./.test(this.value)&&e.preventDefault():"-"!==e.key&&(e.key<"0"||e.key>"9")&&e.preventDefault())},keyup:e=>{if("-"!==e.target.value){let t=parseFloat(e.target.value.replace(/^-{1,}/,"-"));t!=e.target.value&&(e.target.value=t||"")}}},parent:this.limitDiv})})}this.draw()},b.prototype.draw=function(){if(!this.stat)return;var e=this.ctx,t=this.canvas.width,s=this.canvas.height;e.fillStyle="transparent",e.clearRect(0,0,t,s);let a=this.stat.limits;if(a&&a.length){var i=a[0],r=a[a.length-1]-i;if(r&&isFinite(r))try{s-=20,t-=20;let u=function(e){for(let t=1;t<a.length;t++)if(a[t]>e)return t-1;return a.length-2};for(var l=Math.round(t/this.wbar),o=this.scale=r/l,n=[],c=0;c<=l;c++)n[c]={val:(c+.5)*o+i,vmin:c*o+i,vmax:(c+1)*o+i,interval:u((c+.5)*o+i),color:this.stat.colors[u((c+.5)*o+i)]||"#999",nb:0};e.setTransform(1,0,0,-1,10,s+10);var h=0;if(this.stat.values.forEach(e=>{e=Number(e);var t=Math.round((e-i)/o);n[t]&&(n[t].nb++,n[t].nb>h&&(h=n[t].nb))}),"distribution"==this.type){for(let e=1;e<=l;e++)n[e].nb+=n[e-1].nb;h=n[l].nb}else this.get("smooth")&&(n=function(e){var t=[];t[0]=(e[0].nb+e[1].nb/2)/1.5;for(let s=1;s<e.length-1;s++)t[s]=(e[s].nb+(e[s-1].nb+e[s+1].nb)/2)/2;t[c]=(e[c].nb+e[c-1].nb/2)/1.5;for(let s=0;s<e.length;s++)e[s].nb=t[s];return e}(n));for(let t=0;t<=l;t++)e.fillStyle=n[t].color,e.fillRect(t*this.wbar,0,this.wbar,n[t].nb*s/h);this.stat.limits&&this.stat.limits.length&&this.stat.limits.forEach((e,t)=>{this.graph.querySelector(".marker_"+t).style.left=this.value2px(e)+"px"})}catch(e){}}},(0,l.default).setApp("macarte","Colors");const E=(0,c.default).create("SELECT",{change:()=>{N.setStatistic({typeMap:E.value},300)},parent:document.getElementById("form")});(0,g.default).type.forEach(e=>{(0,c.default).create("OPTION",{value:e,html:e,parent:E})});const k=(0,c.default).create("SELECT",{change:()=>{N.setStatistic({mode:k.value},300)},parent:document.getElementById("form")});Object.keys(g.default.mode).forEach(e=>{(0,c.default).create("OPTION",{value:e,html:g.default.mode[e],parent:k})});const x=(0,c.default).create("DIV",{parent:document.getElementById("form")});(0,c.default).create("SPAN",{html:"Nb classes : ",parent:x}),(0,c.default).create("INPUT",{type:"number",value:5,min:2,change:e=>{_.setSize(e.target.value),N.setStatistic({nbClass:e.target.value,brewerColors:_.getColors()},300)},parent:x});const _=new m({target:document.getElementById("form")});_.on(["change:scheme","check","change:color"],e=>{N.setStatistic({brewerColors:_.getColors()},300),console.log("change")});const w=new b({target:document.getElementById("form")});w.on("change:limit",e=>{N.setStatistic({limits:e.limits})});const S=(0,c.default).create("DIV",{parent:document.getElementById("form")});(0,c.default).create("LABEL",{text:"Radius: ",parent:S}),(0,c.default).create("INPUT",{type:"number",value:3,min:-1,change:e=>{N.setStatistic({rmin:parseFloat(e.target.value)})},parent:S}),(0,c.default).create("INPUT",{type:"number",value:20,min:0,change:e=>{N.setStatistic({rmax:parseFloat(e.target.value)})},parent:S}),(0,c.default).createSwitch({html:"normal",after:"multiply",checked:!0,change:e=>{N.setBlendMode(e.target.checked?"multiply":"normal")},parent:document.getElementById("form")});const C=(0,c.default).createCheck({after:"afficher les contours",checked:!0,parent:document.getElementById("form")});C.addEventListener("change",e=>{N.setStatistic({stroke:!!C.checked&&"red"},300)});const B=new r.default({target:"map",url:"./data/stat.carte"});B.showControl("legend");let N=null;B.on("read",()=>{window.slayer=N=null,B.getMap().getLayers().forEach(e=>{e.stat&&(window.slayer=N=e,N.on("stat:start",()=>{(0,y.default).show("calcul...",-1)}),N.on("stat:end",e=>{if((0,y.default).hide(),e.error){(0,v.default).showAlert("Impossible de calculer la statistique...<br/>"+e.statusText);return}switch(e.stat.typeMap){case"categorie":_.setSize(N.getValues().length);break;case"sectoriel":_.setSize(e.stat.cols.length);break;default:_.setSize(e.stat.nbClass)}w.setRepartition({mode:N.getMode(),values:N.getValues(),limits:N.getLimits(),colors:_.getColors()});let t=B.getControl("legend").getLegend();t.getItems().clear(),N.getStatLegend().forEach(e=>{t.addItem(e)})}))})}),B.getMap().addOverlay(new f({canFix:!0,closeBox:!0,minibar:!0,template:e=>{let t=e.getProperties();return delete t.geometry,{attributes:Object.keys(t)}},select:B.getSelect()})),B.setSelectStyle({points:!1}),window.brewer=_,window.carte=B,window.graph=w;