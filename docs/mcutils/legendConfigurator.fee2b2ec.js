function e(e,t,l,i){Object.defineProperty(e,t,{get:l,set:i,enumerable:!0,configurable:!0})}var t=globalThis,l={},i={},n=t.parcelRequire8969;null==n&&((n=function(e){if(e in l)return l[e].exports;if(e in i){var t=i[e];delete i[e];var n={id:e,exports:{}};return l[e]=n,t.call(n.exports,n,n.exports),n.exports}var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){i[e]=t},t.parcelRequire8969=n);var s=n.register;s("11Wcd",function(t,l){e(t.exports,"default",()=>r);var i=n("iQyfo"),s=n("h5s17");class a extends s.default{constructor(e){let t=(e=e||{}).symbolLib;super({target:e.target,className:"mcSymbolLib"+(e.className?" "+e.className:""),collection:t,getTitle:l=>{if(!(!e.filter||e.filter.indexOf(l.getType())>=0))return(0,i.default).create("DIV",{className:"hidden"});{let n=(0,i.default).create("DIV",{className:"mcSymbol"});n.appendChild(l.getImage());let s=(0,i.default).create("INPUT",{type:"text",placeholder:"nom du symbole",value:l.get("name"),on:{focusout:()=>{delete n.dataset.edit},keydown:e=>{switch(e.key){case"Enter":l.set("name",s.value),a.innerText=s.value;case"Escape":delete n.dataset.edit,e.preventDefault()}}},parent:n}),a=(0,i.default).create("SPAN",{text:l.get("name"),parent:n});return!1!==e.edit&&((0,i.default).create("I",{className:"fi-pencil",title:"modifier le nom",click:()=>{n.dataset.edit="",s.focus();let e=s.value;s.value="",s.value=e},parent:n}),(0,i.default).create("I",{className:"fg-color",title:"modifier / dupliquer le style",click:()=>{this.dispatchEvent({type:"item:duplicate",item:l})},parent:n}),(0,i.default).create("i",{className:"fi-delete",title:"supprimer le style",click:()=>{t.remove(l),this.dispatchEvent({type:"item:remove"})},parent:n})),n}}})}}var r=a}),s("h5s17",function(t,l){e(t.exports,"default",()=>a);var i=n("fnScq"),s=n("iQyfo"),a=class extends i.default{constructor(e){super(),this.element=(0,s.default).create("UL",{className:("ol-collection-list "+(e.className||"")).trim(),parent:e.target}),this._title="function"==typeof e.getTitle?e.getTitle:function(e){return e.title},this.setCollection(e.collection)}removeCollection(){this.collection&&(this.collection.un("change:length",this._update),this.collection=null)}setCollection(e){this.removeCollection(),this.collection=e,this.refresh(),this.collection&&(this._update=(function(){if(!this._reorder){this.refresh();var e=this.getSelectPosition();e<0?this.dispatchEvent({type:"item:select",position:-1,item:null}):this.dispatchEvent({type:"item:order",position:e,item:this._currentItem})}}).bind(this),this.collection.on("change:length",this._update))}select(e){if(e!==this._currentItem){var t=-1;this._listElt.forEach(function(l,i){l.item!==e?l.li.classList.remove("ol-select"):(l.li.classList.add("ol-select"),t=i)}),this._currentItem=t>=0?e:null,this.dispatchEvent({type:"item:select",position:t,item:this._currentItem})}}selectAt(e){this.select(this.collection.item(e))}getSelect(){return this._currentItem}getSelectPosition(){return this.collection?this.collection.getArray().indexOf(this._currentItem):-1}refresh(e){this.element.innerHTML="",this._listElt=[],this.collection&&this.collection.forEach((t,l)=>{var i=(0,s.default).create("LI",{html:this._title(t),className:this._currentItem===t?"ol-select":"","data-position":l,on:{click:(function(){this.select(t)}).bind(this),dblclick:(function(){this.dispatchEvent({type:"item:dblclick",position:l,item:t})}).bind(this)},parent:this.element}),n=(0,s.default).create("INPUT",{"aria-label":this._title(t),type:"checkbox",className:"ol-input-focus",on:{keydown:(function(e){switch(e.key){case"ArrowUp":case"ArrowDown":if(e.ctrlKey){e.preventDefault(),e.stopPropagation(),this.select(t);var i="ArrowUp"===e.key?l-1:l+1;i>=0&&i<this.collection.getLength()&&(this._reorder=!0,this.collection.removeAt(l),this.collection.insertAt(i,t),this._reorder=!1,this.dispatchEvent({type:"item:order",position:i,oldPosition:l,item:t}),this.refresh(t))}break;case" ":case"Space":e.preventDefault(),e.stopPropagation(),this.select(t);break;case"Tab":break;default:this.dispatchEvent({type:"item:keydown",key:e.key,originalEvent:e,position:l,item:t})}}).bind(this)},parent:i});e===t&&n.focus(),this._listElt.push({li:i,item:t});var a=(0,s.default).create("DIV",{className:"ol-noscroll ol-order",parent:i}),r=l,o=(function(e){for(var t="touch"===e.pointerType?document.elementFromPoint(e.clientX,e.clientY):e.target;t&&t.parentNode!==this.element;)t=t.parentNode;if(t&&t!==i){var l=parseInt(t.getAttribute("data-position"));t.getAttribute("data-position")<r?(t.insertAdjacentElement("beforebegin",i),r=l):(t.insertAdjacentElement("afterend",i),r=l+1)}}).bind(this),c=(function(){document.removeEventListener("pointermove",o),document.removeEventListener("pointerup",c),document.removeEventListener("pointercancel",c),r!==l&&(this._reorder=!0,this.collection.removeAt(l),this.collection.insertAt(r>l?r-1:r,t),this._reorder=!1,this.dispatchEvent({type:"item:order",position:r>l?r-1:r,oldPosition:l,item:t}),this.refresh())}).bind(this);a.addEventListener("pointerdown",(function(){this.select(t),document.addEventListener("pointermove",o),document.addEventListener("pointerup",c),document.addEventListener("pointercancel",c)}).bind(this))})}}}),s("agEcb",function(e,t){function l(t){return e.exports=l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,l(t)}e.exports=l,e.exports.__esModule=!0,e.exports.default=e.exports});var a=n("gXJm2"),r=n("cvawf"),o=n("kbFhP"),c=n("iQyfo"),d=n("11Wcd"),u=n("fnScq"),p=n("h5s17"),m=n("3HxCM"),f=n("bJF7J"),h=n("kkNxo"),g=n("cHblF");class y extends u.default{constructor(e){super(e=e||{});let t=this.element=(0,c.default).create("DIV",{className:"mc-legend-control"}),l=(0,c.default).create("DIV",{className:"title",parent:t});(0,c.default).create("H3",{text:"Bibliothèque de symboles",parent:l}),(0,c.default).create("H3",{text:"Légende",parent:l}),(0,c.default).create("A",{html:"Ajouter un sous-titre...",parent:l,click:()=>{let e=Math.max(this.legendInput.getSelectPosition(),0);s.insertAt(e,new f.default({title:""})),this.legendInput.selectAt(e),this.legendInput.element.querySelectorAll(".fi-pencil")[e].click()}}),(0,c.default).create("A",{html:"Vider la légende...",parent:l,click:()=>{s.getLength()&&(0,h.default).showAlert("Etes-vous sur de vouloir supprimer toutes les lignes de la légende ?",{ok:"ok",cancel:"cancel"},e=>{"ok"===e&&s.clear()})}}),this.symbolInput=new d.default({className:"symbol",symbolLib:e.symbolLib,target:t}),this.symbolInput.on("item:select",e=>{e.item?t.dataset.symbol="":delete t.dataset.symbol}),this.symbolInput.addEventListener("item:dblclick",()=>{n.click()});let i=(0,c.default).create("DIV",{className:"mc-control",parent:t}),n=(0,c.default).create("BUTTON",{className:"button button-colored play",html:'<i class="fi-play"></i>',title:"ajouter à la légende",click:()=>{let e=this.symbolInput.getSelect();if(!e)return;let t=this.legendInput.getSelectPosition()+1;s.insertAt(t,new f.default({title:e.get("name")||"",feature:e._feature.clone()})),this.legendInput.selectAt(t)},parent:i});(0,c.default).create("BUTTON",{className:"button button-colored playback",html:'<i class="fi-play"></i>',title:"ajouter à la bibliothèque",click:()=>{let t=this.legendInput.getSelect();if(!t||!t.get("feature"))return;let l=this.symbolInput.getSelectPosition()+1;e.symbolLib.insertAt(l,new g.default({name:t.get("title").replace(/\n/g," ")||"",feature:t.get("feature").clone()})),this.symbolInput.selectAt(l)},parent:i});let s=e.legend.getItems();this.legendInput=new p.default({collection:s,className:"mcSymbolLib",getTitle:t=>{let l=t instanceof m.default,i=l?"Calque - "+t._layer.get("title"):t.get("title"),n=t.getProperties(),s=(0,c.default).create("DIV",{className:"mcSymbol"+(n.feature?" item":" title")+(l?" layer":"")});s.appendChild((0,m.default).getLegendImage(n));let a=(0,c.default).create("SPAN",{html:i.replace(/\n/,"<br/>")+"&nbsp;",parent:s}),r=(0,c.default).create("TEXTAREA",{placeHolder:n.feature?"":"sous-titre...",parent:s});return l||(0,c.default).create("I",{className:"fi-pencil",click:()=>{r.style.display="block",r.value=i,r.focus(),r.addEventListener("focusout",()=>{r.style.display="",t.set("title",r.value),a.innerHTML=t.get("title").replace(/\n/,"<br/>")+"&nbsp;",e.legend.refresh()})},parent:s}),(0,c.default).create("i",{className:"fi-delete",click:()=>{e.legend.getItems().remove(t),this.symbolInput.dispatchEvent({type:"item:remove"})},parent:s}),s},target:t}),this.legendInput.addEventListener("item:dblclick",e=>{this.legendInput.element.querySelectorAll(".fi-pencil")[e.position].click()}),this.legendInput.on("item:select",e=>{e.item&&e.item.get("feature")?t.dataset.legend="":delete t.dataset.legend})}}y.prototype.remove=function(){this.symbolInput.removeCollection(),this.legendInput.removeCollection()};var c=n("iQyfo");const b=new r.default({key:"0gd4sx9gxx6ves3hf3hfeyhw",url:"../data/symbolLib.carte",target:(0,a.default).getAppElement()});!function(e,t,l){l=l||{};let i=new y({symbolLib:e,legend:t});(0,o.default).show({title:l.title||"Légende",className:l.className,content:i.element,buttons:["ok"]});let n=[];if((l.layers||[]).forEach(e=>{e._legend&&n.push(e)}),n.length){let e=(0,c.default).create("DIV",{className:"layerLegend",parent:(0,o.default).getContentElement()});(0,c.default).create("LABEL",{text:"Utliser la légende du calque : ",parent:e});let l=(0,c.default).create("SELECT",{change:()=>{let e=parseInt(l.value);e>-1&&(0>t.getItems().getArray().indexOf(n[e]._legend)&&t.addItem(n[e]._legend),i.legendInput.select(n[e]._legend)),l.value=-1},parent:e});(0,c.default).create("OPTION",{text:"...",value:-1,parent:l}),n.reverse().forEach((e,t)=>{(0,c.default).create("OPTION",{text:e.get("title")||e.get("name"),value:t,parent:l})})}let s=()=>{i.remove(),(0,o.default).un("hide",s)};(0,o.default).on("hide",s),o.default}(b.getSymbolLib(),b.getControl("legend").getLegend(),{title:"Configurer la légende"}),window.carte=b;